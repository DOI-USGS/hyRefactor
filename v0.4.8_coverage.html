<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<style>body{background-color:white;}</style>
<script src="lib/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<link href="lib/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="lib/datatables-binding-0.25/datatables.js"></script>
<script src="lib/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="lib/dt-core-1.11.3/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="lib/dt-core-1.11.3/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="lib/dt-core-1.11.3/js/jquery.dataTables.min.js"></script>
<link href="lib/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="lib/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<link href="lib/highlight.js-6.2/rstudio.css" rel="stylesheet" />
<script src="lib/highlight.js-6.2/highlight.pack.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="lib/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<link href="lib/bootstrap-3.3.5/css/bootstrap-theme.min.css" rel="stylesheet" />
<script src="lib/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="lib/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="lib/bootstrap-3.3.5/shim/respond.min.js"></script>

</head>
<body>
<div class="container-fluid">
  <style type="text/css">table tr:hover td {
  font-weight:bold;text-decoration:none
}
table tr.covered td{
  background-color:rgba(95,151,68,0.3)
}

table tr:hover.covered .num{
  background-color:rgba(95,151,68,0.7)
}
table tr.missed td{
  background-color:rgba(185,73,71,0.3)
}
table tr:hover.missed .num{
  background-color:rgba(185,73,71,0.7)
}

table tr.missed:hover td{
  -webkit-box-shadow:0 -2px 0 0 #b94947 inset;
  -moz-box-shadow:0 -2px 0 0 #b94947 inset;
  box-shadow:0 -2px 0 0 #b94947 inset
}
table tr.covered:hover td{
  -webkit-box-shadow:0 -2px 0 0 #5f9744 inset;
  -moz-box-shadow:0 -2px 0 0 #5f9744 inset;
  box-shadow:0 -2px 0 0 #5f9744 inset
}

table tr.never td{
  background-color:transparent
}

table tbody {
  border-style: solid;
  border: 1px solid rgba(0,0,0,0.1)
}

table .num {
  border-right: 1px solid rgba(0,0,0,0.1)
}

td.coverage em {
  opacity: 0.5;
}

table td.coverage {
  border-right: 1px solid rgba(0,0,0,0.1);
  font-weight: bold;
  text-align: center;
}
table.table-condensed pre {
  background-color: transparent;
  margin: 0;
  padding: 0;
  border: 0;
  font-size: 11px;
}
div#files td {
  padding: 0;
  padding-left: 5px;
}

div#files td.num {
  padding-right: 5px;
}

table.table-condensed {
  font-size: 11px;
}</style>
  <div class="col-md-8 col-md-offset-2">
    <h2>hyRefactor coverage - 89.44%</h2>
    <div class="tabbable">
      <ul class="nav nav-tabs" data-tabsetid="covr">
        <li class="active">
          <a href="#tab-covr-1" data-toggle="tab" data-value="Files">Files</a>
        </li>
        <li>
          <a href="#tab-covr-2" data-toggle="tab" data-value="Source">Source</a>
        </li>
      </ul>
      <div class="tab-content" data-tabsetid="covr">
        <div class="tab-pane active" title="Files" data-value="Files" id="tab-covr-1">
          <div id="htmlwidget-9266212efa0c2c907f8f" style="width:100%;height:500px;" class="datatables html-widget"></div>
          <script type="application/json" data-for="htmlwidget-9266212efa0c2c907f8f">{"x":{"filter":"none","vertical":false,"fillContainer":false,"data":[["<a href=\"#\">R/download_fdr_fac.R<\/a>","<a href=\"#\">R/catchment_geometry.R<\/a>","<a href=\"#\">R/hyRefactor.R<\/a>","<a href=\"#\">R/split_catchment.R<\/a>","<a href=\"#\">R/aggregate_catchments.R<\/a>","<a href=\"#\">R/reconcile.R<\/a>","<a href=\"#\">R/split_flowline.R<\/a>","<a href=\"#\">R/collapse.R<\/a>","<a href=\"#\">R/aggregate_network.R<\/a>","<a href=\"#\">R/refactor_nhdplus.R<\/a>","<a href=\"#\">R/map_outlets.R<\/a>"],[80,346,142,516,101,424,344,643,627,154,62],[35,144,30,227,37,239,170,338,279,63,27],[0,95,25,196,32,212,165,330,274,63,27],[35,49,5,31,5,27,5,8,5,0,0],["0","9","124","20850","6","85","857","46","474","7","3"],["0.00%","65.97%","83.33%","86.34%","86.49%","88.70%","97.06%","97.63%","98.21%","100.00%","100.00%"]],"container":"<table class=\"row-border\">\n  <thead>\n    <tr>\n      <th>File<\/th>\n      <th>Lines<\/th>\n      <th>Relevant<\/th>\n      <th>Covered<\/th>\n      <th>Missed<\/th>\n      <th>Hits / Line<\/th>\n      <th>Coverage<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"searching":false,"dom":"t","paging":false,"columnDefs":[{"targets":6,"createdCell":"function(td, cellData, rowData, row, col) {\n  var percent = cellData.replace(\"%\", \"\");\n  if (percent > 90) {\n    var grad = \"linear-gradient(90deg, #edfde7 \" + cellData + \", white \" + cellData + \")\";\n  } else if (percent > 75) {\n    var grad = \"linear-gradient(90deg, #f9ffe5 \" + cellData + \", white \" + cellData + \")\";\n  } else {\n    var grad = \"linear-gradient(90deg, #fcece9 \" + cellData + \", white \" + cellData + \")\";\n  }\n  $(td).css(\"background\", grad);\n}\n"},{"className":"dt-right","targets":[1,2,3,4]}],"order":[],"autoWidth":false,"orderClasses":false},"callback":"function(table) {\ntable.on('click.dt', 'a', function() {\n  files = $('div#files div');\n  files.not('div.hidden').addClass('hidden');\n  id = $(this).text();\n  files.filter('div[id=\\'' + id + '\\']').removeClass('hidden');\n  $('ul.nav a[data-value=Source]').text(id).tab('show');\n});\n}"},"evals":["options.columnDefs.0.createdCell","callback"],"jsHooks":[]}</script>
        </div>
        <div class="tab-pane" title="Source" data-value="Source" id="tab-covr-2">
          <div id="files">
            <div id="R/aggregate_network.R" class="hidden">
              <table class="table-condensed">
                <tbody>
                  <tr class="never">
                    <td class="num">1</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' Aggregate Network</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">2</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @description Aggregates a catchment network according to a set of outlet.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">3</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">4</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param flowpath sf data.frame Flowpaths with ID, toID, LevelPathID, and Hydroseq attributes.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">5</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">6</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param outlets data.frame with "ID" and "type" columns. "ID" must be identifiers from</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">7</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' fowpath and divide data.frames. "type" should be "outlet", or "terminal".</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">8</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' "outlet" will include the specified ID.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">9</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' "terminal" will be treated as a terminal node with nothing downstream.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">10</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">11</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param da_thresh numeric Defaults to NA. A threshold total drainage area in the</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">12</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' units of the TotDASqKM</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">13</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' field of the flowpath data.frame. When automatically adding confluences to make</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">14</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' the network valid, tributary catchments under this threshold will be lumped with</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">15</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' the larger tributaries rather than being added to the set of output catchments.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">16</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">17</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param only_larger boolean Defaults to TRUE. If TRUE when adding confluences to</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">18</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' make the network valid, only tributaries larger than the one with an upstream</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">19</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' outlet will be added. e.g. if a tributary is required in the model this will</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">20</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' add main stems that the tributary contributes to. Note that the NHDPlus treats</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">21</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' divergences as part of the main stem, so the da_thresh may still be needed to</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">22</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' eliminate small tributary catchments introduced by divergences near confluences.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">23</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">24</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param post_mortem_file rda file to dump environment to in case of error</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">25</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">26</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @details This function operates on the catchment network as a node-edge graph.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">27</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' The outlet types are required to ensure that graph searches start from the</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">28</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' appropriate nodes and includes the appropriate catchments. Outlets such as gages</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">29</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' should be treated as "outlet" outlets.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">30</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' While it may be possible for the algorithm to determine terminal outlets, at this</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">31</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' time, it is required that they be specified explicitely as "terminal" outlet types.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">32</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">33</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' The function checks supplied outlets to make sure they connect downstream. Checks</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">34</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' verify that the outlet of the levelpath (main stem of a total catchment) of each</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">35</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' supplied outlet is</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">36</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' in the supplied outlet set. If the outlet of a levelpath is not in the supplied set, it</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">37</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' is added along with other catchments that contribute to the same receiving catchment.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">38</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' These checks ensure that all output catchments have one and only one input and output</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">39</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' nexus and that all catchments are well-connected.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">40</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">41</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @export</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">42</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @importFrom sf st_is_empty st_drop_geometry</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">43</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @importFrom dplyr filter mutate left_join select distinct case_when bind_rows slice_min</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">44</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @examples</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">45</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' source(system.file("extdata", "walker_data.R", package = "nhdplusTools"))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">46</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">47</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' fline &lt;- dplyr::right_join(dplyr::select(walker_flowline, COMID),</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">48</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'                            nhdplusTools::prepare_nhdplus(walker_flowline, 0, 0, 0, FALSE))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">49</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">50</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' fline &lt;- dplyr::select(fline, ID = COMID, toID = toCOMID,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">51</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'                        LevelPathID = LevelPathI, Hydroseq)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">52</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">53</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' outlets &lt;- data.frame(ID = c(5329357, 5329317, 5329365, 5329303, 5329435, 5329817),</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">54</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'                       type = c("outlet", "outlet", "outlet", "terminal", "outlet", "outlet"),</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">55</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'                       stringsAsFactors = FALSE)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">56</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">57</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' aggregated &lt;- aggregate_network(fline, outlets)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">58</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">59</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' aggregated &lt;- aggregate_network(fline, outlets)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">60</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">61</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' outlets &lt;- dplyr::filter(fline, ID %in% outlets$ID)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">62</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">63</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' outlets &lt;- nhdplusTools::get_node(outlets)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">64</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">65</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' plot(aggregated$fline_sets$geom, lwd = 3, col = "red")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">66</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' plot(walker_flowline$geom, lwd = .7, col = "blue", add = TRUE)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">67</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' plot(outlets$geometry, add = TRUE)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">68</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">69</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">70</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">aggregate_network &lt;- function(flowpath, outlets,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">71</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                              da_thresh = NA, only_larger = FALSE,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">72</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                              post_mortem_file = NA) {</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">73</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">74</td>
                    <td class="coverage">15<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  flowpath &lt;- validate_flowpath(flowpath, outlets, post_mortem_file)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">75</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">76</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # makes sure outlets connect</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">77</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  outlets &lt;- make_outlets_valid(outlets, drop_geometry(flowpath),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">78</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                da_thresh = da_thresh,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">79</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                only_larger = only_larger) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">80</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    sort_outlets(flowpath)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">81</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">82</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  fline_sets &lt;- get_catchment_sets(flowpath, outlets)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">83</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">84</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  #set should be the _new_ ID, ID should be the _old_ ID</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">85</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  cat_sets &lt;- fline_sets[[2]]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">86</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">87</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  fline_sets &lt;- fline_sets[[1]]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">88</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">89</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # create long form ID to set member list</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">90</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # OK to assume since Hydroseq is required in validate flowpath</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">91</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  sets &lt;- unnest_flines(fline_sets, "set") %&gt;% </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">92</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    left_join(select(drop_geometry(flowpath), </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">93</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                     toSet = .data$toID,  .data$ID, .data$Hydroseq, .data$LevelPathID), </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">94</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">              by = c("set" = "ID")) </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">95</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">96</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # Figure out what the ID of the downstream catchment is.</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">97</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  next_id = sets %&gt;% </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">98</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    group_by(.data$ID) %&gt;% </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">99</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    #LEVERAGE PRE SORT! </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">100</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    slice_min(.data$Hydroseq) %&gt;% </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">101</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    ungroup() %&gt;% </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">102</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    select(.data$ID, .data$toSet, .data$set, .data$LevelPathID) %&gt;% </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">103</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    left_join(select(sets, toID = .data$ID,  .data$set), by = c("toSet" = "set")) %&gt;% </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">104</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    select(.data$ID, .data$toID)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">105</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">106</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">107</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if(inherits(flowpath, "sf")) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">108</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    fline_sets &lt;- select(sets, .data$set, .data$ID, .data$LevelPathID) %&gt;% </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">109</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      left_join(select(flowpath, .data$ID), by = c("set" = "ID")) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">110</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      st_as_sf() %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">111</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      filter(!st_is_empty(.)) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">112</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      union_linestrings(ID = "ID") %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">113</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      left_join(next_id, by = "ID") %&gt;% </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">114</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      left_join(fline_sets, by = "ID")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">115</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  } else {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">116</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    fline_sets =  left_join(fline_sets, next_id, by = "ID")  %&gt;% </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">117</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      left_join(distinct(select(sets, .data$ID, .data$LevelPathID)), by = "ID")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">118</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">119</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">120</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  cat_sets   &lt;- left_join(cat_sets, next_id, by = "ID")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">121</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">122</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  return(list(cat_sets = cat_sets, fline_sets = fline_sets))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">123</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">124</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">125</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">validate_flowpath &lt;- function(flowpath, outlets, post_mortem_file) {</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">126</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">127</td>
                    <td class="coverage">15<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  flowpath &lt;- check_names(flowpath, "aggregate_network")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">128</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">129</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (any(!outlets$ID %in% flowpath$ID)) stop("Outlet IDs must all be in flowpaths.")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">130</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">131</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  flowpath$toID[is.na(flowpath$toID)] &lt;- 0</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">132</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">133</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (any(flowpath$toID[flowpath$ID %in% outlets[outlets$type == "terminal", ]$ID] != 0)) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">134</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if(!is.na(post_mortem_file)) save(list = ls(), file = post_mortem_file)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">135</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    stop("Terminal paths must have an NA or 0 toID")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">136</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">137</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">138</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  flowpath$toID &lt;- methods::as(flowpath$toID, class(flowpath$ID))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">139</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">140</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  return(flowpath)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">141</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">142</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">143</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">get_lps &lt;- function(flowpath) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">144</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  flowpath &lt;- drop_geometry(flowpath) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">145</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    select(.data$ID, .data$LevelPathID, .data$Hydroseq) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">146</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    group_by(.data$LevelPathID)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">147</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">148</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  headwaters &lt;- filter(flowpath, .data$Hydroseq == max(.data$Hydroseq)) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">149</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    ungroup()</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">150</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">151</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  outlets &lt;- filter(flowpath, .data$Hydroseq == min(.data$Hydroseq)) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">152</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    ungroup()</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">153</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">154</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  left_join(ungroup(flowpath), select(headwaters, head_ID = .data$ID, .data$LevelPathID),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">155</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">            by = "LevelPathID") %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">156</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    left_join(select(outlets, tail_ID = .data$ID, .data$LevelPathID),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">157</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">              by = "LevelPathID")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">158</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">159</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">160</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"># Get the levelpath outlet IDs for each of the input outlets.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">161</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">get_outlets &lt;- function(outlets, lps) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">162</td>
                    <td class="coverage">193<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  distinct(left_join(outlets,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">163</td>
                    <td class="coverage">193<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                     select(lps, .data$ID, .data$LevelPathID, .data$tail_ID),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">164</td>
                    <td class="coverage">193<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                     by = "ID"))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">165</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">166</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">167</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"># Adds everything that contributes the same recieving catchment as a given tail id.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">168</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">fix_nexus &lt;- function(flowpath, tail_id, da_thresh = NA, only_larger = FALSE) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">169</td>
                    <td class="coverage">285<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  tail &lt;- filter(flowpath, .data$ID == tail_id)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">170</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">171</td>
                    <td class="coverage">285<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  add &lt;- filter(flowpath, .data$toID == tail$toID)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">172</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">173</td>
                    <td class="coverage">285<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (only_larger) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">174</td>
                    <td class="coverage">219<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    add &lt;- filter(add, .data$LevelPathID &lt;= tail$LevelPathID)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">175</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">176</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">177</td>
                    <td class="coverage">285<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (!is.na(da_thresh)) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">178</td>
                    <td class="coverage">213<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    add &lt;- filter(add, .data$TotDASqKM &gt; da_thresh)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">179</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">180</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # Can add functionality here to filter which Add IDs to include.</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">181</td>
                    <td class="coverage">285<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  add_ids &lt;- add$ID</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">182</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">183</td>
                    <td class="coverage">285<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  data.frame(ID = add_ids,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">184</td>
                    <td class="coverage">285<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">             type = rep("outlet",</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">185</td>
                    <td class="coverage">285<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                        length(add_ids)),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">186</td>
                    <td class="coverage">285<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">             stringsAsFactors = FALSE)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">187</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">188</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">189</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">apply_fix_nexus &lt;- function(bad_id, flowpath, da_thresh, only_larger) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">190</td>
                    <td class="coverage">26<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  bind_rows(</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">191</td>
                    <td class="coverage">26<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    lapply(bad_id,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">192</td>
                    <td class="coverage">26<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">           function(bad_tail_id,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">193</td>
                    <td class="coverage">26<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                    flowpath,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">194</td>
                    <td class="coverage">26<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                    da_thresh,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">195</td>
                    <td class="coverage">26<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                    only_larger) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">196</td>
                    <td class="coverage">146<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">             fix_nexus(flowpath, bad_tail_id,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">197</td>
                    <td class="coverage">146<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                       da_thresh, only_larger)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">198</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">           },</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">199</td>
                    <td class="coverage">26<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">           flowpath = flowpath,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">200</td>
                    <td class="coverage">26<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">           da_thresh = da_thresh,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">201</td>
                    <td class="coverage">26<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">           only_larger = only_larger))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">202</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">203</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">204</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">fix_tail &lt;- function(flowpath, outlets, toid_tail_id, da_thresh = NA, only_larger = FALSE) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">205</td>
                    <td class="coverage">139<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  potential_add &lt;- fix_nexus(flowpath, toid_tail_id, da_thresh, only_larger)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">206</td>
                    <td class="coverage">139<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  new &lt;- !potential_add$ID %in% outlets$ID</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">207</td>
                    <td class="coverage">139<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  potential_add[new, ]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">208</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">209</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">210</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @description Given a set of outlets, works downstream adding outlets at the</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">211</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' outlet of each level path. This makes sure catchments get inserted so an upstream</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">212</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' catchment doesn't get orphaned in the middle of a larger catchment.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">213</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param outlets the outlet list of gages, etc.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">214</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param flowpath the reconciled flowline network</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">215</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @importFrom dplyr filter distinct select left_join group_by mutate</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">216</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @noRd</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">217</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">make_outlets_valid &lt;- function(outlets, flowpath,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">218</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                               da_thresh = NA, only_larger = FALSE) {</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">219</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">220</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  outlets$ID &lt;- methods::as(outlets$ID, class(flowpath$ID))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">221</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">222</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # Finds levelpaths and their unique head and outlet</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">223</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  lps &lt;- get_lps(drop_geometry(flowpath))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">224</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">225</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # Need to check if outlets are on levelpath tails and add</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">226</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # required additional outlets.</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">227</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  outlets &lt;- bind_rows(</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">228</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    outlets,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">229</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    apply_fix_nexus(filter(get_outlets(outlets, lps),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">230</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                           .data$ID == .data$tail_ID)$ID,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">231</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                    flowpath, da_thresh, only_larger)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">232</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  )</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">233</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">234</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # deduplicate outlets.</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">235</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  outlets &lt;- distinct(outlets) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">236</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    group_by(.data$ID) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">237</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    filter(!(n() &gt; 1 &amp; # this removes outlets that duplicate terminals.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">238</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">               # they can be added in the above outlets check.</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">239</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">               .data$type == "outlet")) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">240</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    ungroup()</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">241</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">242</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  otl &lt;- get_outlets(outlets, lps)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">243</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">244</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  count_while &lt;- 0</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">245</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">246</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  while (!all(otl$tail_ID %in% otl$ID)) {</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">247</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">248</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    bad_tail &lt;- otl$tail_ID[which(!otl$tail_ID %in% otl$ID)]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">249</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">250</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    message(paste("Fixing", length(bad_tail), "missing outlets."))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">251</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">252</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    outlets &lt;- dplyr::bind_rows(</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">253</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      outlets,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">254</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      apply_fix_nexus(bad_tail,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">255</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                      flowpath, da_thresh, only_larger)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">256</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    )</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">257</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">258</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    otl &lt;- get_outlets(outlets, lps)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">259</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">260</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    count_while &lt;- count_while + 1</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">261</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">262</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (count_while &gt; 20) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">263</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      stop("Stuck in a while loop trying to fix disconnected outlets. Reduce drainage area threshold?")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">264</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">265</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">266</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">267</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # Need to check that a "next down tributary" in the outlet set has a break along the</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">268</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # main stem that each outlet contributes to.</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">269</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  otl &lt;- left_join(otl, select(drop_geometry(flowpath),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">270</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                               .data$ID, .data$toID), by = "ID") %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">271</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    left_join(select(lps, .data$ID,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">272</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                     toID_hydroseq = .data$Hydroseq,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">273</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                     toID_tail_ID = .data$tail_ID,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">274</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                     toID_LevelpathID = .data$LevelPathID),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">275</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">              by = c("toID" = "ID"))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">276</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">277</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # this grabs the most downstream if duplicates were generated.</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">278</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  otl &lt;- group_by(otl, .data$ID) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">279</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    filter(.data$toID_hydroseq == min(.data$toID_hydroseq)) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">280</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    ungroup() %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">281</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    # This eliminates groups where only one thing goes to a given tail_ID.</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">282</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    group_by(.data$toID_tail_ID) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">283</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    filter(n() &gt; 1) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">284</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    ungroup()</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">285</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">286</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # This grabs all the inflows to the nexus that each of these outlets is at.</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">287</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  otl &lt;- left_join(otl, select(drop_geometry(flowpath),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">288</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                               toID_fromID = .data$ID, .data$toID),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">289</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                   by = "toID") %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">290</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    mutate(type = "add_outlet")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">291</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">292</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (!is.na(da_thresh)) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">293</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    otl &lt;- left_join(otl, select(drop_geometry(flowpath),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">294</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                 .data$ID, toID_fromID_TotDASqKM = .data$TotDASqKM),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">295</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                     by = c("toID_fromID" = "ID")) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">296</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      filter(.data$toID_fromID_TotDASqKM &gt; da_thresh)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">297</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">298</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">299</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (only_larger) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">300</td>
                    <td class="coverage">5<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    otl &lt;- left_join(otl, select(drop_geometry(flowpath),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">301</td>
                    <td class="coverage">5<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                 .data$ID, toID_fromID_lp = .data$LevelPathID),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">302</td>
                    <td class="coverage">5<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                     by = c("toID_fromID" = "ID")) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">303</td>
                    <td class="coverage">5<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      filter(.data$toID_fromID_lp &lt;= .data$toID_LevelpathID)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">304</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">305</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">306</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  otl &lt;- otl %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">307</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    select(ID = .data$toID_fromID, .data$type,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">308</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">           LevelPathID = .data$toID_LevelpathID, .data$tail_ID) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">309</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    distinct()</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">310</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">311</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # Need to verify that all ID == tail_ID instances are connected.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">312</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # They might have been missed above.</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">313</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (any(grepl("add_outlet", otl$type))) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">314</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    otl$type &lt;- "outlet"</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">315</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    outlets &lt;- distinct(rbind(outlets, otl[, c("ID", "type")]))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">316</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">317</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">318</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  otl &lt;- get_outlets(outlets, lps)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">319</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  tail_outlets &lt;- which(otl$ID == otl$tail_ID &amp; otl$type != "terminal")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">320</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">321</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  for (check in seq_along(tail_outlets)) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">322</td>
                    <td class="coverage">139<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    outlets &lt;- rbind(outlets,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">323</td>
                    <td class="coverage">139<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                     fix_tail(flowpath, outlets, otl$ID[check],</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">324</td>
                    <td class="coverage">139<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                              da_thresh = da_thresh, only_larger = only_larger))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">325</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">326</td>
                    <td class="coverage">139<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    connected &lt;- FALSE</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">327</td>
                    <td class="coverage">139<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    while (!connected) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">328</td>
                    <td class="coverage">139<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      toid &lt;- filter(flowpath, .data$ID == otl[["ID"]][check])$toID</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">329</td>
                    <td class="coverage">139<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      toid_tail_id &lt;- filter(lps, .data$ID == toid)[["tail_ID"]]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">330</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">331</td>
                    <td class="coverage">139<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if (!all(toid_tail_id %in% otl$tail_ID)) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">332</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">        outlets &lt;- rbind(outlets,</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">333</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">                         fix_tail(flowpath, outlets, unique(toid_tail_id),</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">334</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                  da_thresh = da_thresh, only_larger = only_larger))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">335</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      } else {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">336</td>
                    <td class="coverage">139<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        connected &lt;- TRUE</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">337</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">338</td>
                    <td class="coverage">139<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      otl &lt;- get_outlets(outlets, lps)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">339</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">340</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">341</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">342</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  return(outlets)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">343</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">344</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">345</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">sort_outlets &lt;- function(outlets, flowpath) {</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">346</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # set toID to negative the ID for terminals that are not 0.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">347</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # This is important to make sure that all outlet nexues have a unique ID</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">348</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # as opposed to 0 or na. This is meangful when sorting the graph</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">349</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  flowpath$toNexID &lt;- ifelse(flowpath$toID == 0, -flowpath$ID, flowpath$toID)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">350</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">351</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # this is a little awkward and nuanced -- read comments carefully.</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">352</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  outlets &lt;- outlets %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">353</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    # the nexID_stem is just the catchment identifier. Conceptually,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">354</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    # this is the identifier for the nearest upstream nexus from an outlet.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">355</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    # We have to use this identifier for an outlet along the flowpath</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">356</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    # of a catchment. It can be the same as the catchment because we are</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">357</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    # working with a dendritic assumption so each nexus has one and only</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">358</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    # one downstream catchment. Otherwise, we would have to treat things a</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">359</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    # bit differently.</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">360</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    mutate(nexID_stem = .data$ID) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">361</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    # the nexID_terminal is the  to nexus of the terminal flowpath.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">362</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    # We need to treat this differently because an outlet of type</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">363</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    # "terminal" must be downstream of all other outlets. Without a</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">364</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    # unique nexus ID like this, we can not be gaurunteed a sort</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">365</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    # order that will work correctly.</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">366</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    left_join(select(drop_geometry(flowpath), .data$ID,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">367</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                     nexID_terminal = .data$toNexID), by = "ID") %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">368</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    # Now we can set the nexID (which is used to sort the outlets) appropriately.</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">369</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    mutate(</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">370</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      nexID = case_when(</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">371</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        type == "outlet" ~ .data$nexID_stem,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">372</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        type == "terminal" ~ .data$nexID_terminal</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">373</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      )</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">374</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    ) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">375</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    select(.data$ID, .data$type, .data$nexID) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">376</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    distinct()</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">377</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">378</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  fp_sort &lt;- nhdplusTools::get_sorted(drop_geometry(select(flowpath, .data$ID, .data$toNexID)))$ID</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">379</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">380</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  fp_sort &lt;- c(fp_sort, flowpath$toNexID[flowpath$toNexID &lt; 0])</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">381</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">382</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  fp_sort &lt;- fp_sort[fp_sort %in% outlets$nexID]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">383</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">384</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  left_join(data.frame(nexID = as.numeric(fp_sort)), outlets, by = "nexID") %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">385</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    select(-.data$nexID)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">386</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">387</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">388</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">prep_flowpath &lt;- function(flowpath) {</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">389</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # flowpath &lt;- drop_geometry(flowpath)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">390</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">391</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # Make sure flowpath is sorted correctly</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">392</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  flowpath &lt;- arrange(flowpath, desc(Hydroseq))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">393</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">394</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # do a little indirection with index ids</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">395</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  flowpath$toid &lt;- match(flowpath$toID, flowpath$ID)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">396</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  flowpath$id &lt;- seq(1, nrow(flowpath))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">397</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">398</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  flowpath</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">399</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">400</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">401</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">prep_outlets &lt;- function(outlets, flowpath) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">402</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  outlets &lt;- left_join(outlets, select(flowpath, .data$ID, .data$id), by = "ID")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">403</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  outlets$set &lt;- 1:nrow(outlets)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">404</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  outlets</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">405</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">406</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">407</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">get_heads &lt;- function(flowpath) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">408</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  flowpath$id[!flowpath$id %in% flowpath$toid]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">409</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">410</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">411</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"># need a little network walker function.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">412</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">get_dwn &lt;- function(ID, toid) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">413</td>
                    <td class="coverage">25521<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  next_dn &lt;- toid[ID]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">414</td>
                    <td class="coverage">25521<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if(is.na(next_dn)) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">415</td>
                    <td class="coverage">3537<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    return(ID)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">416</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  } else {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">417</td>
                    <td class="coverage">21984<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    return(c(ID, get_dwn(next_dn, toid)))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">418</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">419</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">420</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">421</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">my_combine &lt;- function(old, new) {</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">422</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # can optimize later</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">423</td>
                    <td class="coverage">4126<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if(identical(old, list())) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">424</td>
                    <td class="coverage">608<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    new</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">425</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  } else {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">426</td>
                    <td class="coverage">3518<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    c(old, new)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">427</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">428</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">429</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">430</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">unnest_flines &lt;- function(x, col = "set") {</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">431</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">432</td>
                    <td class="coverage">29<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  times &lt;- lengths(x[[col]])</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">433</td>
                    <td class="coverage">29<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  base_names &lt;- names(x)[!names(x) == col]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">434</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">435</td>
                    <td class="coverage">29<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  out &lt;- as.data.frame(cbind(sapply(base_names, function(n) rep(x[[n]], times = times))))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">436</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">437</td>
                    <td class="coverage">29<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  names(out) &lt;- base_names</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">438</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">439</td>
                    <td class="coverage">29<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  out[[col]] &lt;- unlist(x[[col]])</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">440</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">441</td>
                    <td class="coverage">29<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  out</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">442</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">443</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">444</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">get_catchment_sets &lt;- function(flowpath, outlets) {</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">445</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">446</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  fline_sets &lt;- data.frame(ID = outlets$ID,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">447</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                           set = I(rep(list(list()), nrow(outlets))))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">448</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">449</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  cat_sets &lt;- data.frame(ID = outlets$ID,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">450</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                         set = I(rep(list(list()), nrow(outlets))))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">451</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">452</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  flowpath &lt;- prep_flowpath(flowpath)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">453</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">454</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  outlets &lt;- prep_outlets(outlets, flowpath)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">455</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">456</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # We'll start at all these</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">457</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  heads &lt;- get_heads(flowpath)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">458</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">459</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # We can stop once these conditions have been met.</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">460</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  outlet_count &lt;- nrow(outlets)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">461</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  headwater_count &lt;- length(heads)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">462</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">463</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  message(paste("Running", headwater_count, "headwaters for",</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">464</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                outlet_count, "outlets."))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">465</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">466</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # Set up counters for the while loop</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">467</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  o_c &lt;- 1</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">468</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  h_c &lt;- 1</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">469</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">470</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  while(h_c &lt;= headwater_count) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">471</td>
                    <td class="coverage">3537<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    head &lt;- heads[h_c]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">472</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">473</td>
                    <td class="coverage">3537<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    path &lt;- get_dwn(head, flowpath$toid)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">474</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">475</td>
                    <td class="coverage">3537<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    sets &lt;- outlets$id %in% path</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">476</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">477</td>
                    <td class="coverage">3537<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    breaks &lt;- outlets[sets, ]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">478</td>
                    <td class="coverage">3537<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    nr_breaks &lt;- nrow(breaks)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">479</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">480</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    # If this path only goes to one outlet, it is within an aggregate</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">481</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    ## do nothing. Or maybe we can use this for aggregation later?</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">482</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    # If this path goes through more than one outlet, it contains flowpaths.</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">483</td>
                    <td class="coverage">3537<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if(nr_breaks &gt; 1) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">484</td>
                    <td class="coverage">241<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      paths &lt;- split(path,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">485</td>
                    <td class="coverage">241<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                     cut(path,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">486</td>
                    <td class="coverage">241<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                         breaks = c(0, breaks$id),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">487</td>
                    <td class="coverage">241<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                         labels = c(breaks$set)))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">488</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">489</td>
                    <td class="coverage">241<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      cat_sets$set[as.integer(names(paths))] &lt;-</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">490</td>
                    <td class="coverage">241<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        lapply(names(paths), function(x) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">491</td>
                    <td class="coverage">830<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          my_combine(cat_sets$set[as.integer(x)][[1]],</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">492</td>
                    <td class="coverage">830<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                     flowpath$ID[paths[x][[1]]])</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">493</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        })</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">494</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">495</td>
                    <td class="coverage">241<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      path_outlets &lt;- sapply(paths, function(x) x[length(x)])</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">496</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">497</td>
                    <td class="coverage">241<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      flowpath$toid[path_outlets] &lt;- NA</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">498</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">499</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      # the top one isn't useful for mainstems.</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">500</td>
                    <td class="coverage">241<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      paths &lt;- paths[2:length(paths)]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">501</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">502</td>
                    <td class="coverage">241<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      fline_sets$set[as.integer(names(paths))] &lt;-</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">503</td>
                    <td class="coverage">241<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        lapply(paths, function(x) flowpath$ID[x])</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">504</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">505</td>
                    <td class="coverage">241<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      o_c &lt;- o_c + (nr_breaks - 1)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">506</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">507</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    } else {</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">508</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">509</td>
                    <td class="coverage">3296<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      outlet &lt;- outlets[outlets$id == path[length(path)], ]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">510</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">511</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      # I think this can be added tothe flowpath finding for free</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">512</td>
                    <td class="coverage">3296<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      cat_sets$set[outlet$set][[1]] &lt;- my_combine(cat_sets$set[outlet$set][[1]],</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">513</td>
                    <td class="coverage">3296<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                                  flowpath$ID[path])</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">514</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">515</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">516</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">517</td>
                    <td class="coverage">3537<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    h_c &lt;- h_c + 1</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">518</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">519</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if(h_c %% 1000 == 0) message(paste(h_c, "of", headwater_count))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">520</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">521</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">522</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">523</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  set_length &lt;- lengths(fline_sets$set)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">524</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">525</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  head_outlets &lt;- outlets[set_length == 0, ] %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">526</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    left_join(distinct(select(flowpath, LevelPathID, ID, Hydroseq)), by = "ID") %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">527</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    select(LevelPathID, set, head_out_Hydroseq = Hydroseq)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">528</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">529</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  head_paths &lt;- filter(flowpath, LevelPathID %in% head_outlets$LevelPathID) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">530</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    left_join(head_outlets, by = "LevelPathID") %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">531</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    filter(Hydroseq &gt;= .data$head_out_Hydroseq) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">532</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    select(ID, set) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">533</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    group_by(set) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">534</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    summarise(ID = list(ID))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">535</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">536</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  fline_sets$set[head_paths$set] &lt;- head_paths$ID</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">537</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">538</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  cat_sets$set &lt;- lapply(cat_sets$set, function(x) unique(x))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">539</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">540</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  list(fline_sets, cat_sets)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">541</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">542</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">543</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' Get Minimal Network</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">544</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @description Given a set of outlets, will generate a minimal network by</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">545</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' calling \code{\link{aggregate_network}} and adding nhdplus attributes to the result.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">546</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">547</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' If geometry is included with the network, it will be merged and returned.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">548</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">549</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @inheritParams aggregate_network</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">550</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param flowpath sf data.frame Flowpaths with ID, toID, LevelPathID, </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">551</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' Hydroseq and LENGTHKM and AreaSqKM attributes.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">552</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">553</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @return a data.frame (potentially including an sfc list column) with</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">554</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' attributes generated by \code{\link[nhdplusTools]{add_plus_network_attributes}}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">555</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' and a list column "set" containing members of each output flowpath.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">556</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @importFrom nhdplusTools add_plus_network_attributes</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">557</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @export</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">558</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @examples</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">559</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' source(system.file("extdata", "walker_data.R", package = "nhdplusTools"))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">560</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' fline &lt;- walker_flowline</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">561</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">562</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' outlets &lt;- data.frame(ID = c(5329357, 5329317, 5329365, 5329435, 5329817),</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">563</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'                       type = c("outlet", "outlet", "outlet", "outlet", "outlet"))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">564</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">565</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' #' Add toCOMID</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">566</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' fline &lt;- nhdplusTools::get_tocomid(fline, add = TRUE)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">567</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">568</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' # get attributes set</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">569</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' fline &lt;- dplyr::select(fline, ID = comid, toID = tocomid,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">570</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'                        LevelPathID = levelpathi, hydroseq = hydroseq,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">571</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'                        AreaSqKM = areasqkm, LENGTHKM = lengthkm)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">572</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">573</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' min_net &lt;- get_minimal_network(fline, outlets)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">574</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">575</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' plot(sf::st_geometry(fline), col = "blue")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">576</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' plot(sf::st_geometry(min_net), lwd = 2, add = TRUE)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">577</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' plot(sf::st_geometry(nhdplusTools::get_node(min_net)), add = TRUE)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">578</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">579</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">get_minimal_network &lt;- function(flowpath, outlets) {</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">580</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">581</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  flowpath &lt;- check_names(flowpath, "get_minimal_network")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">582</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">583</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  flowpath_sort &lt;- left_join(</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">584</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    data.frame(ID = flowpath$ID),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">585</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    nhdplusTools::get_sorted(flowpath[, c("ID", "toID"), drop = TRUE],</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">586</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                             split = TRUE), by = "ID")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">587</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">588</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  terminal_paths &lt;- unique(flowpath_sort$terminalID[flowpath_sort$ID %in% outlets$ID])</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">589</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">590</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # Grab terminal paths that matter and combine with outlets.</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">591</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  outlets &lt;- rbind(outlets,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">592</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                   data.frame(ID = terminal_paths,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">593</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                              type = "terminal"))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">594</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">595</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  flowpath &lt;- flowpath[flowpath_sort$terminalID %in% terminal_paths, ]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">596</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">597</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  minimal &lt;- aggregate_network(</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">598</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    flowpath, </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">599</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    outlets = dplyr::filter(outlets, .data$ID %in% flowpath$ID),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">600</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    da_thresh = NA, only_larger = TRUE)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">601</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">602</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  min_net &lt;- unnest_flines(select(drop_geometry(minimal$fline_sets), -LevelPathID)) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">603</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    left_join(select(flowpath, .data$ID, .data$LENGTHKM,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">604</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                     .data$AreaSqKM, .data$LevelPathID),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">605</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">              by = c("set" = "ID")) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">606</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    group_by(ID) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">607</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    summarise(toID = .data$toID[1],</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">608</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">              lengthkm = sum(.data$LENGTHKM),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">609</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">              areasqkm = sum(.data$AreaSqKM),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">610</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">              outlet_levelpath = min(.data$LevelPathID)) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">611</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    mutate(toID = ifelse(is.na(.data$toID), 0, .data$toID)) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">612</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    rename(comid = .data$ID,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">613</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">           tocomid = .data$toID,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">614</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">           nameID = .data$outlet_levelpath)%&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">615</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    add_plus_network_attributes() %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">616</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    rename(ID = .data$comid, toID = .data$tocomid,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">617</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">           outlet_nhdpv2_levelpath = .data$nameID,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">618</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">           arbolate_sum = .data$weight) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">619</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    left_join(select(minimal$fline_sets, .data$ID, .data$set),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">620</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                       by = "ID")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">621</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">622</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if(inherits(minimal$fline_sets, "sf")) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">623</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    sf::st_sf(min_net)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">624</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  } else {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">625</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    min_net</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">626</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">627</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div id="R/refactor_nhdplus.R" class="hidden">
              <table class="table-condensed">
                <tbody>
                  <tr class="never">
                    <td class="num">1</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @title Refactor NHDPlus</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">2</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @description A complete network refactor workflow has been packaged</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">3</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' into this function. Builds a set of normalized catchment-flowpaths from</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">4</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' input flowline features. See details and vignettes for more information.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">5</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param nhdplus_flines data.frame raw nhdplus flowline features as</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">6</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' derived from the national seamless geodatabase.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">7</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param split_flines_meters numeric the maximum length flowpath desired</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">8</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' in the output.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">9</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param split_flines_cores numeric the number of processing cores to use</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">10</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' while splitting flowlines.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">11</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param collapse_flines_meters numeric the minimum length of</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">12</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' inter-confluence flowpath desired in the output.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">13</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param collapse_flines_main_meters numeric the minimum length of</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">14</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' between-confluence flowpaths.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">15</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param out_refactored character where to write a geopackage containing</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">16</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' the split and collapsed flowlines.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">17</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param out_reconciled character where to write a geopackage containing</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">18</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' the reconciled flowpaths.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">19</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param three_pass boolean whether to perform a three pass collapse or</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">20</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' single pass.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">21</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param purge_non_dendritic boolean passed on to prepare_nhdplus</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">22</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param exclude_cats integer vector of COMIDs to be excluded from collapse modifications.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">23</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param events data.frame containing events as generated by nhdplusTools::get_flowline_index() </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">24</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param warn boolean controls whether warning an status messages are printed</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">25</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @details This is a convenient wrapper function that implements three phases</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">26</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' of the network refactor workflow: split, collapse, reconcile. See the</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">27</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' NHDPlus Refactor vignette for details of these three steps by running:</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">28</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' \code{vignette("refactor_nhdplus", package = "hyRefactor")}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">29</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @seealso</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">30</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' In addition to `prepare_nhdplus` from the nhdplusTools package,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">31</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' The following three functions are used in the `refactor_nhdplus` workflow.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">32</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' \enumerate{</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">33</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'   \item \code{\link{split_flowlines}}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">34</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'   \item \code{\link{collapse_flowlines}}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">35</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'   \item \code{\link{reconcile_collapsed_flowlines}}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">36</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">37</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @export</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">38</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @importFrom nhdplusTools prepare_nhdplus</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">39</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @examples</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">40</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' source(system.file("extdata",</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">41</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'                    "sample_flines.R",</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">42</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'                    package = "nhdplusTools"))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">43</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">44</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' nhdplus_flowlines &lt;- sf::st_zm(sample_flines)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">45</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">46</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' refactor_nhdplus(nhdplus_flines = nhdplus_flowlines,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">47</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'                  split_flines_meters = 2000,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">48</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'                  split_flines_cores = 2,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">49</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'                  collapse_flines_meters = 500,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">50</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'                  collapse_flines_main_meters = 500,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">51</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'                  out_refactored = "temp.gpkg",</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">52</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'                  out_reconciled = "temp_rec.gpkg",</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">53</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'                  three_pass = TRUE,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">54</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'                  purge_non_dendritic = FALSE,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">55</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'                  warn = FALSE)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">56</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'                  </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">57</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' unlink("temp.gpkg")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">58</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' unlink("temp_rec.gpkg")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">59</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">60</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">refactor_nhdplus &lt;- function(nhdplus_flines,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">61</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                             split_flines_meters,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">62</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                             split_flines_cores,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">63</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                             collapse_flines_meters,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">64</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                             collapse_flines_main_meters,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">65</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                             out_refactored,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">66</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                             out_reconciled,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">67</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                             three_pass = FALSE,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">68</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                             purge_non_dendritic = TRUE,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">69</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                             exclude_cats = NULL,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">70</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                             events = NULL,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">71</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                             warn = TRUE) {</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">72</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">73</td>
                    <td class="coverage">8<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if ("FTYPE" %in% names(nhdplus_flines)) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">74</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    nhdplus_flines &lt;- dplyr::inner_join(</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">75</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      select(sf::st_zm(nhdplus_flines), COMID, REACHCODE, FromMeas, ToMeas),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">76</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      sf::st_drop_geometry(nhdplus_flines) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">77</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        nhdplusTools::prepare_nhdplus(0, 0, 0, purge_non_dendritic = purge_non_dendritic,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">78</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                        warn = warn), by = "COMID") %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">79</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      sf::st_as_sf()</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">80</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">81</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">82</td>
                    <td class="coverage">8<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  in_proj &lt;- sf::st_crs(nhdplus_flines)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">83</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">84</td>
                    <td class="coverage">8<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  flines &lt;- nhdplus_flines %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">85</td>
                    <td class="coverage">8<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    sf::st_cast("LINESTRING", warn = warn) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">86</td>
                    <td class="coverage">8<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    sf::st_transform(5070) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">87</td>
                    <td class="coverage">8<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    split_flowlines(split_flines_meters, para = split_flines_cores, </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">88</td>
                    <td class="coverage">8<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                    avoid = exclude_cats, events = events)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">89</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">90</td>
                    <td class="coverage">8<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  rm(nhdplus_flines)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">91</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">92</td>
                    <td class="coverage">8<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (warn) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">93</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    message("flowlines split complete, collapsing")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">94</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">95</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">96</td>
                    <td class="coverage">8<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  exclude_cats &lt;- c(exclude_cats, dplyr::filter(flines, !is.na(event_REACH_meas))$COMID,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">97</td>
                    <td class="coverage">8<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                    dplyr::filter(flines, !is.na(event_REACH_meas))$toCOMID)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">98</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">99</td>
                    <td class="coverage">8<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (three_pass) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">100</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    collapsed_flines &lt;-</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">101</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      collapse_flowlines(sf::st_set_geometry(flines, NULL),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">102</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                         (0.25 * collapse_flines_meters / 1000),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">103</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                         TRUE,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">104</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                         (0.25 * collapse_flines_main_meters / 1000),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">105</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                         exclude_cats)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">106</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">107</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    collapsed_flines &lt;-</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">108</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      collapse_flowlines(collapsed_flines,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">109</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                         (0.5 * collapse_flines_meters / 1000),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">110</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                         TRUE,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">111</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                         (0.5 * collapse_flines_main_meters / 1000),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">112</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                         exclude_cats,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">113</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                         warn = FALSE)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">114</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">115</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    collapsed_flines &lt;-</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">116</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      collapse_flowlines(collapsed_flines,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">117</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                         (collapse_flines_meters / 1000),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">118</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                         TRUE,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">119</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                         (collapse_flines_main_meters / 1000),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">120</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                         exclude_cats,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">121</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                         warn = FALSE)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">122</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  } else {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">123</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    collapsed_flines &lt;-</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">124</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      collapse_flowlines(sf::st_set_geometry(flines, NULL),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">125</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                         (collapse_flines_meters / 1000),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">126</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                         TRUE,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">127</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                         (collapse_flines_main_meters / 1000),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">128</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                         exclude_cats)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">129</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">130</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">131</td>
                    <td class="coverage">8<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  select(flines, COMID) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">132</td>
                    <td class="coverage">8<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    dplyr::inner_join(collapsed_flines, by = "COMID") %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">133</td>
                    <td class="coverage">8<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    sf::st_as_sf() %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">134</td>
                    <td class="coverage">8<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    sf::st_transform(in_proj) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">135</td>
                    <td class="coverage">8<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    sf::st_write(out_refactored, layer_options = "OVERWRITE=YES",</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">136</td>
                    <td class="coverage">8<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                 quiet = !warn)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">137</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">138</td>
                    <td class="coverage">8<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (warn) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">139</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    message("collapse complete, out collapse written to disk, reconciling")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">140</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">141</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">142</td>
                    <td class="coverage">8<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  collapsed &lt;- reconcile_collapsed_flowlines(collapsed_flines,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">143</td>
                    <td class="coverage">8<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                             select(flines, COMID),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">144</td>
                    <td class="coverage">8<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                             id = "COMID")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">145</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">146</td>
                    <td class="coverage">8<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  collapsed[["member_COMID"]] &lt;-</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">147</td>
                    <td class="coverage">8<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    unlist(lapply(collapsed$member_COMID,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">148</td>
                    <td class="coverage">8<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                  function(x) paste(x, collapse = ",")))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">149</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">150</td>
                    <td class="coverage">8<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  sf::st_write(sf::st_transform(collapsed, in_proj),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">151</td>
                    <td class="coverage">8<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">               out_reconciled,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">152</td>
                    <td class="coverage">8<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">               layer_options = "OVERWRITE=YES",</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">153</td>
                    <td class="coverage">8<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">               quiet = !warn)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">154</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div id="R/reconcile.R" class="hidden">
              <table class="table-condensed">
                <tbody>
                  <tr class="never">
                    <td class="num">1</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @title Reconcile Collapsed Flowlines</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">2</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @description Reconciles output of collapse_flowlines giving a unique ID to</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">3</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' each new flowpath and providing a mapping to NHDPlus COMIDs.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">4</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param flines data.frame with COMID, toCOMID, LENGTHKM, LevelPathI, Hydroseq,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">5</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' and TotDASqKM columns</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">6</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param geom sf data.frame for flines</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">7</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param id character id collumn name.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">8</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @return reconciled flowpaths with new ID, toID, LevelPathID, and Hydroseq identifiers.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">9</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' Note that all the identifiers are new integer IDs. LevelPathID and Hydroseq are consistent</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">10</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' with the LevelPathID and Hydroseq from the input NHDPlus flowlines.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">11</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @importFrom dplyr group_by ungroup filter left_join select rename</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">12</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' mutate distinct summarise arrange desc</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">13</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @seealso The \code{\link{refactor_nhdplus}} function implements a complete</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">14</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' workflow using `reconcile_collapsed_flowlines()`.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">15</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @export</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">16</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">17</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">reconcile_collapsed_flowlines &lt;- function(flines, geom = NULL, id = "COMID") {</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">18</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">19</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  check_names(flines, "reconcile_collapsed_flowlines")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">20</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">21</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  new_flines &lt;-</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">22</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    mutate(flines,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">23</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">           becomes =</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">24</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">             ifelse((is.na(.data$joined_fromCOMID) | .data$joined_fromCOMID == -9999),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">25</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                     ifelse((is.na(.data$joined_toCOMID) | .data$joined_toCOMID == -9999),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">26</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                            .data$COMID, .data$joined_toCOMID),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">27</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                    .data$joined_fromCOMID))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">28</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">29</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # In the case that something is first joined to then the thing it joins with joins from</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">30</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # we have to do a little reassignment.</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">31</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  joined_from &lt;- new_flines[new_flines$joined_fromCOMID %in% new_flines$becomes, ]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">32</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  joined_to   &lt;- new_flines[new_flines$joined_toCOMID %in% new_flines$becomes, ]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">33</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">34</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  joined_tofrom &lt;- joined_to[joined_to$becomes %in% joined_from$COMID, ]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">35</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">36</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  update_tofrom &lt;- left_join(select(joined_tofrom, .data$COMID, .data$becomes), </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">37</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                             select(joined_from, .data$COMID, new_becomes = .data$becomes), </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">38</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                             by = c("becomes" = "COMID"))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">39</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">40</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if(nrow(update_tofrom) &gt; 0) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">41</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    new_flines &lt;- left_join(new_flines, select(update_tofrom, .data$COMID, .data$new_becomes), by = "COMID") %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">42</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      mutate(becomes = ifelse(!is.na(.data$new_becomes), .data$new_becomes, .data$becomes)) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">43</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      select(-.data$new_becomes)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">44</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">45</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">46</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  new_flines &lt;- new_flines %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">47</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    group_by(.data$becomes) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">48</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    mutate(LENGTHKM = max(.data$LENGTHKM),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">49</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">           Hydroseq = min(.data$Hydroseq),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">50</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">           LevelPathI = min(.data$LevelPathI)) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">51</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    ungroup() %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">52</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    tidyr::separate(.data$COMID, c("orig_COMID", "part"),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">53</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                    sep = "\\.", remove = FALSE, fill = "right") %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">54</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    mutate(new_Hydroseq = ifelse(is.na(.data$part),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">55</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                 as.character(.data$Hydroseq),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">56</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                 paste(as.character(.data$Hydroseq),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">57</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                       part, sep = ".")),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">58</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">           part = ifelse(is.na(.data$part), "0", part)) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">59</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    ungroup() %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">60</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    select(-.data$joined_fromCOMID, -.data$joined_toCOMID)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">61</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">62</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  new_flines &lt;-</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">63</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    left_join(new_flines,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">64</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">              data.frame(becomes = unique(new_flines$becomes),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">65</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                         ID = seq_len(length(unique(new_flines$becomes))),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">66</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                         stringsAsFactors = FALSE),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">67</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">              by = "becomes")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">68</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">69</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  tocomid_updater &lt;- filter(select(new_flines, .data$becomes, .data$toCOMID),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">70</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                            !is.na(.data$toCOMID))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">71</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">72</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  new_flines &lt;- distinct(left_join(select(new_flines, -.data$toCOMID),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">73</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                   tocomid_updater, by = "becomes"))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">74</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">75</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  new_flines &lt;- left_join(new_flines,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">76</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                          select(new_flines, .data$becomes, toID = .data$ID),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">77</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                          by = c("toCOMID" = "becomes")) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">78</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    arrange(.data$Hydroseq, desc(.data$part))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">79</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">80</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  new_flines &lt;- left_join(new_flines,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">81</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                          data.frame(ID = unique(new_flines$ID),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">82</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                     ID_Hydroseq = seq_len(length(unique(new_flines$ID)))),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">83</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                          by = "ID")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">84</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">85</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  new_lp &lt;- group_by(new_flines, .data$LevelPathI) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">86</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    filter(Hydroseq == min(.data$Hydroseq)) %&gt;% # Get the outlet by hydrosequence.</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">87</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    ungroup() %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">88</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    group_by(.data$Hydroseq) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">89</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    # Get the outlet if the original was split.</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">90</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    filter(as.integer(.data$part) == max(as.integer(.data$part))) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">91</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    ungroup() %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">92</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    select(ID_LevelPathID = .data$ID_Hydroseq, .data$LevelPathI)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">93</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">94</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if(!"event_identifier" %in% names(new_flines)) </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">95</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    new_flines$event_identifier &lt;- rep(NA, nrow(new_flines))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">96</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">97</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  new_flines &lt;- left_join(distinct(new_flines), distinct(new_lp), by = "LevelPathI") %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">98</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    select(.data$ID, .data$toID, .data$LENGTHKM, .data$TotDASqKM, member_COMID = .data$COMID,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">99</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">           LevelPathID = .data$ID_LevelPathID, Hydroseq = .data$ID_Hydroseq, </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">100</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">           .data$event_identifier, orig_levelpathID = .data$LevelPathI)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">101</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">102</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (!is.null(geom)) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">103</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    geom_column &lt;- attr(geom, "sf_column")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">104</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">105</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (is.null(geom_column)) stop("geom must contain an sf geometry column")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">106</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">107</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    new_flines &lt;- right_join(select(geom, member_COMID = id, geom_column), </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">108</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                             new_flines,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">109</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                             by = "member_COMID")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">110</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">111</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    new_flines &lt;- new_flines %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">112</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      drop_geometry() %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">113</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      group_by(.data$ID) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">114</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      summarise(toID = .data$toID[1],</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">115</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                LENGTHKM = .data$LENGTHKM[1],</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">116</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                TotDASqKM = max(.data$TotDASqKM),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">117</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                LevelPathID = .data$LevelPathID[1],</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">118</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                Hydroseq = .data$Hydroseq[1],</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">119</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                event_identifier = .data$event_identifier[1],</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">120</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                orig_levelpathID = .data$orig_levelpathID[1],</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">121</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                member_COMID = list(unique(.data$member_COMID))) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">122</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      ungroup() %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">123</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      left_join(union_linestrings(</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">124</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        select(new_flines[!sf::st_is_empty(new_flines), ], .data$ID), "ID"),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">125</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        by = "ID") %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">126</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      sf::st_as_sf()</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">127</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">128</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">129</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  return(new_flines)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">130</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">131</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">132</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @title Reconcile Catchment Divides</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">133</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @description Reconciles catchment divides according to the output of</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">134</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' \code{\link{reconcile_collapsed_flowlines}} and \code{\link{refactor_nhdplus}}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">135</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param fline_ref sf data.frame flowlines as returned by</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">136</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' \code{\link{refactor_nhdplus}} and \code{\link{reconcile_collapsed_flowlines}}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">137</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param fline_rec sf data.frame flowpaths as returned by</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">138</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' \code{\link{reconcile_collapsed_flowlines}}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">139</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param catchment sf data.frame NHDPlus Catchment or CatchmentSP layers for</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">140</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' included COMIDs</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">141</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param fdr character path to D8 flow direction</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">142</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param fac character path to flow accumulation</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">143</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param para integer numer of cores to use for parallel execution</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">144</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param cache path .rda to cache incremental outputs</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">145</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param fix_catchments logical. should catchment geometries be rectified?</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">146</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param keep Only applicable if fix_catchments = TRUE. Defines the proportion </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">147</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' of points to retain in geometry simplification (0-1; default 0.05). </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">148</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' See \code{\link[rmapshaper]{ms_simplify}}. Set to NULL to skip</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">149</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' simplification.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">150</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param vector_crs integer or object compatible with sf::st_crs coordinate reference.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">151</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' Should be a projection that supports area-calculations.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">152</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @inheritParams split_catchment_divide</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">153</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @return Catchment divides that have been split and collapsed according to</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">154</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' input flowpaths</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">155</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @seealso The \code{\link{refactor_nhdplus}} function implements a complete</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">156</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' workflow using `reconcile_collapsed_flowlines()` and can be used in prep</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">157</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' for this function.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">158</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @details Note that all inputs must be passed in the same projection.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">159</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @export</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">160</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @importFrom sf st_crs st_transform st_precision st_drop_geometry st_sf st_multipolygon st_as_sf st_cast st_dimension</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">161</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @importFrom nhdplusTools rename_geometry</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">162</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @importFrom terra crs res</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">163</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @importFrom dplyr select distinct filter group_by summarise ungroup row_number mutate bind_rows</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">164</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @importFrom tidyr separate_rows</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">165</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @importFrom parallel makeCluster stopCluster</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">166</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @importFrom pbapply pblapply</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">167</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @importFrom data.table rbindlist</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">168</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">169</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">reconcile_catchment_divides &lt;- function(catchment, </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">170</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                              fline_ref, </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">171</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                              fline_rec, </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">172</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                              fdr = NULL, fac = NULL,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">173</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                              para = 2, cache = NULL, </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">174</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                              min_area_m = 800, </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">175</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                              snap_distance_m = 100,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">176</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                              simplify_tolerance_m = 40, </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">177</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                              vector_crs = 5070,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">178</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                              fix_catchments = TRUE,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">179</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                              keep = .9) {</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">180</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">181</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  in_crs    &lt;- st_crs(catchment)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">182</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  catchment &lt;- rename_geometry(catchment, "geom")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">183</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  fline_ref &lt;- rename_geometry(fline_ref, "geom")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">184</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  fline_rec &lt;- rename_geometry(fline_rec, "geom")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">185</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">186</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if(!is.null(fdr) &amp; !is.null(fac)){</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">187</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">188</td>
                    <td class="coverage">6<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    fdr_temp &lt;- fdr</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">189</td>
                    <td class="coverage">6<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if(!inherits(fdr_temp, "SpatRaster")){</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">190</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      fdr_temp &lt;- terra::rast(fdr_temp)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">191</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">192</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">193</td>
                    <td class="coverage">6<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    catchment &lt;-  st_transform(catchment, terra::crs(fdr_temp)) </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">194</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    #st_precision(catchment) &lt;- terra::res(fdr_temp)[1]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">195</td>
                    <td class="coverage">6<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    fline_ref &lt;-  st_transform(fline_ref,  terra::crs(fdr_temp))</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">196</td>
                    <td class="coverage">6<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    fline_rec &lt;-  st_transform(fline_rec,  terra::crs(fdr_temp))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">197</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">198</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">199</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  reconciled &lt;- st_drop_geometry(fline_rec) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">200</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    dplyr::select(.data$ID, .data$member_COMID)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">201</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">202</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  rm(fline_rec)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">203</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">204</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # Not all catchments have flowlines. Remove the flowlines without.  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">205</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  comid &lt;- fline_ref$COMID # Just being explicit here.</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">206</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  featureid &lt;- catchment$FEATUREID # type conversion below is annoying.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">207</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # as.integer removes the .1, .2, semantic part but the response retains </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">208</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # the semantic component. If you don't know what this means, stop hacking.</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">209</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  comid_with_catchment &lt;- comid[as.integer(comid) %in% featureid]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">210</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">211</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  reconciled &lt;- distinct(reconciled) %&gt;% # had dups from prior steps.</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">212</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    tidyr::separate_rows(.data$member_COMID, sep = ",") %&gt;% # Make long form</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">213</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    dplyr::filter(.data$member_COMID %in% comid_with_catchment) %&gt;% # </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">214</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    dplyr::group_by(.data$ID) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">215</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    dplyr::summarise(member_COMID = paste(.data$member_COMID, collapse = ",")) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">216</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    dplyr::ungroup()</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">217</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">218</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  fline_ref &lt;- fline_ref[as.integer(fline_ref$COMID) %in% catchment$FEATUREID, ]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">219</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">220</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  to_split_bool &lt;- as.numeric(fline_ref$COMID) !=</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">221</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    as.integer(fline_ref$COMID)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">222</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">223</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  to_split_ids &lt;- fline_ref$COMID[which(to_split_bool)]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">224</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">225</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  to_split_featureids &lt;- unique(as.integer(to_split_ids))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">226</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">227</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  cl &lt;- NULL</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">228</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">229</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if(para &gt; 1) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">230</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    log_file &lt;- ""</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">231</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if(!is.null(cache)) log_file &lt;- paste0(cache, "_par.log")  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">232</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    cl &lt;- parallel::makeCluster(para, outfile = log_file)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">233</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">234</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">235</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if(!is.null(cache)) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">236</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    try(load(cache), silent = TRUE)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">237</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">238</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">239</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if(!exists("split_cats")) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">240</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    split_cats &lt;- pbapply::pblapply(to_split_featureids, </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">241</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                    par_split_cat,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">242</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                    to_split_ids = to_split_ids,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">243</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                    fline_ref = fline_ref,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">244</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                    catchment = catchment,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">245</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                    fdr = fdr, </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">246</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                    fac = fac,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">247</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                    min_area_m = min_area_m, </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">248</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                    snap_distance_m = snap_distance_m,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">249</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                    simplify_tolerance_m = simplify_tolerance_m, </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">250</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                    vector_crs = vector_crs,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">251</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                    cl = cl)</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">252</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if(!is.null(cache)) save(split_cats, file = cache)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">253</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">254</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">255</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">256</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if(length(split_cats) == 0) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">257</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    split_cats &lt;- st_sf(FEATUREID = NA, geom = list(sf::st_multipolygon()))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">258</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  } else {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">259</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if(!inherits(split_cats, "sf")) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">260</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      split_cats &lt;- sf::st_as_sf(data.table::rbindlist(split_cats[!sapply(split_cats, is.null)]))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">261</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">262</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    split_cats &lt;- sf::st_cast(split_cats, "MULTIPOLYGON")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">263</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">264</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">265</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  split_cats &lt;- dplyr::group_by(split_cats, FEATUREID) %&gt;% </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">266</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    dplyr::filter(dplyr::row_number() == 1) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">267</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    dplyr::ungroup()</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">268</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">269</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  unsplit &lt;- get_cat_unsplit(catchment, fline_ref, to_split_featureids)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">270</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">271</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if(nrow(unsplit) &gt; 0) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">272</td>
                    <td class="coverage">6<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    split_cats &lt;- sf::st_as_sf(data.table::rbindlist(list(</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">273</td>
                    <td class="coverage">6<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      unsplit,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">274</td>
                    <td class="coverage">6<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      split_cats)))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">275</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">276</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">277</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  combinations &lt;- reconciled$member_COMID[grepl(",", reconciled$member_COMID)]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">278</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">279</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  unioned_cats &lt;- pbapply::pblapply(combinations, </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">280</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                    get_split_cats,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">281</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                    split_cats = split_cats,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">282</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                    cache = cache,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">283</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                    cl = cl)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">284</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">285</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">286</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if(!is.null(cl)) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">287</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    parallel::stopCluster(cl)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">288</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">289</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">290</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if(length(unioned_cats) &gt; 0) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">291</td>
                    <td class="coverage">5<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    unioned_cats &lt;- sf::st_as_sf(data.table::rbindlist(unioned_cats))</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">292</td>
                    <td class="coverage">5<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    split_cats   &lt;- sf::st_as_sf(data.table::rbindlist(list(</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">293</td>
                    <td class="coverage">5<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      dplyr::filter(split_cats, !FEATUREID %in% unioned_cats$FEATUREID),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">294</td>
                    <td class="coverage">5<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      unioned_cats</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">295</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    )))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">296</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">297</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">298</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  out &lt;- st_sf(right_join(dplyr::select(split_cats, member_COMID = .data$FEATUREID), </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">299</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                          reconciled,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">300</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                          by = "member_COMID"))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">301</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">302</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  missing &lt;- is.na(st_dimension(out$geom))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">303</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">304</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (any(missing)) {</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">305</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">306</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    out_mp &lt;- filter(out, !missing) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">307</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      st_cast("MULTIPOLYGON")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">308</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">309</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    out &lt;- select(catchment, member_COMID = .data$FEATUREID) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">310</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      filter(.data$member_COMID %in% unique(as.integer(out$member_COMID[missing]))) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">311</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      mutate(member_COMID = paste0(.data$member_COMID, ".1")) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">312</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      mutate(ID = out$ID[match(.data$member_COMID, out$member_COMID)]) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">313</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      select(.data$ID, .data$member_COMID) %&gt;% </pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">314</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      nhdplusTools::rename_geometry(attr(out_mp, "sf_column")) %&gt;% </pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">315</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      bind_rows(out_mp)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">316</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  } </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">317</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">318</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if(fix_catchments){</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">319</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    # cat("Fixing Catchment Geometries...\n")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">320</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    clean_geometry(catchments = out, "ID", keep) %&gt;% </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">321</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      sf::st_transform(in_crs)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">322</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  } else {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">323</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    sf::st_transform(out, in_crs)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">324</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">325</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">326</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">327</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">par_split_cat &lt;- function(fid, to_split_ids, fline_ref, catchment, fdr, fac,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">328</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                          min_area_m, snap_distance_m,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">329</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                          simplify_tolerance_m, vector_crs) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">330</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  out &lt;- NULL</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">331</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  try({</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">332</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">333</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    message(paste0(Sys.time(), " par_split_cat() on pid: ", </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">334</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                   Sys.getpid(), " catchment: ", fid))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">335</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">336</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    # nolint start</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">337</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    requireNamespace("hyRefactor", quietly = TRUE)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">338</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    requireNamespace("terra", quietly = TRUE)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">339</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    # nolint end</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">340</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">341</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if(!inherits(fdr, "SpatRaster")){</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">342</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      fdr = terra::rast(fdr)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">343</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">344</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">345</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if(!inherits(fac, "SpatRaster")){</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">346</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      fac = terra::rast(fac)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">347</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">348</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">349</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    split_set &lt;- to_split_ids[which(grepl(paste0("^", as.character(fid)), to_split_ids))]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">350</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    to_split_flines &lt;- dplyr::filter(fline_ref, .data$COMID %in% split_set)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">351</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    to_split_cat    &lt;- dplyr::filter(catchment, .data$FEATUREID == fid)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">352</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">353</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    split_cats &lt;- split_catchment_divide(catchment = to_split_cat,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">354</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                         fline = to_split_flines,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">355</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                         fdr = fdr,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">356</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                         fac = fac, </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">357</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                         lr = FALSE,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">358</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                         min_area_m = min_area_m, </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">359</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                         snap_distance_m = snap_distance_m,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">360</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                         simplify_tolerance_m = simplify_tolerance_m, </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">361</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                         vector_crs = vector_crs)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">362</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">363</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    out &lt;- sf::st_sf(FEATUREID = to_split_flines$COMID,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">364</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                     geom = sf::st_cast(split_cats, "MULTIPOLYGON"), </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">365</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                        stringsAsFactors = FALSE)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">366</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }, silent = FALSE)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">367</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">368</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  return(out)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">369</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">370</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">371</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">get_split_cats &lt;- function(cats, split_cats, cache = NULL) {</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">372</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">373</td>
                    <td class="coverage">1309<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  error_found &lt;- TRUE</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">374</td>
                    <td class="coverage">1309<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  error_file &lt;- paste0(gsub(".rda", "", cache), "error.rda")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">375</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">376</td>
                    <td class="coverage">1309<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  tryCatch({</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">377</td>
                    <td class="coverage">1309<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  cats_vec &lt;- unlist(strsplit(cats, ","))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">378</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">379</td>
                    <td class="coverage">1309<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  union_cats &lt;- dplyr::filter(split_cats, .data$FEATUREID %in% cats_vec)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">380</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">381</td>
                    <td class="coverage">1309<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (length(unique(union_cats$FEATUREID)) != length(cats_vec)) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">382</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if(!is.null(cache)) {</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">383</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      </pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">384</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      save(list = ls(), file = error_file)</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">385</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      stop(paste("missing a split catchment for an expected flowline.", </pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">386</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">                 cats_vec, "environment saved to:", cache))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">387</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    } </pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">388</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    stop(paste("missing a split catchment for an expected flowline.", </pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">389</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">                paste(cats_vec, collapse = "\n")))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">390</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">391</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">392</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">393</td>
                    <td class="coverage">1309<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  geom &lt;- sf::st_cast(sf::st_union(sf::st_make_valid(union_cats)), </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">394</td>
                    <td class="coverage">1309<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                      "MULTIPOLYGON")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">395</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">396</td>
                    <td class="coverage">1309<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  unioned &lt;- sf::st_sf(FEATUREID = cats, </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">397</td>
                    <td class="coverage">1309<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                       geom = geom,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">398</td>
                    <td class="coverage">1309<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                       stringsAsFactors = FALSE)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">399</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">400</td>
                    <td class="coverage">1309<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (!any(grepl("MULTIPOLYGON", class(sf::st_geometry(unioned))))) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">401</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    warning("Somthing is wrong with the union of catchments.")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">402</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">403</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">404</td>
                    <td class="coverage">1309<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  return(unioned)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">405</td>
                    <td class="coverage">1309<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }, error = function(e) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">406</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    warning(paste0("error in get_split_cats", e))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">407</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  })</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">408</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">409</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">  save(list = ls(), file = error_file)</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">410</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">  stop(paste("Something went wrong in get_split_cats. The environment was saved to", cache))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">411</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">412</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">413</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">414</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">415</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">get_cat_unsplit &lt;- function(catchment, fline_ref, to_split_featureids) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">416</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  cat &lt;- select(catchment, FEATUREID)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">417</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  cat &lt;- cat[!cat$FEATUREID %in% to_split_featureids, ]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">418</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  cat$FEATUREID &lt;- as.character(cat$FEATUREID)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">419</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  cat &lt;- left_join(cat,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">420</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                        select(st_drop_geometry(fline_ref), </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">421</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                               FEATUREID = .data$COMID),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">422</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                        by = "FEATUREID")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">423</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  st_cast(select(cat, .data$FEATUREID), "MULTIPOLYGON")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">424</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div id="R/split_catchment.R" class="hidden">
              <table class="table-condensed">
                <tbody>
                  <tr class="never">
                    <td class="num">1</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">get_neighbor_df &lt;- function(row, col, nrow_mat, ncol_mat) {</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">2</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # Starting east going clockwise</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">3</td>
                    <td class="coverage">155452<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  neighbors &lt;- matrix(c(row,     col + 1, 16,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">4</td>
                    <td class="coverage">155452<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                        row + 1, col + 1, 32,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">5</td>
                    <td class="coverage">155452<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                        row + 1, col,     64,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">6</td>
                    <td class="coverage">155452<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                        row + 1, col - 1, 128,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">7</td>
                    <td class="coverage">155452<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                        row,     col - 1, 1,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">8</td>
                    <td class="coverage">155452<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                        row - 1, col - 1, 2,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">9</td>
                    <td class="coverage">155452<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                        row - 1, col,     4,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">10</td>
                    <td class="coverage">155452<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                        row - 1, col + 1, 8), nrow = 8, byrow = TRUE)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">11</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">12</td>
                    <td class="coverage">155452<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  neighbors &lt;- data.frame(neighbors)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">13</td>
                    <td class="coverage">155452<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  names(neighbors) &lt;- c("row", "col", "flow_to_test")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">14</td>
                    <td class="coverage">155452<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  rownames(neighbors) &lt;- c("east", "southeast", "south", "southwest", "west", "northwest", "north", "northeast")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">15</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">16</td>
                    <td class="coverage">5<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (row == nrow_mat) neighbors &lt;- neighbors[!rownames(neighbors) %in% c("southeast", "south", "southwest"), ]</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">17</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (col == ncol_mat) neighbors &lt;- neighbors[!rownames(neighbors) %in% c("northeast", "east", "southeast"), ]</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">18</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (row == 0) neighbors &lt;- neighbors[!rownames(neighbors) %in% c("northwest", "north", "northeast"), ]</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">19</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (col == 0) neighbors &lt;- neighbors[!rownames(neighbors) %in% c("southwest", "west", "northwest"), ]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">20</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">21</td>
                    <td class="coverage">155452<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  return(neighbors)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">22</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">23</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">24</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">find_upstream &lt;- function(row_col, fdr_matrix) {</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">25</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">26</td>
                    <td class="coverage">155424<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  row &lt;- row_col[1]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">27</td>
                    <td class="coverage">155424<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  col &lt;- row_col[2]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">28</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">29</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # Hacking around the stop conditions in these three if statements.</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">30</td>
                    <td class="coverage">155424<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (is.na(row) | is.na(col)) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">31</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    return()</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">32</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">33</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">34</td>
                    <td class="coverage">155424<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (row &lt;= 0 | row &gt; nrow(fdr_matrix) | col &lt;= 0 | col &gt; ncol(fdr_matrix)) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">35</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    return()</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">36</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">37</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">38</td>
                    <td class="coverage">155424<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (is.na(fdr_matrix[row, col])) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">39</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    return()</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">40</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">41</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">42</td>
                    <td class="coverage">155424<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  neighbors &lt;- get_neighbor_df(row, col, nrow(fdr_matrix), ncol(fdr_matrix))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">43</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">44</td>
                    <td class="coverage">155424<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  neighbor_ind &lt;- cbind(neighbors$row, neighbors$col)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">45</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">46</td>
                    <td class="coverage">155424<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if(any(neighbor_ind == 0)) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">47</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    keep &lt;- neighbor_ind[, 1] != 0 &amp;  neighbor_ind[, 2] != 0</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">48</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">49</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    neighbor_ind &lt;- neighbor_ind[keep, ]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">50</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">51</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    flow_to_val &lt;- neighbors$flow_to_test[keep]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">52</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">53</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  } else {</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">54</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">55</td>
                    <td class="coverage">155417<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    flow_to_val &lt;- neighbors$flow_to_test</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">56</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">57</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">58</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">59</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">60</td>
                    <td class="coverage">155424<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  return(neighbor_ind[which(fdr_matrix[neighbor_ind] == flow_to_val), , drop = FALSE])</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">61</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">62</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">63</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">collect_upstream &lt;- function(row_col, fdr_matrix, fac_matrix = NULL, flowpath_mode = FALSE) {</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">64</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">65</td>
                    <td class="coverage">28<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  m_size &lt;- nrow(fdr_matrix) * ncol(fdr_matrix)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">66</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">67</td>
                    <td class="coverage">28<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  out_cells &lt;- matrix(NA_integer_, nrow = m_size, ncol = 2)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">68</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">69</td>
                    <td class="coverage">28<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  check_cell_counter &lt;- 1</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">70</td>
                    <td class="coverage">28<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  out_cell_counter &lt;- 2</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">71</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">72</td>
                    <td class="coverage">28<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  out_cells[check_cell_counter, ] &lt;- row_col</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">73</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">74</td>
                    <td class="coverage">28<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  row_col &lt;- out_cells[check_cell_counter, ]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">75</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">76</td>
                    <td class="coverage">28<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  while(!is.na(row_col[1])) {</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">77</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">78</td>
                    <td class="coverage">155424<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    us &lt;- find_upstream(row_col, fdr_matrix)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">79</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">80</td>
                    <td class="coverage">155424<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if(flowpath_mode) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">81</td>
                    <td class="coverage">87<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      us &lt;- flowpath_filter(us, fac_matrix)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">82</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">83</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">84</td>
                    <td class="coverage">155424<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    new_rows &lt;- nrow(us)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">85</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">86</td>
                    <td class="coverage">155424<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if(!is.null(new_rows) &amp;&amp; nrow(us) &gt; 0) {</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">87</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">88</td>
                    <td class="coverage">110976<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      out_cells[out_cell_counter:(out_cell_counter + new_rows - 1), ] &lt;- us</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">89</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">90</td>
                    <td class="coverage">110976<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      out_cell_counter &lt;- out_cell_counter + new_rows</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">91</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">92</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">93</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">94</td>
                    <td class="coverage">155424<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    check_cell_counter &lt;- check_cell_counter + 1</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">95</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">96</td>
                    <td class="coverage">155424<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    row_col &lt;- out_cells[check_cell_counter, ]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">97</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">98</td>
                    <td class="coverage">155424<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if(check_cell_counter &gt; 2000000) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">99</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      stop("runaway loop in collect upstream")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">100</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">101</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">102</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">103</td>
                    <td class="coverage">28<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  return(out_cells[1:check_cell_counter, ])</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">104</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">105</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">106</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">flowpath_filter &lt;- function(us, fac_matrix) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">107</td>
                    <td class="coverage">87<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  fac_vals &lt;- apply(us, 1, function(x, mat) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">108</td>
                    <td class="coverage">189<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    mat[x[1], x[2]]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">109</td>
                    <td class="coverage">87<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }, mat = fac_matrix)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">110</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">111</td>
                    <td class="coverage">87<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if(any(fac_vals &gt; 0)) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">112</td>
                    <td class="coverage">84<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    us &lt;- us[which(fac_vals == max(fac_vals)), , drop = FALSE]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">113</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  } else {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">114</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    us &lt;- us[1, ]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">115</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">116</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">117</td>
                    <td class="coverage">87<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  return(us)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">118</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">119</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">120</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">121</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">122</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' Trace Upstream</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">123</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param start_point row col index</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">124</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param cat catchment</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">125</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param fdr flow direction grid</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">126</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param fac_matrix flow accumulation matrix</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">127</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param fdr_matrix flow direction matrix</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">128</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @importFrom terra xFromCol yFromRow</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">129</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @importFrom sf st_sfc st_linestring st_crs</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">130</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @importFrom utils capture.output str</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">131</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @return sfc</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">132</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">133</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">trace_upstream &lt;- function(start_point, cat, fdr, fac_matrix, fdr_matrix) {</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">134</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">135</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  s_p &lt;- st_coordinates(start_point)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">136</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">137</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  suppressWarnings(row_col &lt;- get_row_col(fdr, s_p, fac_matrix))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">138</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">139</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  tryCatch({</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">140</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">141</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    us_flowpath &lt;- collect_upstream(row_col, fdr_matrix, fac_matrix, flowpath_mode = TRUE)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">142</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">143</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }, error = function(e) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">144</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    stop(paste0("Error with: ", </pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">145</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">                paste(capture.output(str(start_point, </pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">146</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                         give.attr = FALSE, </pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">147</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                         drop.deparse.attr = TRUE)), </pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">148</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">                      collapse = "\n"), " original error was: \n", e))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">149</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  })</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">150</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">151</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  us_flowpath &lt;- us_flowpath[!is.na(us_flowpath[, 1]), ]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">152</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">153</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  xy_nodes &lt;- matrix(c(terra::xFromCol(fdr, col = us_flowpath[, 2]),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">154</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                       terra::yFromRow(fdr, row = us_flowpath[, 1])), </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">155</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                     ncol = 2)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">156</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">157</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  xy_nodes &lt;- rbind(start_point[[1]], xy_nodes)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">158</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">159</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  st_sfc(st_linestring(xy_nodes[nrow(xy_nodes):1, ]), crs = st_crs(start_point))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">160</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">161</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">162</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @title Split Catchment Divides</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">163</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @description A catchment-divide splitting algorithm that works with a D8</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">164</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' flow direction grid and the output of nhdplus_refactor. See Vignette</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">165</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' for examples.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">166</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param catchment sf data.frame with one catchment divide</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">167</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param fline sf data.frame with one or more flowline segments in</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">168</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' upstream downstream order.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">169</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param fdr character path to flow direction that fully covers the catchment</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">170</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param fac character path to flow accumulation that fuller covers the catchment</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">171</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param lr boolean should catchments be split along the left/right bank?</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">172</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param min_area_m minimum area in m^2 to filter out slivers (caution, use with care!!)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">173</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param snap_distance_m distance in meters to snap SpatRaster generated geometry to polygon geometry</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">174</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param simplify_tolerance_m dTolerance in meters for simplification of grid-cell based polygons</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">175</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param vector_crs any object compatible with sf::st_crs. Used for vector-based calculations in case that </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">176</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' fdr projection is not suitable (e.g. lon/lat) -- must result in units of meters.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">177</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @return Split catchment divides as an sfc geometry.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">178</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @importFrom terra rast setValues as.polygons</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">179</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @importFrom dplyr group_by ungroup filter select mutate lead n</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">180</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @importFrom sf st_crs st_coordinates as_Spatial st_buffer st_combine</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">181</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' st_as_sf st_as_sfc st_sfc st_geometry st_simplify st_snap</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">182</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' st_difference st_cast st_sf st_area st_distance st_within st_point `st_crs&lt;-`</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">183</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' st_make_valid st_segmentize st_nearest_feature st_linestring</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">184</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @importFrom nhdplusTools get_node</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">185</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @importFrom dplyr `%&gt;%`</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">186</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @export</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">187</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">188</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">split_catchment_divide &lt;- function(catchment, fline, fdr, fac, lr = FALSE, </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">189</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                   min_area_m = 800, snap_distance_m = 100,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">190</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                   simplify_tolerance_m = 40, vector_crs = NULL) {</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">191</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">192</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  #check_proj(catchment, fline, fdr)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">193</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">194</td>
                    <td class="coverage">24<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if(!inherits(fdr, "SpatRaster")){</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">195</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    fdr = terra::rast(fdr)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">196</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">197</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">198</td>
                    <td class="coverage">24<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if(!inherits(fac, "SpatRaster")){</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">199</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    fac = terra::rast(fac)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">200</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">201</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">202</td>
                    <td class="coverage">24<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  cat_crs &lt;- sf::st_crs(catchment)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">203</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">204</td>
                    <td class="coverage">24<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  outlets &lt;- st_coordinates(fline) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">205</td>
                    <td class="coverage">24<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    data.frame() %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">206</td>
                    <td class="coverage">24<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    group_by(L1) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">207</td>
                    <td class="coverage">24<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    filter(dplyr::row_number() == n()) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">208</td>
                    <td class="coverage">24<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    ungroup()</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">209</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">210</td>
                    <td class="coverage">24<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  suppressWarnings(fdr_matrix &lt;- prep_cat_fdr_fac(catchment, fdr, fac))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">211</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">212</td>
                    <td class="coverage">24<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  fdr &lt;- fdr_matrix$fdr</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">213</td>
                    <td class="coverage">24<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  fac &lt;- fdr_matrix$fac</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">214</td>
                    <td class="coverage">24<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  fac_matrix &lt;- fdr_matrix$fac_matrix</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">215</td>
                    <td class="coverage">24<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  fdr_matrix &lt;- fdr_matrix$fdr_matrix</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">216</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">217</td>
                    <td class="coverage">24<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  return_cats &lt;- list()</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">218</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">219</td>
                    <td class="coverage">24<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (nrow(fdr_matrix) != nrow(fac_matrix) | ncol(fdr_matrix) != ncol(fac_matrix)) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">220</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    stop("flow direction and flow accumulation must be the same size")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">221</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">222</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">223</td>
                    <td class="coverage">24<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  for (cat in seq_len(nrow(outlets) - 1)) {</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">224</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">225</td>
                    <td class="coverage">25<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    in_out &lt;- st_within(st_sfc(st_point(c(outlets$X[cat], outlets$Y[cat])),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">226</td>
                    <td class="coverage">25<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                       crs = st_crs(fline)),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">227</td>
                    <td class="coverage">25<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                            catchment, prepared = FALSE)[[1]]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">228</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">229</td>
                    <td class="coverage">25<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (length(in_out) &gt; 0 &amp;&amp; in_out == 1) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">230</td>
                    <td class="coverage">25<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      suppressWarnings(row_col &lt;- get_row_col(fdr, start = cbind(outlets$X[cat], outlets$Y[cat]), fac_matrix))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">231</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">232</td>
                    <td class="coverage">25<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      tryCatch({</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">233</td>
                    <td class="coverage">25<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        us_cells &lt;- collect_upstream(row_col, fdr_matrix)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">234</td>
                    <td class="coverage">25<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      }, error = function(e) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">235</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">        stop(paste0("Error with: ", </pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">236</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">                    paste(capture.output(str(catchment, </pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">237</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                             give.attr = FALSE, </pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">238</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                             drop.deparse.attr = TRUE)), </pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">239</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">                          collapse = "\n"), " original error was: \n", e))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">240</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      })</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">241</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">242</td>
                    <td class="coverage">25<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      vals &lt;- matrix(0, nrow = nrow(fdr_matrix), ncol = ncol(fdr_matrix))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">243</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">244</td>
                    <td class="coverage">25<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      vals[us_cells] &lt;- 1</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">245</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">246</td>
                    <td class="coverage">25<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      out = terra::setValues(fdr, vals)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">247</td>
                    <td class="coverage">25<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      names(out) = "cats"</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">248</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">249</td>
                    <td class="coverage">25<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      raster_function &lt;- function(x) x == 1</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">250</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">251</td>
                    <td class="coverage">25<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      out = st_as_sf(terra::as.polygons(out)) |&gt; </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">252</td>
                    <td class="coverage">25<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        filter(.data$cats == 1)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">253</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">254</td>
                    <td class="coverage">25<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      smaller_than_one_pixel &lt;- units::set_units(min_area_m, "m^2")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">255</td>
                    <td class="coverage">25<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      snap_distance          &lt;- units::set_units(snap_distance_m, "m")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">256</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">257</td>
                    <td class="coverage">25<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if(!is.null(vector_crs)) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">258</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        out &lt;- sf::st_transform(out, vector_crs)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">259</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        catchment &lt;- sf::st_transform(catchment, vector_crs)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">260</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">261</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">262</td>
                    <td class="coverage">25<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      ds_catchment &lt;- st_geometry(out) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">263</td>
                    <td class="coverage">25<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        st_simplify(dTolerance = simplify_tolerance_m) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">264</td>
                    <td class="coverage">25<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        st_snap(st_geometry(catchment), tolerance = snap_distance)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">265</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">266</td>
                    <td class="coverage">25<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      retry_cat_fun &lt;- function(catchment, ds_catchment, smaller_than_one_pixel) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">267</td>
                    <td class="coverage">25<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        st_difference(st_geometry(catchment), ds_catchment) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">268</td>
                    <td class="coverage">25<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          st_cast("POLYGON") %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">269</td>
                    <td class="coverage">25<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          st_sf() %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">270</td>
                    <td class="coverage">25<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          mutate(area = st_area(.)) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">271</td>
                    <td class="coverage">25<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          filter(area &gt; smaller_than_one_pixel) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">272</td>
                    <td class="coverage">25<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          st_combine()</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">273</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">274</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">275</td>
                    <td class="coverage">25<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      suppressWarnings(st_crs(catchment) &lt;- st_crs(ds_catchment))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">276</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">277</td>
                    <td class="coverage">25<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      ds_catchment &lt;- retry_cat_fun(st_make_valid(catchment),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">278</td>
                    <td class="coverage">25<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                    st_make_valid(ds_catchment),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">279</td>
                    <td class="coverage">25<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                    smaller_than_one_pixel)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">280</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">281</td>
                    <td class="coverage">25<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      us_catchment &lt;- st_difference(st_geometry(st_make_valid(catchment)),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">282</td>
                    <td class="coverage">25<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                    st_make_valid(ds_catchment))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">283</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">284</td>
                    <td class="coverage">25<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      catchment &lt;- ds_catchment</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">285</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">286</td>
                    <td class="coverage">25<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if(sf::st_crs(catchment) != cat_crs) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">287</td>
                    <td class="coverage">5<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        catchment &lt;- sf::st_transform(catchment, cat_crs)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">288</td>
                    <td class="coverage">5<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        us_catchment &lt;- sf::st_transform(us_catchment, cat_crs)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">289</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">290</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">291</td>
                    <td class="coverage">25<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      return_cats &lt;- c(return_cats, us_catchment)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">292</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    } else {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">293</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      browser()</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">294</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">295</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">296</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">297</td>
                    <td class="coverage">24<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if(sf::st_is_empty(st_geometry(catchment))) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">298</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    stop("Nothing left over. Split too small?")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">299</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  } else {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">300</td>
                    <td class="coverage">23<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    out &lt;- c(return_cats, st_geometry(catchment))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">301</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">302</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">303</td>
                    <td class="coverage">23<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  out &lt;- st_as_sfc(out, crs = st_crs(catchment))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">304</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">305</td>
                    <td class="coverage">23<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if(lr) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">306</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    return(split_lr(cat = out, fline, fdr, fac_matrix, fdr_matrix))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">307</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">308</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">309</td>
                    <td class="coverage">16<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  return(out)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">310</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">311</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">312</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">split_lr &lt;- function(cat, fline, fdr, fac_matrix, fdr_matrix) {</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">313</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">314</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  out &lt;- lapply(c(1:nrow(fline)), function(x, cat, fline, fdr, fac_matrix, fdr_matrix) {</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">315</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">316</td>
                    <td class="coverage">11<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    line &lt;- st_cast(st_geometry(fline[x, ]), "LINESTRING")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">317</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">318</td>
                    <td class="coverage">11<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    cat &lt;- st_sfc(st_segmentize(cat[[x]], dfMaxLength = 100), crs = st_crs(cat))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">319</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">320</td>
                    <td class="coverage">11<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    un &lt;- st_geometry(get_node(line, position = "start"))</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">321</td>
                    <td class="coverage">11<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    dn &lt;- st_geometry(get_node(line, position = "end"))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">322</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">323</td>
                    <td class="coverage">11<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    coords &lt;- st_cast(cat, "POINT")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">324</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">325</td>
                    <td class="coverage">11<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    snap_un &lt;- coords[st_nearest_feature(un, coords)]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">326</td>
                    <td class="coverage">11<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    snap_dn &lt;- coords[st_nearest_feature(dn, coords)]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">327</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">328</td>
                    <td class="coverage">11<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if(as.numeric(st_distance(un, snap_un)) &gt; 100) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">329</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      extra_line &lt;- trace_upstream(un, cat, fdr, fac_matrix, fdr_matrix)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">330</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">331</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      extra_line &lt;- st_simplify(extra_line, dTolerance = 50)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">332</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">333</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      line[[1]] &lt;- st_linestring(rbind(extra_line[[1]], line[[1]]))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">334</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">335</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      un &lt;- st_geometry(nhdplusTools::get_node(line, position = "start"))</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">336</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      snap_un &lt;- coords[st_nearest_feature(un, coords)]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">337</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">338</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">339</td>
                    <td class="coverage">11<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    line[[1]][1, ] &lt;- st_coordinates(snap_un)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">340</td>
                    <td class="coverage">11<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    line[[1]][nrow(line[[1]]), ] &lt;- st_coordinates(snap_dn)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">341</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">342</td>
                    <td class="coverage">11<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    split_cat &lt;- lwgeom::st_split(cat, line)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">343</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">344</td>
                    <td class="coverage">11<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    split_1 &lt;- st_sfc(st_geometry(split_cat)[[1]][[1]], crs = st_crs(split_cat))</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">345</td>
                    <td class="coverage">11<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    split_2 &lt;- st_sfc(st_geometry(split_cat)[[1]][[2]], crs = st_crs(split_cat))</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">346</td>
                    <td class="coverage">11<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    st_combine(c(split_1, split_2))</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">347</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }, fline = fline, cat = cat, fdr = fdr, fac_matrix = fac_matrix, fdr_matrix = fdr_matrix)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">348</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">349</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  do.call(c, out)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">350</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">351</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">352</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">353</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">354</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' Get Row and Column</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">355</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param fdr flow direction grid</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">356</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param start matrix (row, col)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">357</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param fac_matrix flow accumulation matrix</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">358</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @importFrom terra cellFromXY rowColFromCell</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">359</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">360</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">get_row_col &lt;- function(fdr, start, fac_matrix) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">361</td>
                    <td class="coverage">28<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  cell    &lt;- terra::cellFromXY(fdr, start)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">362</td>
                    <td class="coverage">28<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  row_col &lt;- terra::rowColFromCell(fdr, cell)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">363</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">364</td>
                    <td class="coverage">28<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  neighbors &lt;- get_neighbor_df(row_col[1], row_col[2],</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">365</td>
                    <td class="coverage">28<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                               nrow(fac_matrix), ncol(fac_matrix))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">366</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">367</td>
                    <td class="coverage">28<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  neighbor_fac &lt;- fac_matrix[cbind(neighbors$row, neighbors$col)]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">368</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">369</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # Some flowline outlets don't hit the right raster cell.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">370</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # This grabs a neighbor that is more than twice the flow accumulation</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">371</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # to avoid just going 1 cell in the downstream direction.</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">372</td>
                    <td class="coverage">28<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (any(neighbor_fac &gt; (fac_matrix[row_col[1], row_col[2]]) * 2)) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">373</td>
                    <td class="coverage">15<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    new_rc &lt;- neighbors[which(neighbor_fac == max(neighbor_fac)), 1:2]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">374</td>
                    <td class="coverage">15<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    row_col[1] &lt;- new_rc$row</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">375</td>
                    <td class="coverage">15<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    row_col[2] &lt;- new_rc$col</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">376</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">377</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">378</td>
                    <td class="coverage">28<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  return(row_col)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">379</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">380</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">381</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' Prep catchment with FDR/FAC</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">382</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param cat catchment (sf object)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">383</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param fdr flow direction grid</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">384</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param fac flow accumulation grid</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">385</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @importFrom terra vect crop mask as.matrix</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">386</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @importFrom sf st_is_longlat st_buffer</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">387</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">388</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">prep_cat_fdr_fac &lt;- function(cat, fdr, fac) {</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">389</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">390</td>
                    <td class="coverage">24<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  sp_cat_buffer &lt;- terra::vect(</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">391</td>
                    <td class="coverage">24<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if(sf::st_is_longlat(cat)) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">392</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    c = st_make_valid(st_buffer(cat, 0.002))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">393</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  } else {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">394</td>
                    <td class="coverage">23<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    st_make_valid(st_buffer(cat, 200))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">395</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  })</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">396</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">397</td>
                    <td class="coverage">24<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  fdr &lt;- terra::crop(fdr, sp_cat_buffer, snap = "out")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">398</td>
                    <td class="coverage">24<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  fdr &lt;- terra::mask(fdr, sp_cat_buffer)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">399</td>
                    <td class="coverage">24<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  fac &lt;- terra::crop(fac, sp_cat_buffer, snap = "out")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">400</td>
                    <td class="coverage">24<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  fac &lt;- terra::mask(fac, sp_cat_buffer)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">401</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">402</td>
                    <td class="coverage">24<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  fdr_matrix &lt;- terra::as.matrix(fdr, wide=TRUE)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">403</td>
                    <td class="coverage">24<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  fac_matrix &lt;- terra::as.matrix(fac, wide=TRUE)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">404</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">405</td>
                    <td class="coverage">24<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  return(list(fdr_matrix = fdr_matrix, </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">406</td>
                    <td class="coverage">24<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">              fac_matrix = fac_matrix,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">407</td>
                    <td class="coverage">24<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">              fdr = fdr,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">408</td>
                    <td class="coverage">24<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">              fac = fac))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">409</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">410</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">411</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">check_proj &lt;- function(catchment, fline, fdr = NULL) {</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">412</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">413</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">  er &lt;- "All inputs must have the same projection."</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">414</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">415</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if(st_crs(fline) != st_crs(catchment)) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">416</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    stop(er)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">417</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">418</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">419</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if(!is.null(fdr)) {</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">420</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">421</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    proj &lt;- st_crs(fdr)</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">422</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (st_crs(catchment) != st_crs(proj) |</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">423</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">        st_crs(fline) != st_crs(proj)) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">424</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      stop(er)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">425</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">426</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">427</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">  return(invisible(1))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">428</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">429</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">430</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' trace downstream (raindrop trace)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">431</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @description proof of concept raindrop trace. </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">432</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' Example shown works but not tested beyond happy path</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">433</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' Stop condition is distance or NA flow direction.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">434</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' Set edge of fdr and river path to NA to control stop.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">435</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @noRd</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">436</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param start_point sfc point where trace should start</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">437</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param fdr SpatRaster flow direction grid</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">438</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param distance numeric max distance in number of grid cells</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">439</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @return sfc linestring path traced along flow direction in crs of fdr grid</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">440</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @importFrom terra rast crs rowColFromCell cellFromXY as.matrix xyFromCell cellFromRowCol</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">441</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @importFrom sf st_transform st_coordinates st_linestring st_sfc st_crs</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">442</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @examples </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">443</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">444</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' source(system.file("extdata", "walker_data.R", package = "hyRefactor"))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">445</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">446</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' start_point &lt;- sf::st_sfc(sf::st_point(c(-122.7, 38.126)), crs = 4326)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">447</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' distance &lt;- 100</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">448</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">449</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' line &lt;- sf::st_transform(dplyr::filter(walker_flowline,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">450</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'                                        COMID == 5329435),</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">451</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'                          sf::st_crs(walker_fdr))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">452</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">453</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' fdr &lt;- terra::mask(walker_fdr, line, inverse = TRUE)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">454</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">455</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' xy &lt;- trace_downstream(start_point, fdr, distance)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">456</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">457</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">trace_downstream &lt;- function(start_point, fdr, distance = 10000) {</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">458</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">459</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">460</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if(!inherits(fdr, "SpatRaster")){</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">461</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    fdr = terra::rast(fdr)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">462</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">463</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"> </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">464</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">465</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  lookup_rowcol &lt;- rep(list(list()), 128)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">466</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  lookup_rowcol[[1]] &lt;- c(0, 1)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">467</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  lookup_rowcol[[2]] &lt;- c(1, 1)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">468</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  lookup_rowcol[[4]] &lt;- c(1, 0)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">469</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  lookup_rowcol[[8]] &lt;- c(1, -1)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">470</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  lookup_rowcol[[16]] &lt;- c(0, -1)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">471</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  lookup_rowcol[[32]] &lt;- c(-1, -1)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">472</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  lookup_rowcol[[64]] &lt;- c(-1, 0)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">473</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  lookup_rowcol[[128]] &lt;- c(-1, 1)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">474</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">475</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # start point in raster projection</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">476</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  stp &lt;- sf::st_transform(start_point, terra::crs(fdr))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">477</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">478</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # 1X2 matrix giving start row and col in raster</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">479</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  sti &lt;- terra::rowColFromCell(fdr, terra::cellFromXY(fdr, st_coordinates(stp)))  </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">480</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">481</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  fdr_matrix &lt;- terra::as.matrix(fdr, wide = TRUE)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">482</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">483</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # empty max distance X 2 matrix </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">484</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  track &lt;- matrix(nrow = distance, ncol = 2)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">485</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">486</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # distance counter</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">487</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  d &lt;- 1</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">488</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">489</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # starting local flow direction</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">490</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  local_dir &lt;- fdr_matrix[sti]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">491</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">492</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # stop if at distance or local direction is NA</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">493</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  while(d &lt;= distance &amp; !is.na(local_dir)) {</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">494</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">495</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    # add row col to track</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">496</td>
                    <td class="coverage">19<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    track[d, ] &lt;- sti</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">497</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">498</td>
                    <td class="coverage">19<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    d &lt;- d + 1</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">499</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">500</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    # next row col based on local flow direction</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">501</td>
                    <td class="coverage">19<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    sti &lt;- sti + lookup_rowcol[[local_dir]]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">502</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">503</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    # next local flow direction from matrix</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">504</td>
                    <td class="coverage">19<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    local_dir &lt;- fdr_matrix[sti]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">505</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">506</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">507</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # truncate track in case of NA stop</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">508</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  track &lt;- track[!is.na(track[,1]), ]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">509</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">510</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # get xy for all row/col from track and fddr</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">511</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  xy &lt;- terra::xyFromCell(fdr, terra::cellFromRowCol(fdr, track[, 1], track[, 2]))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">512</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">513</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # return sfc linestring in projection of fdr</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">514</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  sf::st_sfc(sf::st_linestring(xy), crs = sf::st_crs(fdr))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">515</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">516</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div id="R/collapse.R" class="hidden">
              <table class="table-condensed">
                <tbody>
                  <tr class="never">
                    <td class="num">1</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @title Collapse NHDPlus Network</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">2</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @description Refactors the NHDPlus flowline network, eliminating short and</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">3</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' non-confluence flowlines. The aim of this function is to create flowpaths</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">4</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' that describe a network of catchments that combines complex hydrology near</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">5</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' confluences into upstream catchments and removes very short flowlines along mainstem</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">6</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' flow-paths.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">7</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param flines data.frame with COMID, toCOMID, LENGTHKM, Hydroseq, and LevelPathI columns</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">8</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param thresh numeric a length threshold (km). Flowlines shorter than this</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">9</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' will be collapsed with up or downstream flowlines.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">10</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param add_category boolean if combination category is desired in output, set</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">11</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' to TRUE</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">12</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param mainstem_thresh numeric threshold for combining inter-confluence</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">13</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' mainstems</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">14</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param exclude_cats integer vector of COMIDs to be excluded from collapse modifications.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">15</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param warn boolean controls whether warning an status messages are printed</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">16</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @return A refactored network with merged up and down flowlines.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">17</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @importFrom dplyr filter left_join select mutate group_by ungroup summarise</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">18</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' distinct</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">19</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @seealso The \code{\link{refactor_nhdplus}} function implements a complete</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">20</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' workflow using `collapse_flowlines()`.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">21</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @export</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">22</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">23</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">collapse_flowlines &lt;- function(flines, thresh, add_category = FALSE,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">24</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                               mainstem_thresh = NULL, exclude_cats = NULL,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">25</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                               warn = TRUE) {</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">26</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">27</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  check_names(flines, "collapse_flowlines")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">28</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">29</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  flines[["toCOMID"]][flines[["toCOMID"]] == 0] &lt;- NA</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">30</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">31</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # very large thresh</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">32</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (is.null(mainstem_thresh)) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">33</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    mainstem_thresh_use &lt;- max(flines$LENGTHKM)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">34</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  } else {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">35</td>
                    <td class="coverage">37<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    mainstem_thresh_use &lt;- mainstem_thresh</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">36</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">37</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">38</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  original_fline_atts &lt;- flines</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">39</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">40</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  short_outlets_tracker &lt;- c()</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">41</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  headwaters_tracker &lt;- c()</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">42</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  removed_mainstem &lt;- data.frame(removed_COMID = c(), stringsAsFactors = FALSE)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">43</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">44</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  #######################################################</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">45</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # Short Outlets</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">46</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  #######################################################</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">47</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # Need to clean up the short outlets first so they don't get broken</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">48</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # by the method below.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">49</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">50</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  flines &lt;- collapse_outlets(flines, thresh, original_fline_atts, exclude_cats, warn)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">51</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">52</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  short_outlets_tracker &lt;- flines[["short_outlets_tracker"]]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">53</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  flines &lt;- flines[["flines"]]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">54</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">55</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  #######################################################</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">56</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # Short Headwaters</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">57</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  #######################################################</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">58</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # Next merge headwaters that don't cross confluences downstream</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">59</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">60</td>
                    <td class="coverage">22<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (!"joined_toCOMID" %in% names(flines)) flines[["joined_toCOMID"]] &lt;- NA</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">61</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (!"joined_fromCOMID" %in% names(flines)) flines[["joined_fromCOMID"]] &lt;- NA</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">62</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">63</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # Clean up short headwaters that aren't handled by the next downstream</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">64</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # logic above.</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">65</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  remove_headwaters &lt;- function(flines) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">66</td>
                    <td class="coverage">110<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    !(flines$COMID %in% flines$toCOMID) &amp; # a headwater (nothing flows to it)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">67</td>
                    <td class="coverage">110<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      !flines$COMID %in% exclude_cats &amp; # Not in exclude list.</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">68</td>
                    <td class="coverage">110<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      flines$LENGTHKM &lt; thresh &amp; # shorter than threshold</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">69</td>
                    <td class="coverage">110<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      is.na(flines$joined_fromCOMID) &amp;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">70</td>
                    <td class="coverage">110<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      is.na(flines$joined_toCOMID) &amp;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">71</td>
                    <td class="coverage">110<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      !(is.na(flines$toCOMID) | !flines$toCOMID %in% flines$COMID) &amp;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">72</td>
                    <td class="coverage">110<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      flines$toCOMID != -9999</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">73</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">74</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">75</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  flines &lt;- reconcile_downstream(flines, remove_headwaters,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">76</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                 remove_problem_headwaters = TRUE)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">77</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">78</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  headwaters_tracker &lt;- flines[["removed_tracker"]]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">79</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  flines &lt;- flines[["flines"]]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">80</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">81</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  #######################################################</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">82</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # Short Interconfluence Flowpath Top Flowlines</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">83</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  #######################################################</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">84</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # If mainstems are being collapsed at a threshold, these need to be</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">85</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # treated seperately</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">86</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  mainstem_top_tracker &lt;- NULL</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">87</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (!is.null(mainstem_thresh)) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">88</td>
                    <td class="coverage">37<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    flines$num_upstream &lt;- get_num_upstream(flines)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">89</td>
                    <td class="coverage">37<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    flines$ds_num_upstream &lt;- get_ds_num_upstream(flines)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">90</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">91</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    # At the top of a mainstem</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">92</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    # shorter than mainstem threshold</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">93</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    # is still in scope</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">94</td>
                    <td class="coverage">37<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    remove_mainstem_top &lt;- function(flines) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">95</td>
                    <td class="coverage">62<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      (flines$num_upstream &gt; 1 &amp;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">96</td>
                    <td class="coverage">62<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">         flines$ds_num_upstream == 1) &amp;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">97</td>
                    <td class="coverage">62<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        flines$LENGTHKM &lt; mainstem_thresh_use &amp;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">98</td>
                    <td class="coverage">62<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        !(is.na(flines$toCOMID) | !flines$toCOMID %in% flines$COMID) &amp;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">99</td>
                    <td class="coverage">62<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        !flines$COMID %in% exclude_cats</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">100</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">101</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">102</td>
                    <td class="coverage">37<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    flines &lt;- reconcile_downstream(flines, remove_mainstem_top,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">103</td>
                    <td class="coverage">37<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                   remove_problem_headwaters = FALSE)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">104</td>
                    <td class="coverage">37<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    mainstem_top_tracker &lt;- flines[["removed_tracker"]]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">105</td>
                    <td class="coverage">37<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    flines &lt;- flines[["flines"]]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">106</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">107</td>
                    <td class="coverage">37<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    flines &lt;- select(flines, -num_upstream, -ds_num_upstream)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">108</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">109</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">110</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  #######################################################</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">111</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # Short Interconfluence Flowpath Flowlines</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">112</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  #######################################################</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">113</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # Combine along main stems with no confluences.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">114</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">115</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  flines &lt;- mutate(flines,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">116</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                   dsLENGTHKM = get_ds_lengthkm(flines),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">117</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                   ds_num_upstream = get_ds_num_upstream(flines))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">118</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">119</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                            # is still in scope</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">120</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  reroute_mainstem_set &lt;- (flines$dsLENGTHKM &gt; 0 &amp;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">121</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                             # wasn't already collapsed as a headwater</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">122</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                             is.na(flines$joined_toCOMID) &amp;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">123</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                             # is not upstream of a confluence</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">124</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                             flines$ds_num_upstream == 1 &amp;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">125</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                             # is shorter than the mainstem threshold</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">126</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                             flines$dsLENGTHKM &lt; mainstem_thresh_use &amp;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">127</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                             !flines$toCOMID %in% exclude_cats)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">128</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">129</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">130</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # This is the set that is going to get skipped in the rerouting.</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">131</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  removed_mainstem &lt;- data.frame(removed_COMID =</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">132</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                   flines[["toCOMID"]][reroute_mainstem_set],</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">133</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                 joined_fromCOMID =</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">134</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                   flines[["COMID"]][reroute_mainstem_set],</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">135</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                 stringsAsFactors = FALSE)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">136</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">137</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  flines &lt;- reconcile_removed_flowlines(flines,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">138</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                        reroute_mainstem_set,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">139</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                        removed_mainstem,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">140</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                        original_fline_atts)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">141</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">142</td>
                    <td class="coverage">29<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (nrow(removed_mainstem) &gt; 0) removed_mainstem[["joined_toCOMID"]] &lt;- NA</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">143</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">144</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (!is.null(mainstem_thresh) &amp; !is.null(mainstem_top_tracker)) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">145</td>
                    <td class="coverage">25<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    removed_mainstem_top &lt;-</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">146</td>
                    <td class="coverage">25<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      left_join(data.frame(removed_COMID = mainstem_top_tracker,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">147</td>
                    <td class="coverage">25<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                           joined_fromCOMID = NA, stringsAsFactors = FALSE),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">148</td>
                    <td class="coverage">25<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                select(flines, COMID, joined_toCOMID),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">149</td>
                    <td class="coverage">25<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                by = c("removed_COMID" = "COMID"))</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">150</td>
                    <td class="coverage">25<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    removed_mainstem &lt;- rbind(removed_mainstem, removed_mainstem_top)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">151</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">152</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  #######################################################</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">153</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # Short Single Confluence to Confluence Flowpaths</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">154</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  #######################################################</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">155</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # Combine accross confluences next -</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">156</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # slightly different logic from "mainstems"</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">157</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">158</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  flines &lt;- mutate(flines,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">159</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                   dsLENGTHKM = get_ds_lengthkm(flines),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">160</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                   ds_num_upstream = get_ds_num_upstream(flines))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">161</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">162</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # This is the set that is going to get</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">163</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # rerouted removing their next downstream.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">164</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # removes all terminal and already removed</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">165</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # flowlines from consideration.</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">166</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  reroute_confluence_set &lt;- (flines$dsLENGTHKM &lt; thresh &amp;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">167</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                               flines$dsLENGTHKM &gt; 0 &amp;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">168</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                               flines$ds_num_upstream &gt; 1 &amp;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">169</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                               !flines$toCOMID %in% exclude_cats)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">170</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">171</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  flines &lt;- select(flines, -ds_num_upstream)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">172</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">173</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # This is the set that is going to get skipped in the rerouting.</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">174</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  removed_confluence &lt;-</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">175</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    data.frame(removed_COMID = flines[["toCOMID"]][reroute_confluence_set],</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">176</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">               joined_fromCOMID = flines[["COMID"]][reroute_confluence_set],</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">177</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">               stringsAsFactors = FALSE)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">178</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">179</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # Need to deduplicate the upstream that removed will get collapsed into.</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">180</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  removed_confluence &lt;-</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">181</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    group_by(left_join(removed_confluence,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">182</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                       select(original_fline_atts, COMID,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">183</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                              # Get upstream area and length</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">184</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                              usLevelPathI = LevelPathI),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">185</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                       by = c("joined_fromCOMID" = "COMID")),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">186</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">             removed_COMID)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">187</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">188</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if(nrow(removed_confluence) &gt; 0) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">189</td>
                    <td class="coverage">33<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    removed_confluence &lt;-</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">190</td>
                    <td class="coverage">33<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      select(ungroup(filter(removed_confluence,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">191</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                            # Deduplicate by largest trib path</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">192</td>
                    <td class="coverage">33<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                            usLevelPathI == min(usLevelPathI))),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">193</td>
                    <td class="coverage">33<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">             -usLevelPathI) # clean</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">194</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">195</td>
                    <td class="coverage">33<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    flines &lt;- reconcile_removed_flowlines(flines,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">196</td>
                    <td class="coverage">33<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                          reroute_confluence_set,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">197</td>
                    <td class="coverage">33<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                          removed_confluence,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">198</td>
                    <td class="coverage">33<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                          original_fline_atts)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">199</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">200</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  ####################################</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">201</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # Cleanup and prepare output</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">202</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  ####################################</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">203</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # Catchments that joined downstream but are</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">204</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # referenced as a joined fromCOMID.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">205</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # These need to be adjusted to be joined_toCOMID the same</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">206</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # as the one they reference in joined_fromCOMID.</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">207</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  potential_bad_rows &lt;-</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">208</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    flines$COMID[which(!is.na(flines$joined_toCOMID) &amp;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">209</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                         flines$joined_toCOMID != -9999)]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">210</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  bad_joined_fromcomid &lt;-</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">211</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    potential_bad_rows[potential_bad_rows %in%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">212</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                         flines$joined_fromCOMID]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">213</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">214</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (length(bad_joined_fromcomid &gt; 0)) {</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">215</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    # This is the row we will update</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">216</td>
                    <td class="coverage">9<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    bad_joined_fromcomid_index &lt;- match(bad_joined_fromcomid,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">217</td>
                    <td class="coverage">9<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                        flines$joined_fromCOMID)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">218</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">219</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    # This is the row we will get our update from</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">220</td>
                    <td class="coverage">9<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    new_joined_tocomid_index &lt;- match(bad_joined_fromcomid,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">221</td>
                    <td class="coverage">9<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                      flines$COMID)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">222</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">223</td>
                    <td class="coverage">9<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    flines$joined_toCOMID[bad_joined_fromcomid_index] &lt;-</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">224</td>
                    <td class="coverage">9<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      flines$joined_toCOMID[new_joined_tocomid_index]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">225</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    .</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">226</td>
                    <td class="coverage">9<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    flines$joined_fromCOMID[bad_joined_fromcomid_index] &lt;- NA</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">227</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">228</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">229</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # And the opposite direction</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">230</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  potential_bad_rows &lt;-</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">231</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    flines$COMID[which(!is.na(flines$joined_fromCOMID) &amp;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">232</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                         flines$joined_fromCOMID != -9999)]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">233</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  bad_joined_tocomid &lt;-</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">234</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    potential_bad_rows[potential_bad_rows %in%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">235</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                         flines$joined_toCOMID]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">236</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">237</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (length(bad_joined_tocomid &gt; 0)) {</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">238</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    # This is the row we will update</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">239</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    bad_joined_tocomid_index &lt;- match(bad_joined_tocomid,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">240</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                      flines$joined_toCOMID)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">241</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">242</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    # This is the row we will get our update from</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">243</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    new_joined_fromcomid_index &lt;- match(bad_joined_tocomid, flines$COMID)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">244</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">245</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    flines$joined_fromCOMID[bad_joined_tocomid_index] &lt;-</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">246</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      flines$joined_fromCOMID[new_joined_fromcomid_index]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">247</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">248</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    flines$joined_toCOMID[bad_joined_tocomid_index] &lt;- NA</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">249</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">250</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">251</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (add_category) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">252</td>
                    <td class="coverage">32<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (!"join_category" %in% names(flines)) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">253</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      flines$join_category &lt;- NA</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">254</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">255</td>
                    <td class="coverage">32<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    flines &lt;-</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">256</td>
                    <td class="coverage">32<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      mutate(flines,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">257</td>
                    <td class="coverage">32<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">       join_category = ifelse(COMID %in% short_outlets_tracker, "outlet",</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">258</td>
                    <td class="coverage">32<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        ifelse(COMID %in% removed_mainstem$removed_COMID, "mainstem",</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">259</td>
                    <td class="coverage">32<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          ifelse(COMID %in% removed_confluence$removed_COMID, "confluence",</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">260</td>
                    <td class="coverage">32<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">            ifelse(COMID %in% headwaters_tracker, "headwater",</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">261</td>
                    <td class="coverage">32<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                   join_category)))))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">262</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">263</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">264</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # This takes care of na toCOMIDs that result from join_toCOMID pointers.</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">265</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  flines &lt;- left_join(flines,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">266</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                      select(flines,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">267</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                             COMID,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">268</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                             new_toCOMID = joined_toCOMID),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">269</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                      by = c("toCOMID" = "COMID"))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">270</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">271</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  flines &lt;- mutate(flines, toCOMID = ifelse(!is.na(new_toCOMID),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">272</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                            new_toCOMID, toCOMID))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">273</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">274</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  flines &lt;- select(flines, -new_toCOMID)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">275</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">276</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  bad_rows_to &lt;- function(flines) is.na(flines$toCOMID) &amp;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">277</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    flines$LENGTHKM == 0 &amp;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">278</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    flines$COMID %in% flines$joined_toCOMID &amp;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">279</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    flines$joined_toCOMID != -9999</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">280</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">281</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  bad_rows_from &lt;- function(flines) is.na(flines$toCOMID) &amp;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">282</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    flines$LENGTHKM == 0 &amp;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">283</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    flines$COMID %in% flines$joined_fromCOMID &amp;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">284</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    flines$joined_fromCOMID != -9999</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">285</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">286</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  count &lt;- 0</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">287</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">288</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # Should investigate why NAs are coming out of the splitter.</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">289</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  while (any(bad_rows_to(flines), na.rm = TRUE) |</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">290</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">         any(bad_rows_from(flines), na.rm = TRUE)) {</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">291</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">292</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    flines &lt;- left_join(flines,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">293</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                        select(flines,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">294</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                               new_joined_toCOMID = joined_toCOMID,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">295</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                               new_joined_fromCOMID = joined_fromCOMID,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">296</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                               COMID), by = c("joined_toCOMID" = "COMID"))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">297</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">298</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    flines &lt;-</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">299</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      mutate(flines,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">300</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">             joined_toCOMID =</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">301</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">               ifelse((!is.na(new_joined_toCOMID) &amp;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">302</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                          new_joined_toCOMID != -9999),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">303</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                       new_joined_toCOMID,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">304</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                       ifelse((!is.na(new_joined_fromCOMID) &amp;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">305</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                  new_joined_fromCOMID != -9999),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">306</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                               new_joined_fromCOMID,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">307</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                               joined_toCOMID)))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">308</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">309</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    flines &lt;- select(flines, -new_joined_toCOMID, -new_joined_fromCOMID)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">310</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">311</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    flines &lt;- left_join(flines,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">312</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                        select(flines,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">313</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                               new_joined_toCOMID = joined_toCOMID,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">314</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                               new_joined_fromCOMID = joined_fromCOMID,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">315</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                               COMID), by = c("joined_fromCOMID" = "COMID"))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">316</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">317</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    flines &lt;-</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">318</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      mutate(flines,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">319</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">             joined_fromCOMID =</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">320</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">               ifelse((!is.na(new_joined_fromCOMID) &amp;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">321</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                          new_joined_fromCOMID != -9999),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">322</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                       new_joined_fromCOMID,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">323</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                       ifelse((!is.na(new_joined_toCOMID) &amp;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">324</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                  new_joined_toCOMID != -9999),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">325</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                               new_joined_toCOMID,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">326</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                               joined_fromCOMID)))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">327</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">328</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    flines &lt;- select(flines, -new_joined_toCOMID, -new_joined_fromCOMID)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">329</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">330</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    count &lt;- count + 1</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">331</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (count &gt; 20) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">332</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      stop("stuck in final clean up loop")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">333</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">334</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">335</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">336</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">337</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  return(distinct(flines))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">338</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">339</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">340</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @title Collapse Outlets</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">341</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @description Collapses outlet flowlines upstream.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">342</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' Returns an flines dataframe.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">343</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param flines data.frame with</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">344</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' COMID, toCOMID, LENGTHKM, and LevelPathI columns</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">345</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param thresh numeric a length threshold (km). Flowlines shorter than</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">346</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' this will be eliminated</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">347</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param original_fline_atts data.frame containing original fline attributes.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">348</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param warn boolean controls whether warning an status messages are printed</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">349</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @return flines data.frame with outlets collapsed to the given threshold.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">350</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @importFrom dplyr filter left_join select mutate group_by ungroup</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">351</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @noRd</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">352</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">353</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">collapse_outlets &lt;- function(flines, thresh,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">354</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                             original_fline_atts,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">355</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                             exclude_cats = NULL,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">356</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                             warn = TRUE) {</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">357</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">358</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (("joined_toCOMID" %in% names(flines) |</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">359</td>
                    <td class="coverage">41<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        "joined_fromCOMID" %in% names(flines))) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">360</td>
                    <td class="coverage">19<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (warn) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">361</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      warning("collapse outllets must be used with un modified flines. \n",</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">362</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">              "returning unmodified flines from collapse outlets. \n")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">363</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">364</td>
                    <td class="coverage">19<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    return(list(flines = flines, short_outlets_tracker = c()))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">365</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">366</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">367</td>
                    <td class="coverage">22<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  flines[["joined_fromCOMID"]] &lt;- NA</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">368</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">369</td>
                    <td class="coverage">22<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  short_outlets &lt;- function(flines) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">370</td>
                    <td class="coverage">142<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    is.na(flines$toCOMID) &amp; # No toCOMID,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">371</td>
                    <td class="coverage">142<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      !flines$COMID %in% exclude_cats &amp; # Not in exclude list</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">372</td>
                    <td class="coverage">142<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      flines$LENGTHKM &lt; thresh &amp; # too short,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">373</td>
                    <td class="coverage">142<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      is.na(flines$joined_fromCOMID) # and hasn't been collapsed yet.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">374</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">375</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">376</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  #######################################################</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">377</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">378</td>
                    <td class="coverage">22<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  count &lt;- 0</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">379</td>
                    <td class="coverage">22<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  short_outlets_tracker &lt;- c()</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">380</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">381</td>
                    <td class="coverage">22<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  while (any(short_outlets(flines))) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">382</td>
                    <td class="coverage">40<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    short_flines_next &lt;- filter(flines, short_outlets(flines))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">383</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">384</td>
                    <td class="coverage">40<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (!exists("short_flines")) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">385</td>
                    <td class="coverage">9<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      short_flines &lt;- short_flines_next</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">386</td>
                    <td class="coverage">31<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    } else if (all(short_flines_next$COMID %in% short_flines$COMID)) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">387</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      stop("Stuck in short flines loop")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">388</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    } else {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">389</td>
                    <td class="coverage">31<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      short_flines &lt;- short_flines_next</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">390</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">391</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">392</td>
                    <td class="coverage">40<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    short_flines_index &lt;- which(short_outlets(flines))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">393</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">394</td>
                    <td class="coverage">40<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    headwaters &lt;- !short_flines$COMID %in% original_fline_atts$toCOMID</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">395</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">396</td>
                    <td class="coverage">40<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (any(headwaters)) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">397</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      headwater_comids &lt;- short_flines[["COMID"]][which(headwaters)]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">398</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      flines[["joined_fromCOMID"]][match(headwater_comids,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">399</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                         flines$COMID)] &lt;- -9999</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">400</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      short_flines &lt;- short_flines[!headwaters, ]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">401</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      short_flines_index &lt;- short_flines_index[!headwaters]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">402</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">403</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">404</td>
                    <td class="coverage">40<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if(nrow(short_flines) &gt; 0) {</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">405</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      # Get from length and from area with a join on toCOMID.</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">406</td>
                    <td class="coverage">37<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      short_flines &lt;- left_join(short_flines,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">407</td>
                    <td class="coverage">37<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                select(original_fline_atts, toCOMID,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">408</td>
                    <td class="coverage">37<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                       fromCOMID = COMID,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">409</td>
                    <td class="coverage">37<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                       fromLevelPathI = LevelPathI),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">410</td>
                    <td class="coverage">37<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                by = c("COMID" = "toCOMID")) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">411</td>
                    <td class="coverage">37<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        group_by(COMID) %&gt;%  # deduplicate with level path then length.</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">412</td>
                    <td class="coverage">37<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        filter(is.na(joined_fromCOMID) | joined_fromCOMID != -9999) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">413</td>
                    <td class="coverage">37<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        filter(fromLevelPathI == min(fromLevelPathI)) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">414</td>
                    <td class="coverage">37<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        ungroup()</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">415</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">416</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    # This is a pointer to the flines rows that need to</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">417</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    # absorb a downstream short flowline.</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">418</td>
                    <td class="coverage">37<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    flines_to_update_index &lt;- match(short_flines$fromCOMID, flines$COMID)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">419</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">420</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    # Adjust the length of the set we need to update.</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">421</td>
                    <td class="coverage">37<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    flines[["LENGTHKM"]][flines_to_update_index] &lt;-</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">422</td>
                    <td class="coverage">37<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      flines[["LENGTHKM"]][flines_to_update_index] +</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">423</td>
                    <td class="coverage">37<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      flines[["LENGTHKM"]][short_flines_index]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">424</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">425</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    # Set LENGTHKM to 0 since this one's gone from the network.</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">426</td>
                    <td class="coverage">37<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    flines[["LENGTHKM"]][short_flines_index] &lt;- 0</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">427</td>
                    <td class="coverage">37<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    flines[["toCOMID"]][flines_to_update_index] &lt;- NA</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">428</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">429</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    # Check if the eliminated COMID had anything going to it.</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">430</td>
                    <td class="coverage">37<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    need_to_update_index &lt;-</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">431</td>
                    <td class="coverage">37<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      which(flines$joined_fromCOMID %in% short_flines$COMID)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">432</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">433</td>
                    <td class="coverage">37<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    flines[["joined_fromCOMID"]][need_to_update_index] &lt;-</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">434</td>
                    <td class="coverage">37<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      short_flines$fromCOMID</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">435</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">436</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    # Mark the ones that are being removed with</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">437</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    # which comid they got joined with.</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">438</td>
                    <td class="coverage">37<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    flines[["joined_fromCOMID"]][short_flines_index] &lt;-</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">439</td>
                    <td class="coverage">37<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      short_flines$fromCOMID</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">440</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">441</td>
                    <td class="coverage">37<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    short_outlets_tracker &lt;- c(short_outlets_tracker,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">442</td>
                    <td class="coverage">37<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                               flines[["COMID"]][short_flines_index])</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">443</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">444</td>
                    <td class="coverage">40<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    count &lt;- count + 1</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">445</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (count &gt; 100) stop("stuck in short outlet loop")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">446</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">447</td>
                    <td class="coverage">22<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  return(list(flines = flines, short_outlets_tracker = short_outlets_tracker))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">448</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">449</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">450</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @title Reconcile removed flowlines</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">451</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @description Reconciles removed/missing flowlines from the network.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">452</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param flines data.frame ...</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">453</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param reroute_set boolean ...</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">454</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param removed data.frame ...</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">455</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param original_fline_atts data.frame ...</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">456</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param normalize_mainstems boolean ...</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">457</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @return reconciled flines</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">458</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @importFrom dplyr filter left_join select rename mutate arrange distinct</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">459</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @noRd</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">460</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">461</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">reconcile_removed_flowlines &lt;- function(flines, reroute_set, removed,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">462</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                        original_fline_atts,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">463</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                        normalize_mainstems = FALSE) {</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">464</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">465</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # Everything that is rerouted gets its length adjusted.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">466</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # e.g. both tribs and main stem get lengthened the same.</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">467</td>
                    <td class="coverage">74<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  flines[["LENGTHKM"]][reroute_set] &lt;-</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">468</td>
                    <td class="coverage">74<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    flines[["LENGTHKM"]][reroute_set] + flines[["dsLENGTHKM"]][reroute_set]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">469</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">470</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # Adjust all the ToNodes to go to the next downstream.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">471</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # This is ONLY working on the reroute set!!</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">472</td>
                    <td class="coverage">74<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  downstream_index &lt;- match(flines[["toCOMID"]][reroute_set], flines$COMID)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">473</td>
                    <td class="coverage">74<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  flines[["toCOMID"]][reroute_set] &lt;- flines[["toCOMID"]][downstream_index]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">474</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">475</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # stale_tocomid is true if the toCOMID is one of the removed comids.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">476</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # We need to change those toCOMIDs to the toCOMID of the removed flowline</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">477</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # Need to keep doing it until no toCOMIDs are pointing to removed catchmetns</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">478</td>
                    <td class="coverage">74<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  stale_tocomid &lt;- function() which(flines$toCOMID %in% removed$removed_COMID)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">479</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">480</td>
                    <td class="coverage">74<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  count &lt;- 0</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">481</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">482</td>
                    <td class="coverage">74<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  while (length(stale_tocomid()) &gt; 0) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">483</td>
                    <td class="coverage">76<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    bad_tocomid &lt;- flines[["toCOMID"]][stale_tocomid()]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">484</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">485</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    # downstream_index is a pointer to flowline that was</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">486</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    # removed that we want the toCOMID of.</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">487</td>
                    <td class="coverage">76<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    downstream_index &lt;- match(bad_tocomid, flines$COMID)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">488</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">489</td>
                    <td class="coverage">76<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (any(flines[["toCOMID"]][stale_tocomid()] ==</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">490</td>
                    <td class="coverage">76<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">            flines[["toCOMID"]][downstream_index], na.rm = TRUE)) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">491</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      stop("found a loop while culling stale toCOMIDs!!!")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">492</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">493</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">494</td>
                    <td class="coverage">76<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    flines[["LENGTHKM"]][stale_tocomid()] &lt;-</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">495</td>
                    <td class="coverage">76<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      flines[["LENGTHKM"]][stale_tocomid()] +</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">496</td>
                    <td class="coverage">76<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      flines[["LENGTHKM"]][downstream_index]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">497</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">498</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    # This is the bad_tocomid that we are making good.</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">499</td>
                    <td class="coverage">76<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    flines[["toCOMID"]][stale_tocomid()] &lt;-</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">500</td>
                    <td class="coverage">76<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      flines[["toCOMID"]][downstream_index]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">501</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">502</td>
                    <td class="coverage">76<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    count &lt;- count + 1</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">503</td>
                    <td class="coverage">76<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (count &gt; 100) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">504</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      stop("stuck in stale toCOMID loop")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">505</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">506</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">507</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">508</td>
                    <td class="coverage">74<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  already_removed &lt;- filter(flines, (!is.na(joined_fromCOMID) &amp;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">509</td>
                    <td class="coverage">74<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                       joined_fromCOMID != -9999)) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">510</td>
                    <td class="coverage">74<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    select(removed_COMID = COMID, joined_fromCOMID)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">511</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">512</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # Need to sort removed_COMID by drainage area to get</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">513</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # the right "first matches" below.</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">514</td>
                    <td class="coverage">74<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  removed &lt;- left_join(rbind(removed, already_removed),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">515</td>
                    <td class="coverage">74<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                       select(original_fline_atts, .data$COMID, .data$Hydroseq),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">516</td>
                    <td class="coverage">74<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                       by = c("removed_COMID" = "COMID")) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">517</td>
                    <td class="coverage">74<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    arrange(.data$Hydroseq) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">518</td>
                    <td class="coverage">74<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    select(-.data$Hydroseq) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">519</td>
                    <td class="coverage">74<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    distinct()</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">520</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">521</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # This is a pointer to joined_fromCOMID records</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">522</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # that point to already removed COMIDs.</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">523</td>
                    <td class="coverage">74<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  joined_from_to_replace &lt;- function(removed) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">524</td>
                    <td class="coverage">176<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    which(removed$joined_fromCOMID %in% removed$removed_COMID)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">525</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">526</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">527</td>
                    <td class="coverage">74<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  count &lt;- 0</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">528</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">529</td>
                    <td class="coverage">74<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  while (length(joined_from_to_replace(removed)) &gt; 0) {</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">530</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # left join to its self in the joined_from direction. Copy over and repeat.</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">531</td>
                    <td class="coverage">102<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    removed &lt;- left_join(removed,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">532</td>
                    <td class="coverage">102<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                         rename(removed,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">533</td>
                    <td class="coverage">102<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                joined_fromCOMID_new = joined_fromCOMID),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">534</td>
                    <td class="coverage">102<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                         by = c("joined_fromCOMID" = "removed_COMID")) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">535</td>
                    <td class="coverage">102<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      mutate(joined_fromCOMID = ifelse(!is.na(joined_fromCOMID_new),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">536</td>
                    <td class="coverage">102<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                       joined_fromCOMID_new,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">537</td>
                    <td class="coverage">102<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                       joined_fromCOMID)) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">538</td>
                    <td class="coverage">102<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      select(-joined_fromCOMID_new)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">539</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">540</td>
                    <td class="coverage">102<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    count &lt;- count + 1</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">541</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (count &gt; 100) stop("stuck in joined from to replace loop")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">542</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">543</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">544</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # Actually join the removed dataframe to the flines dataframe.</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">545</td>
                    <td class="coverage">74<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  flines &lt;- left_join(flines, rename(removed,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">546</td>
                    <td class="coverage">74<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                     joined_fromCOMID_new = joined_fromCOMID),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">547</td>
                    <td class="coverage">74<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                      by = c("COMID" = "removed_COMID")) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">548</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    # get the outlet_joinedCOMID set into the joined_fromCOMID set too.</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">549</td>
                    <td class="coverage">74<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    mutate(joined_fromCOMID = ifelse(!is.na(joined_fromCOMID_new),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">550</td>
                    <td class="coverage">74<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                     joined_fromCOMID_new,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">551</td>
                    <td class="coverage">74<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                     joined_fromCOMID),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">552</td>
                    <td class="coverage">74<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">           LENGTHKM = ifelse((!is.na(joined_fromCOMID) &amp;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">553</td>
                    <td class="coverage">74<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                 joined_fromCOMID != -9999), 0, LENGTHKM),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">554</td>
                    <td class="coverage">74<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">           toCOMID = ifelse((!is.na(joined_fromCOMID) &amp;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">555</td>
                    <td class="coverage">74<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                joined_toCOMID != -9999), NA, toCOMID)) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">556</td>
                    <td class="coverage">74<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    select(-joined_fromCOMID_new, -dsLENGTHKM)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">557</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">558</td>
                    <td class="coverage">74<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  return(flines)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">559</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">560</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">561</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @title Reconcile removed flowlines in the downstream direction</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">562</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @description ... TBD ...</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">563</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param flines data.frame with COMID, toCOMID, LENGTHKM, Hydroseq, and LevelPathI columns</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">564</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param remove_fun a function that will return boolean indicating which flines should be removed</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">565</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param remove_problem_headwaters whether to mark headwaters upstream of confluences as unable to remove</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">566</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @return flines data.frame with short flowlines merged downstream</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">567</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @noRd</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">568</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">569</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">reconcile_downstream &lt;- function(flines, remove_fun,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">570</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                 remove_problem_headwaters = FALSE) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">571</td>
                    <td class="coverage">78<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  removed_tracker &lt;- c()</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">572</td>
                    <td class="coverage">78<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  count &lt;- 0</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">573</td>
                    <td class="coverage">78<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  rfl &lt;- remove_fun(flines)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">574</td>
                    <td class="coverage">78<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  while (any(rfl, na.rm = TRUE)) {</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">575</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">576</td>
                    <td class="coverage">94<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    flines$ds_num_upstream &lt;- get_ds_num_upstream(flines)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">577</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">578</td>
                    <td class="coverage">94<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (remove_problem_headwaters) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">579</td>
                    <td class="coverage">69<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      flines[["ds_joined_fromCOMID"]] &lt;- get_ds_joined_fromcomid(flines)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">580</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">581</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      # problem headwaters</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">582</td>
                    <td class="coverage">69<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      ph &lt;- (rfl &amp; (flines$ds_num_upstream &gt; 1 |</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">583</td>
                    <td class="coverage">69<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                     !is.na(flines$ds_joined_fromCOMID))) | </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">584</td>
                    <td class="coverage">69<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        (rfl &amp; (flines$toCOMID == 0)) # flows to the coast</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">585</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">               </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">586</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">587</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      # remove problems from remove</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">588</td>
                    <td class="coverage">69<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      rfl &lt;- rfl &amp; !ph</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">589</td>
                    <td class="coverage">69<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      ph_index &lt;- which(ph)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">590</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">591</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      # Set broken ones to -9999 to indicate they can't be collapsed.</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">592</td>
                    <td class="coverage">69<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      flines[["joined_toCOMID"]][ph_index] &lt;- -9999</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">593</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">594</td>
                    <td class="coverage">69<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      flines &lt;- select(flines, -ds_joined_fromCOMID)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">595</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">596</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">597</td>
                    <td class="coverage">94<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    rfl_index &lt;- which(rfl)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">598</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">599</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    # Set joined_toCOMID for remove set.</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">600</td>
                    <td class="coverage">94<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    flines[["joined_toCOMID"]][rfl_index] &lt;- flines[["toCOMID"]][rfl_index]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">601</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">602</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    # Find index of next downstream to add length to.</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">603</td>
                    <td class="coverage">94<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    adjust_headwater_index &lt;-</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">604</td>
                    <td class="coverage">94<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      match(flines[["toCOMID"]][rfl_index], flines$COMID)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">605</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">606</td>
                    <td class="coverage">94<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    flines[["LENGTHKM"]][adjust_headwater_index] &lt;-</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">607</td>
                    <td class="coverage">94<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      flines[["LENGTHKM"]][adjust_headwater_index] +</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">608</td>
                    <td class="coverage">94<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      flines[["LENGTHKM"]][rfl_index]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">609</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">610</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    # Set removed so they won't get used later.</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">611</td>
                    <td class="coverage">94<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    flines[["LENGTHKM"]][rfl_index] &lt;- 0</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">612</td>
                    <td class="coverage">94<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    flines[["toCOMID"]][rfl_index] &lt;- NA</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">613</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">614</td>
                    <td class="coverage">94<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (count &gt; 0) {</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">615</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      # look for instances of COMID that are about to</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">616</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      # get skipped over -- fix them.</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">617</td>
                    <td class="coverage">39<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      flines &lt;- left_join(flines,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">618</td>
                    <td class="coverage">39<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                          filter(select(flines, COMID,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">619</td>
                    <td class="coverage">39<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                        new_joined_toCOMID = joined_toCOMID),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">620</td>
                    <td class="coverage">39<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                 !is.na(new_joined_toCOMID)),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">621</td>
                    <td class="coverage">39<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                          by = c("joined_toCOMID" = "COMID"))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">622</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">623</td>
                    <td class="coverage">39<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      flines &lt;- mutate(flines,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">624</td>
                    <td class="coverage">39<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                       joined_toCOMID =</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">625</td>
                    <td class="coverage">39<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                         ifelse((!is.na(new_joined_toCOMID) &amp;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">626</td>
                    <td class="coverage">39<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                    !new_joined_toCOMID == -9999),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">627</td>
                    <td class="coverage">39<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                 new_joined_toCOMID,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">628</td>
                    <td class="coverage">39<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                 joined_toCOMID))</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">629</td>
                    <td class="coverage">39<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      flines &lt;- select(flines, -new_joined_toCOMID)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">630</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">631</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">632</td>
                    <td class="coverage">94<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    removed_tracker &lt;- c(removed_tracker, flines[["COMID"]][rfl_index])</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">633</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">634</td>
                    <td class="coverage">94<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    count &lt;- count + 1</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">635</td>
                    <td class="coverage">94<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (count &gt; 100) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">636</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      stop("stuck in headwaters while loop")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">637</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">638</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">639</td>
                    <td class="coverage">94<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    rfl &lt;- remove_fun(flines)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">640</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">641</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">642</td>
                    <td class="coverage">78<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  return(list(flines = flines, removed_tracker = removed_tracker))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">643</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div id="R/split_flowline.R" class="hidden">
              <table class="table-condensed">
                <tbody>
                  <tr class="never">
                    <td class="num">1</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @title Split Flowlines</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">2</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @description A wrapper for split_lines that works on nhdplus attributes</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">3</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param flines data.frame with COMID, toCOMID, LENGTHKM</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">4</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' and LINESTRING sf column in "meters" projection</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">5</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param max_length maximum segment length to return</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">6</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param events data.frame containing events as generated by nhdplusTools::get_flowline_index() </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">7</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' if an `identifier` attribute is included, it will be passed through in the output table.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">8</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param para numeric how many threads to use in parallel computation</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">9</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param avoid vector of ids to avoid</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">10</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @return All the flowlines with some split apart. COMIDs are returned as strings </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">11</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' with a semantic part number appended. That is .1, .2, ... .10, .11, etc. are </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">12</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' appended and must be treated as one would treat a semantic version. .1 is the </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">13</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' most upstream and the sequence increases in the downstream direction.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">14</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @importFrom dplyr group_by ungroup filter select mutate lead n right_join</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">15</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @importFrom nhdplusTools rename_geometry</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">16</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @seealso The \code{\link{refactor_nhdplus}} function implements a complete</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">17</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' workflow using `split_flowlines()`.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">18</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @export</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">19</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @examples</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">20</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' source(system.file("extdata", "new_hope_data.R", package = "hyRefactor"))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">21</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">22</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' new_hope_flowline &lt;- </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">23</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'   dplyr::right_join(dplyr::select(new_hope_flowline, COMID, REACHCODE, FromMeas, ToMeas),</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">24</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'                     suppressWarnings(nhdplusTools::prepare_nhdplus(</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">25</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'                       new_hope_flowline, 0, 0, 0, FALSE, warn = FALSE)),</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">26</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'                     by = "COMID")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">27</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">28</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' split &lt;- split_flowlines(suppressWarnings(sf::st_cast(sf::st_transform(</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">29</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'   new_hope_flowline, 5070), "LINESTRING")),</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">30</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'                          max_length = 2000, events = new_hope_events)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">31</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">32</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">split_flowlines &lt;- function(flines, max_length = NULL, </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">33</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                            events = NULL, para = 0, avoid = NA) {</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">34</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">35</td>
                    <td class="coverage">17<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  check_names(flines, "split_flowlines")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">36</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">37</td>
                    <td class="coverage">17<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  flines &lt;- rename_geometry(flines, "geom")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">38</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">39</td>
                    <td class="coverage">17<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  split &lt;- split_lines(flines, max_length, events, </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">40</td>
                    <td class="coverage">17<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                       para = para, </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">41</td>
                    <td class="coverage">17<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                       avoid = avoid)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">42</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">43</td>
                    <td class="coverage">17<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (nrow(split) &gt; 0) {</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">44</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">45</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    split &lt;- left_join(split, </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">46</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                       select(sf::st_set_geometry(flines, NULL), COMID, toCOMID, LevelPathI, Hydroseq, TotDASqKM), </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">47</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                       by = "COMID")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">48</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">49</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    split$part &lt;- unlist(lapply(strsplit(split$split_fID, "\\."),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">50</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                function(x) x[2]))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">51</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">52</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    split &lt;- group_by(split, COMID)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">53</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">54</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    split &lt;- mutate(split, part = (ifelse(is.na(part), 0, as.integer(part)) + 1))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">55</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">56</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    # Assume flowdir is with digitized for now -- need to check in prep code.</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">57</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    split &lt;- ungroup(mutate(split,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">58</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                            toCOMID = ifelse(part == max(part),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">59</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                             as.character(toCOMID),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">60</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                             paste(lead(COMID),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">61</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                                   lead(part), sep = "."))))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">62</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">63</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    split &lt;- mutate(split, COMID = paste(COMID, part, sep = "."),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">64</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                    LENGTHKM = sf::st_length(sf::st_geometry(split)) / 1000)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">65</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">66</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    split &lt;- sf::st_as_sf(select(split, -part, -split_fID))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">67</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">68</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    attr(split$LENGTHKM, "units") &lt;- NULL</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">69</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    split[["LENGTHKM"]] &lt;- as.numeric(split[["LENGTHKM"]])</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">70</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">71</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    remove_comid &lt;- unique(as.integer(split[["COMID"]]))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">72</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">73</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    not_split &lt;- dplyr::filter(select(flines, .data$COMID, .data$toCOMID, </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">74</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                      .data$LENGTHKM, .data$LevelPathI, </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">75</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                      .data$Hydroseq, .data$TotDASqKM), !(.data$COMID %in% remove_comid))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">76</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">77</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    not_split &lt;- dplyr::mutate(not_split, event_REACHCODE = "", event_REACH_meas = NA, event_identifier = NA)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">78</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">79</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    flines &lt;- rbind(not_split, split)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">80</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">81</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    # Rows with COMID like this need to be updated</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">82</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    redirect_tocomid &lt;- flines$COMID[which(grepl("\\.1$", flines$COMID))]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">83</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">84</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    old_tocomid &lt;- gsub("\\.1$", "", redirect_tocomid)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">85</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">86</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    mutate(flines,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">87</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">           toCOMID = ifelse(toCOMID %in% old_tocomid,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">88</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                            paste0(toCOMID, ".1"),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">89</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                            toCOMID))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">90</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">91</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  } else {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">92</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    flines %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">93</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      mutate(COMID = as.character(COMID),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">94</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">             toCOMID = as.character(toCOMID),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">95</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">             event_REACHCODE = NA,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">96</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">             event_REACH_meas = NA,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">97</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">             event_identifier = NA)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">98</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">99</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">100</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">101</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">102</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">check_split_data &lt;- function(input_lines) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">103</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if(!"COMID" %in% names(input_lines)) stop("input lines must containt 'COMID' column.")</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">104</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if(attr(input_lines, "sf_column") != "geom") stop("sf_column must be 'geom'")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">105</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if(!"sfc_LINESTRING" %in% class(st_geometry(input_lines))) stop("lines must be class LINESTRING")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">106</td>
                    <td class="coverage">20<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  sf::st_crs(input_lines)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">107</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">108</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">109</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @title split lines</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">110</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @description Splits lines longer than a given threshold into the</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">111</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' minimum number of pieces to all be under the given threshold.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">112</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param input_lines data.frame of class sf with LINESTRING sfc column.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">113</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param max_length maximum segment length to return</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">114</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param events data.frame containing events as generated by nhdplusTools::get_flowline_index() </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">115</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param id name of ID column in data.frame</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">116</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param para how many cores to use</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">117</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param avoid vector of ids to avoid</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">118</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @return only the split lines.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">119</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @importFrom dplyr group_by ungroup filter select mutate</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">120</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @noRd</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">121</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">122</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">split_lines &lt;- function(input_lines, </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">123</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                        max_length = NULL, </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">124</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                        events = NULL, para = 0, </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">125</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                        avoid = NA, status = FALSE) {</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">126</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">127</td>
                    <td class="coverage">21<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  check_split_data(input_lines)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">128</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">129</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # First split by event and number parts in a seperate column</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">130</td>
                    <td class="coverage">20<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  event_split_points &lt;- split_by_event(input_lines, events)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">131</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">132</td>
                    <td class="coverage">20<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  input_lines &lt;- dplyr::select(input_lines, COMID)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">133</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">134</td>
                    <td class="coverage">20<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  too_long_split_points &lt;- split_by_length(input_lines, max_length, event_split_points, avoid)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">135</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">136</td>
                    <td class="coverage">20<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if(nrow(event_split_points) &gt; 0) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">137</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    split_points &lt;- too_long_split_points %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">138</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      dplyr::left_join(select(event_split_points, e_start = .data$start, </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">139</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                              e_end = .data$end, .data$event_split_fID), </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">140</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                       by = "event_split_fID")  %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">141</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      dplyr::mutate(start = ifelse(!is.na(.data$e_start), </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">142</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                   .data$start * (.data$e_end - .data$e_start) + .data$e_start, </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">143</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                   .data$start),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">144</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                    end = ifelse(!is.na(.data$e_start), </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">145</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                 .data$end * (.data$e_end - .data$e_start) + .data$e_start, </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">146</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                 .data$end)) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">147</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      dplyr::mutate(event_REACHCODE = ifelse((!.data$event_REACHCODE == "" &amp; !is.na(.data$event_REACHCODE)) &amp; </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">148</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                               round(.data$end, digits = 5) == round(.data$e_end, digits = 5), </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">149</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                             .data$event_REACHCODE, </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">150</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                             NA)) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">151</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      dplyr::mutate(event_REACH_meas = ifelse(is.na(.data$event_REACHCODE), NA, .data$event_REACH_meas)) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">152</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      dplyr::mutate(event_identifier = ifelse(is.na(.data$event_identifier), NA, .data$event_identifier))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">153</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  } else {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">154</td>
                    <td class="coverage">16<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    split_points &lt;- too_long_split_points</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">155</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">156</td>
                    <td class="coverage">16<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if(!"event_identifier" %in% names(split_points)) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">157</td>
                    <td class="coverage">16<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      split_points$event_identifier &lt;- seq_len(nrow(split_points))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">158</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">159</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">160</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">161</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">162</td>
                    <td class="coverage">20<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  input_lines &lt;- split_points %&gt;%  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">163</td>
                    <td class="coverage">20<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    dplyr::group_by(.data$COMID) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">164</td>
                    <td class="coverage">20<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    dplyr::arrange(.data$end) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">165</td>
                    <td class="coverage">20<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    dplyr::mutate(split_fID = ifelse(dplyr::row_number() == 1,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">166</td>
                    <td class="coverage">20<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                            as.character(.data$COMID),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">167</td>
                    <td class="coverage">20<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                            paste0(.data$COMID, ".", dplyr::row_number() - 1))) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">168</td>
                    <td class="coverage">20<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    dplyr::ungroup() %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">169</td>
                    <td class="coverage">20<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    dplyr::arrange(.data$fID, .data$end) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">170</td>
                    <td class="coverage">20<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    select(.data$COMID, .data$split_fID, .data$start, .data$end, </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">171</td>
                    <td class="coverage">20<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">           .data$event_REACHCODE, .data$event_REACH_meas, .data$event_identifier) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">172</td>
                    <td class="coverage">20<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    split_lines_fun(input_lines, para)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">173</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">174</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if(is.logical(input_lines$split_fID)) input_lines$split_fID &lt;- as.character(input_lines$split_fID)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">175</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">176</td>
                    <td class="coverage">20<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  return(input_lines)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">177</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">178</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">179</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">new_line &lt;- function(i, f, t, l) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">180</td>
                    <td class="coverage">20521<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  lwgeom::st_linesubstring(x = sf::st_geometry(l)[i],</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">181</td>
                    <td class="coverage">20521<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                           from = f,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">182</td>
                    <td class="coverage">20521<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                           to = t)[[1]]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">183</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">184</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">185</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"># rescale REACH_meas to comid_meas</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">186</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">187</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">rf &lt;- function(m, f, t) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">188</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if(any(!sapply(m, function(m, f, t) (m &gt;= f &amp; m &lt;= t), f = f, t = t))) stop("m must be between f and t")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">189</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">190</td>
                    <td class="coverage">17<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  100 * (m - f) / (t - f)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">191</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">192</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">193</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">194</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">add_length &lt;- function(input_lines) {</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">195</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">196</td>
                    <td class="coverage">20<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  input_lines$geom_len &lt;- sf::st_length(sf::st_geometry(input_lines))</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">197</td>
                    <td class="coverage">20<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  attr(input_lines$geom_len, "units") &lt;- NULL</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">198</td>
                    <td class="coverage">20<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  input_lines$geom_len &lt;- as.numeric(input_lines$geom_len)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">199</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">200</td>
                    <td class="coverage">20<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  input_lines</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">201</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">202</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">203</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">split_lines_fun &lt;- function(split_points, lines, para) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">204</td>
                    <td class="coverage">20<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  cl &lt;- NULL</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">205</td>
                    <td class="coverage">20<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if(para &gt; 1) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">206</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    cl &lt;- parallel::makeCluster(para)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">207</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">208</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">209</td>
                    <td class="coverage">20<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  pbapply::pboptions("none")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">210</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">211</td>
                    <td class="coverage">20<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  crs &lt;- sf::st_crs(lines)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">212</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">213</td>
                    <td class="coverage">20<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  lines &lt;- pbapply::pblapply(seq_len(nrow(split_points)),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">214</td>
                    <td class="coverage">20<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                               FUN = function(x, s, lines) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">215</td>
                    <td class="coverage">20521<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                 new_line(i = which(lines$COMID == s$COMID[x]),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">216</td>
                    <td class="coverage">20521<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                          f = split_points$start[x],</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">217</td>
                    <td class="coverage">20521<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                          t = split_points$end[x],</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">218</td>
                    <td class="coverage">20521<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                          l = lines)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">219</td>
                    <td class="coverage">20<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                               }, cl = cl, s = split_points, lines = lines)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">220</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">221</td>
                    <td class="coverage">20<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if(para &gt; 1) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">222</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    parallel::stopCluster(cl)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">223</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">224</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">225</td>
                    <td class="coverage">20<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  split_points &lt;- dplyr::select(split_points, -.data$start, -.data$end)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">226</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">227</td>
                    <td class="coverage">20<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  sf::st_sf(split_points, geom = sf::st_sfc(lines, crs = crs))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">228</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">229</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">230</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">split_by_event &lt;- function(input_lines, events) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">231</td>
                    <td class="coverage">16<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if(is.null(events) || nrow(events) == 0) return(data.frame(COMID = integer(0), start = numeric(0), end = numeric(0), </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">232</td>
                    <td class="coverage">16<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                        event_REACHCODE = character(0), event_REACH_meas = numeric(0), event_split_fID = integer(0)))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">233</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">234</td>
                    <td class="coverage">6<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  check_names(input_lines, "split_lines_event")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">235</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">236</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # identify which flowlines need to be split so we can just iterate over those.</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">237</td>
                    <td class="coverage">6<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  to_split_ids &lt;- sapply(seq_len(nrow(events)), </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">238</td>
                    <td class="coverage">6<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                         function(x, events, input_lines) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">239</td>
                    <td class="coverage">17<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                           e &lt;- events[x, ]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">240</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                           </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">241</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                           # from is downstream -- 0 is the outlet</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">242</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                           # to is upstream -- 100 is the inlet</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">243</td>
                    <td class="coverage">17<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                           dplyr::filter(input_lines, .data$REACHCODE == e$REACHCODE &amp;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">244</td>
                    <td class="coverage">17<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                           .data$ToMeas &gt; e$REACH_meas &amp; </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">245</td>
                    <td class="coverage">17<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                           .data$FromMeas &lt; e$REACH_meas)$COMID</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">246</td>
                    <td class="coverage">6<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                         }, events = events, input_lines = input_lines)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">247</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">248</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # filter down so we could parallelize this without blowing out memory.</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">249</td>
                    <td class="coverage">6<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  to_split &lt;- filter(input_lines, COMID %in% to_split_ids)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">250</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">251</td>
                    <td class="coverage">6<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if(!"identifier" %in% names(events)) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">252</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    events$identifier &lt;- as.character(seq(1, nrow(events)))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">253</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  } else {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">254</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    events$identifier &lt;- as.character(events$identifier)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">255</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">256</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">257</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # For each catchment to split, find all events that need to be enforced</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">258</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # split into parts and add a "parts" numbered from upstream (0 measure)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">259</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # to downstream (100 measure).</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">260</td>
                    <td class="coverage">6<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  split_l &lt;- lapply(seq_len(nrow(to_split)), </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">261</td>
                    <td class="coverage">6<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                    function(x, to_split, events) {</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">262</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                      </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">263</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                      l &lt;- to_split[x, ]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">264</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                      </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">265</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                      # only work on events in the interval of the current flowline</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">266</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                      e &lt;- dplyr::filter(events, </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">267</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                         .data$REACHCODE %in% l$REACHCODE &amp;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">268</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                         .data$REACH_meas &lt; l$ToMeas &amp;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">269</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                           .data$REACH_meas &gt; l$FromMeas)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">270</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                      </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">271</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                      # arrange in upstream downstream order (greater measures are upstream)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">272</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                      # from is downstream -- 0 is the outlet</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">273</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                      # to is upstream -- 100 is the inlet</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">274</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                      # This is important so things are in the right order for splitting</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">275</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                      # and available in that order to be joined in back in.</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">276</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                      e &lt;- dplyr::arrange(e, desc(REACH_meas))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">277</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                      </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">278</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                      # This function is defined elsewhere and tested.</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">279</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                      comid_meas &lt;- rf(e$REACH_meas, l$FromMeas, l$ToMeas)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">280</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                      </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">281</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                      split_points &lt;- data.frame(COMID = l$COMID,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">282</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                                 start = c(0, 100 - comid_meas) / 100, </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">283</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                                 end = c(100 - comid_meas, 100) / 100,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">284</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                                 event_REACHCODE = c(e$REACHCODE, ""),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">285</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                                 event_REACH_meas = c(e$REACH_meas, NA),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">286</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                                 event_identifier = c(e$identifier, ""))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">287</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                      </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">288</td>
                    <td class="coverage">6<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                    }, to_split = to_split, events = events)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">289</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">290</td>
                    <td class="coverage">6<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  do.call(rbind, split_l) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">291</td>
                    <td class="coverage">6<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    dplyr::mutate(event_split_fID = seq_len(nrow(.)))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">292</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">293</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">294</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">split_by_length &lt;- function(lines, max_length, event_split_points, avoid) {</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">295</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">296</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if(is.null(max_length)) return(data.frame())</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">297</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">298</td>
                    <td class="coverage">20<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  lines &lt;- sf::st_drop_geometry(add_length(lines))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">299</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">300</td>
                    <td class="coverage">20<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if(nrow(event_split_points) &gt; 0) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">301</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    event_split_points &lt;- dplyr::left_join(event_split_points, </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">302</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                           dplyr::select(lines, .data$COMID, .data$geom_len), </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">303</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                           by = "COMID") %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">304</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      mutate(geom_len = .data$geom_len * (.data$end - .data$start))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">305</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">306</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    lines &lt;-  lines %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">307</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      dplyr::filter(!COMID %in% event_split_points$COMID) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">308</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      dplyr::bind_rows(event_split_points)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">309</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  } else {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">310</td>
                    <td class="coverage">16<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    lines &lt;-  lines %&gt;% </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">311</td>
                    <td class="coverage">16<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      dplyr::mutate(event_REACHCODE = NA, event_REACH_meas = NA, event_split_fID = NA)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">312</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">313</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">314</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (max_length &lt; 50) warning(paste("short max length detected,",</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">315</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                     "do you have your units right?"))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">316</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">317</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # pieces is the number of pieces we need to break each too long feature into.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">318</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # fID is an identifier for a given geometry which may have already been split!</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">319</td>
                    <td class="coverage">20<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  lines &lt;- lines %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">320</td>
                    <td class="coverage">20<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    filter((.data$geom_len &gt;= max_length &amp; !.data$COMID %in% avoid) | !is.na(.data$event_split_fID)) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">321</td>
                    <td class="coverage">20<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    mutate(pieces = ceiling(.data$geom_len / max_length), </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">322</td>
                    <td class="coverage">20<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">           fID = seq_len(nrow(.))) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">323</td>
                    <td class="coverage">20<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    select(-.data$geom_len)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">324</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">325</td>
                    <td class="coverage">20<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if(nrow(lines) == 0) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">326</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    return(dplyr::select(event_split_points, .data$COMID, .data$start, .data$end, </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">327</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                         .data$event_REACHCODE, .data$event_REACH_meas, .data$event_split_fID) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">328</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">             dplyr::mutate(fID = .data$event_split_fID))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">329</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  } </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">330</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">331</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # rep here is done by row of lines so we get a row with the correct fID </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">332</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # for each part we expect in the output.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">333</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">334</td>
                    <td class="coverage">16<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  lines[rep(seq_len(nrow(lines)),lines$pieces), ] %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">335</td>
                    <td class="coverage">16<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    dplyr::select(-.data$pieces) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">336</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    # Assign featureIDs to the output. start and end are decimal % along catchment</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">337</td>
                    <td class="coverage">16<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    dplyr::group_by(.data$fID) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">338</td>
                    <td class="coverage">16<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    dplyr::mutate(piece = 1:n()) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">339</td>
                    <td class="coverage">16<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    dplyr::mutate(start = (.data$piece - 1) / dplyr::n(),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">340</td>
                    <td class="coverage">16<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                  end = .data$piece / dplyr::n()) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">341</td>
                    <td class="coverage">16<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    dplyr::ungroup() %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">342</td>
                    <td class="coverage">16<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    dplyr::select(-.data$piece)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">343</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">344</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div id="R/catchment_geometry.R" class="hidden">
              <table class="table-condensed">
                <tbody>
                  <tr class="never">
                    <td class="num">1</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' Compute km2 area</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">2</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' Short hand for safely computing area in sqkm and returning as numeric vector.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">3</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param x sf object</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">4</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @return numeric vector</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">5</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @export</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">6</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @examples</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">7</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' library(sf)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">8</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' nc = st_read(system.file("shape/nc.shp", package="sf"))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">9</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' add_areasqkm(nc[1,])</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">10</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @importFrom units set_units drop_units</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">11</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">12</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">add_areasqkm = function(x){</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">13</td>
                    <td class="coverage">63<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  drop_units(set_units(st_area(x), "km2"))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">14</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">15</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">16</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' Fast POLYGON Union</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">17</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @description This is significantly faster then sf::st_union or summarize</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">18</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param poly sf POLYGON object</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">19</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param ID the column name over which to union geometries</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">20</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @return sf object</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">21</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @export</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">22</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @importFrom terra aggregate vect makeValid</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">23</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @importFrom dplyr select</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">24</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @importFrom sf st_as_sf st_collection_extract st_geometry_type st_make_valid</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">25</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">26</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">union_polygons = function(poly, ID){</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">27</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">28</td>
                    <td class="coverage">18<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  poly = select(poly, !!ID) %&gt;% </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">29</td>
                    <td class="coverage">18<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    vect() %&gt;% </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">30</td>
                    <td class="coverage">18<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    makeValid() %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">31</td>
                    <td class="coverage">18<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    aggregate(by = eval(ID)) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">32</td>
                    <td class="coverage">18<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    st_as_sf() %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">33</td>
                    <td class="coverage">18<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    select(!!ID)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">34</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">35</td>
                    <td class="coverage">18<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (any(grepl("COLLECTION",  st_geometry_type(poly)))) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">36</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    poly = st_collection_extract(poly, "POLYGON")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">37</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">38</td>
                    <td class="coverage">18<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  return(poly)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">39</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">40</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">41</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">42</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' DEPRECATED: Fast LINESTRING union</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">43</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @description Wayyyy faster then either data.table, or sf based line merging</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">44</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param lines lines to merge</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">45</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param ID ID to merge over</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">46</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @return an sf object</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">47</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @export</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">48</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">49</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">union_linestrings_geos = function(lines, ID){</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">50</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">51</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  u &lt;- union_linestrings(lines, ID)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">52</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">53</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  u[match(unique(lines[[ID]]), u[[ID]]), ]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">54</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">55</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">56</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">57</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' Fast LINESTRING union</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">58</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @description Wayyyy faster then either data.table, or sf based line merging</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">59</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param lines lines to merge</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">60</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param ID ID to merge over</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">61</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @return an sf object</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">62</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @export</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">63</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @importFrom terra aggregate vect</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">64</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @importFrom dplyr select</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">65</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @importFrom sf st_as_sf</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">66</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">67</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">union_linestrings = function (lines, ID)  {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">68</td>
                    <td class="coverage">24<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  aggregate(vect(lines), by = eval(ID)) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">69</td>
                    <td class="coverage">24<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    st_as_sf() %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">70</td>
                    <td class="coverage">24<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    select(!!ID) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">71</td>
                    <td class="coverage">24<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    flowpaths_to_linestrings()</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">72</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">73</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">74</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' Convert MULITLINESTINGS to LINESTRINGS</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">75</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param flowpaths a flowpath `sf` object</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">76</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @return a `sf` object</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">77</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @export</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">78</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @importFrom sf st_geometry_type st_geometry st_line_merge</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">79</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @importFrom dplyr bind_rows</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">80</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">81</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">flowpaths_to_linestrings = function(flowpaths){</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">82</td>
                    <td class="coverage">24<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  bool = (st_geometry_type(sf::st_geometry(flowpaths)) == "MULTILINESTRING")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">83</td>
                    <td class="coverage">24<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  multis = flowpaths[bool, ]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">84</td>
                    <td class="coverage">24<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if(nrow(multis) &gt; 0){</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">85</td>
                    <td class="coverage">22<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    sf::st_geometry(multis) = st_line_merge(sf::st_geometry(multis))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">86</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">87</td>
                    <td class="coverage">24<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  singles = flowpaths[!bool, ]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">88</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">89</td>
                    <td class="coverage">24<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  bind_rows(multis, singles)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">90</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">91</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">92</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">93</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' Clean Catchment Geometry</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">94</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @description Fixes geometry issues present in catchments that originate in the</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">95</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' CatchmentSP layers, or from the reconcile_catchments hyRefactor preocess.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">96</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' These include, but are not limited to disjoint polygon fragments, artifacts</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">97</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' from the 30m DEM used to generate the catchments, and non-valid geometry topolgies.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">98</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' A goal of this functions is also to provide means to reduce the data column</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">99</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' of the catchments by offering a topology preserving simplification</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">100</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' through \code{\link[rmapshaper]{ms_simplify}}.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">101</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' Generally a "keep" parameter of .9 seems appropriate for the resolution of</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">102</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' the data but can be modified in function</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">103</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param catchments catchments geometries to fix</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">104</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param ID name of uniquely identifying column</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">105</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param keep proportion of points to retain in geometry simplification</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">106</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' (0-1; default 0.05). See \code{\link[rmapshaper]{ms_simplify}}.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">107</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' If NULL, then no simplification will be executed.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">108</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param crs integer or object compatible with sf::st_crs coordinate reference.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">109</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' Should be a projection that supports area-calculations.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">110</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param sys logical should the mapshaper system library be used. If NULL </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">111</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' the system library will be used if available.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">112</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @return sf object</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">113</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @export</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">114</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @importFrom dplyr select mutate filter group_by ungroup slice_max bind_rows n right_join rename slice_min</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">115</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @importFrom sf st_crs st_touches st_transform st_area st_make_valid st_intersection st_collection_extract st_cast st_intersects st_length st_filter st_union st_is_empty</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">116</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @importFrom rmapshaper ms_explode ms_dissolve ms_simplify</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">117</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @importFrom nhdplusTools rename_geometry</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">118</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @importFrom rlang :=</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">119</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">120</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">clean_geometry &lt;- function(catchments,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">121</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                          ID = "ID",</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">122</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                          keep = .9,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">123</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                          crs = 5070, </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">124</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                          sys = NULL) {</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">125</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">126</td>
                    <td class="coverage">21<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if(is.null(sys)) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">127</td>
                    <td class="coverage">21<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    sys &lt;- FALSE</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">128</td>
                    <td class="coverage">21<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    try(sys &lt;- is.character(rmapshaper::check_sys_mapshaper(verbose = FALSE)))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">129</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">130</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">131</td>
                    <td class="coverage">21<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  in_crs = st_crs(catchments)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">132</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">133</td>
                    <td class="coverage">21<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  in_cat &lt;- suppressWarnings({</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">134</td>
                    <td class="coverage">21<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    catchments %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">135</td>
                    <td class="coverage">21<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    dplyr::select(ID = !!ID) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">136</td>
                    <td class="coverage">21<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    st_transform(crs) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">137</td>
                    <td class="coverage">21<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    mutate(areasqkm = add_areasqkm(.)) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">138</td>
                    <td class="coverage">21<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    ms_explode(sys = sys) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">139</td>
                    <td class="coverage">21<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    filter(!duplicated(.)) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">140</td>
                    <td class="coverage">21<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    mutate(area = add_areasqkm(.))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">141</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  })</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">142</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">143</td>
                    <td class="coverage">21<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  ids &lt;- unique(filter(in_cat, duplicated(.data$ID))$ID)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">144</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">145</td>
                    <td class="coverage">21<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (length(ids) != 0) {</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">146</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">147</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    # single geometry catchments</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">148</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    cat_no_problem &lt;- filter(in_cat, !.data$ID %in% ids)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">149</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">150</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    # multi geometry catchments</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">151</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    challenges = filter(in_cat, .data$ID %in% ids) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">152</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      mutate(tmpID = 1:n()) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">153</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      filter(!st_is_empty(.))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">154</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">155</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    # base cats: combo of biggest multi geom and single geom catchments</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">156</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    base_cats = challenges %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">157</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      group_by(.data$ID) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">158</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      slice_max(.data$area) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">159</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      ungroup() %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">160</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      bind_rows(cat_no_problem)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">161</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">162</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    # Frags are polygon slivers not in the base catchments</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">163</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    frags = filter(challenges, !.data$tmpID %in% base_cats$tmpID)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">164</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">165</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    # frags smaller than a square meter can be dropped.</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">166</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    frags &lt;- filter(frags, area &gt; 0.000001)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">167</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">168</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    # If fragments exist, then fix, else return empty data.frame</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">169</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if(nrow(frags) &gt; 0){</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">170</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      frags = frags %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">171</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        ms_dissolve(sys = sys) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">172</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        ms_explode(sys = sys) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">173</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        mutate(area = as.numeric(st_area(.))) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">174</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        st_make_valid()</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">175</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">176</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      out = tryCatch({</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">177</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        suppressWarnings({</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">178</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          st_intersection(frags, st_make_valid(base_cats)) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">179</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">            st_collection_extract("LINESTRING")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">180</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        })</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">181</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      }, error = function(e) { NULL })</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">182</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">183</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    } else {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">184</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      out = data.frame()</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">185</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">186</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">187</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if(is.null(out)){</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">188</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      in_cat = base_cats</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">189</td>
                    <td class="coverage">9<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    } else if(!is.null(out) &amp; nrow(out) != 0){</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">190</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      # ints are the LINSTRINGS of intersection between base_cats and frags</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">191</td>
                    <td class="coverage">8<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      ints = out %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">192</td>
                    <td class="coverage">8<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        mutate(l = st_length(.)) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">193</td>
                    <td class="coverage">8<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        group_by(.data$rmapshaperid) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">194</td>
                    <td class="coverage">8<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        slice_max(.data$l, with_ties = FALSE) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">195</td>
                    <td class="coverage">8<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        ungroup()</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">196</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">197</td>
                    <td class="coverage">8<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      tj = right_join(frags,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">198</td>
                    <td class="coverage">8<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                      dplyr::select(st_drop_geometry(ints), .data$ID,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">199</td>
                    <td class="coverage">8<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                    .data$rmapshaperid),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">200</td>
                    <td class="coverage">8<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                      by = "rmapshaperid") %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">201</td>
                    <td class="coverage">8<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        bind_rows(base_cats) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">202</td>
                    <td class="coverage">8<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        dplyr::select(-.data$rmapshaperid, -.data$areasqkm, -.data$tmpID) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">203</td>
                    <td class="coverage">8<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        group_by(.data$ID) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">204</td>
                    <td class="coverage">8<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        mutate(n = n()) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">205</td>
                    <td class="coverage">8<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        ungroup() %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">206</td>
                    <td class="coverage">8<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        nhdplusTools::rename_geometry('geometry') %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">207</td>
                    <td class="coverage">8<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        ungroup()</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">208</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">209</td>
                    <td class="coverage">8<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if(nrow(tj) == 0){</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">210</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">        in_cat = base_cats</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">211</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      } else {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">212</td>
                    <td class="coverage">8<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        in_cat = suppressWarnings({</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">213</td>
                    <td class="coverage">8<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          union_polygons(filter(tj, .data$n &gt; 1) , 'ID') %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">214</td>
                    <td class="coverage">8<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">            bind_rows(dplyr::select(filter(tj, .data$n == 1), .data$ID)) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">215</td>
                    <td class="coverage">8<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">            mutate(tmpID = 1:n())</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">216</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        })</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">217</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">218</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">219</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    } else {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">220</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      in_cat = base_cats</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">221</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">222</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">223</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    # More then one polygon represents a FP</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">224</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    dups = in_cat$ID[duplicated(in_cat$ID)]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">225</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">226</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (length(dups) &gt; 0) {</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">227</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">228</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      for (i in 1:length(dups)) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">229</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">        here = filter(in_cat, .data$ID == dups[i])</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">230</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">231</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">        dissolve = slice_min(here, .data$areasqkm, with_ties = FALSE)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">232</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">233</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">        tmap = st_filter(in_cat, dissolve, .predicate = st_touches)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">234</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">235</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">        suppressWarnings({</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">236</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">          opt &lt;- st_intersection(dissolve, filter(tmap, !.data$tmpID %in% dissolve$tmpID))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">237</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">238</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          # If the intersection is only multipoint geometry</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">239</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          # Note that geometry_type will be longer than one if more than one feature</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">240</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          # was returned from the st_intersection above.</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">241</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">          gt &lt;- sf::st_geometry_type(opt)</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">242</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">          if(length(gt) == 1 &amp;&amp; grepl("POINT", gt)) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">243</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">            opt &lt;- sf::st_cast(opt, "LINESTRING")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">244</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">245</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">246</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">          opt &lt;- opt %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">247</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">            st_collection_extract("LINESTRING") %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">248</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">            mutate(l = st_length(.)) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">249</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">            slice_max(.data$l, with_ties = FALSE)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">250</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">251</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        })</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">252</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">253</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">        ind = which(in_cat$tmpID == opt$tmpID.1)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">254</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">255</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">        in_cat$geometry[ind] = st_union(dissolve$geometry, in_cat$geometry[ind])</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">256</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">        in_cat = filter(in_cat, !.data$tmpID %in%  dissolve$tmpID)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">257</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">258</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">259</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">260</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">261</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">262</td>
                    <td class="coverage">21<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (!is.null(keep)) {</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">263</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    # message("Simplifying catchment boundaries: keep = ", keep)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">264</td>
                    <td class="coverage">9<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if("tmpID" %in% names(in_cat)){</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">265</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      in_cat$tmpID = NULL</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">266</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">267</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">268</td>
                    <td class="coverage">9<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    in_cat = ms_simplify(in_cat, keep = keep, keep_shapes = TRUE, sys = sys)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">269</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">270</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">271</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # since areasqkm will be added based on the new geometries,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">272</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # we need to drop that column if it exists. We want to retain</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">273</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # any others that that came with the OG catchments</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">274</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">275</td>
                    <td class="coverage">21<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if('areasqkm' %in% names(catchments)){</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">276</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    catchments = select(catchments, -.data$areasqkm)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">277</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">278</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">279</td>
                    <td class="coverage">21<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  in_cat %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">280</td>
                    <td class="coverage">21<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    mutate(areasqkm = add_areasqkm(.)) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">281</td>
                    <td class="coverage">21<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    st_transform(in_crs) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">282</td>
                    <td class="coverage">21<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    dplyr::select("{ID}" := ID, .data$areasqkm)  %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">283</td>
                    <td class="coverage">21<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    left_join(st_drop_geometry(catchments), by = ID) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">284</td>
                    <td class="coverage">21<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    filter(!duplicated(.))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">285</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">286</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">287</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">288</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' Add Length Map to Refactored Network</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">289</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @description This function replicates the member_COMID column of a refactored</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">290</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' network but adds a new notation Following each COMID is '.' which is proceeded</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">291</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' by the fraction of that COMID making up the new flowpath. For example 101.1</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">292</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' would indicate 100% of COMID 101 is in the new ID.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">293</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' Equally 101.05 would indicate 50% of COMID 101 is present in the new ID'd flowpath</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">294</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param flowpaths a refactored flowpath network containing an member_COMID column</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">295</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param length_table a table of NHDPlus COMIDs and LENGTH to use as weights.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">296</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' Can be found with \code{nhdplusTools::get_vaa("lengthkm")}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">297</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @return sf object</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">298</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @export</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">299</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @examples</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">300</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' \dontrun{</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">301</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' path &lt;- system.file("extdata/walker_reconcile.gpkg", package = "hyRefactor")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">302</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' fps  &lt;- add_lengthmap(flowpaths = sf::read_sf(path),</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">303</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' length_table = nhdplusTools::get_vaa("lengthkm"))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">304</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">305</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'@importFrom dplyr select mutate filter left_join right_join arrange group_by summarize</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">306</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'@importFrom sf st_drop_geometry st_length st_as_sf</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">307</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'@importFrom nhdplusTools get_vaa</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">308</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">309</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">add_lengthmap = function(flowpaths, length_table){</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">310</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">311</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">  tmp = dplyr::select(st_drop_geometry(flowpaths),</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">312</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">                           .data$ID,</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">313</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">                           COMID = .data$member_COMID) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">314</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    mutate(COMID = strsplit(.data$COMID, ","))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">315</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">316</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">  unnested = data.frame(ID =  rep(tmp$ID,  times = lengths(tmp$COMID)),</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">317</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">                    COMID = as.character(unlist(tmp$COMID)))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">318</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">319</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">  unnested2 = filter(unnested, grepl("\\.", COMID)) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">320</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    mutate(baseCOMID = floor(as.numeric(COMID)))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">321</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">322</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">  lengthm_fp = length_table %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">323</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    select(baseCOMID = .data$comid, .data$lengthkm) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">324</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    mutate(lengthm_fp = .data$lengthkm * 1000, lengthkm = NULL)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">325</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">326</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">  lengthm_id = flowpaths %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">327</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    mutate(lengthm_id = as.numeric(st_length(.))) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">328</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    select(.data$ID, .data$lengthm_id) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">329</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    st_drop_geometry()</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">330</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">331</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">  map = left_join(left_join(unnested2, lengthm_fp, "baseCOMID"), lengthm_id, by = "ID") %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">332</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    mutate(perLength = round(.data$lengthm_id/.data$lengthm_fp, 3)/10) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">333</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    select(.data$ID, .data$COMID, .data$perLength) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">334</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    right_join(unnested, by = c("ID", "COMID")) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">335</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    mutate(perLength = ifelse(is.na(.data$perLength), 1,</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">336</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">                              as.character(.data$perLength))) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">337</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    arrange(.data$ID) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">338</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    mutate(new = paste0(floor(as.numeric(.data$COMID)), ".",</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">339</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">                        gsub("0\\.", "", .data$perLength))) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">340</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    group_by(.data$ID) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">341</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    summarize(lengthMap = paste(.data$new, collapse = ",")) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">342</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    right_join(flowpaths) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">343</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    st_as_sf()</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">344</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">345</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">  return(map)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">346</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div id="R/aggregate_catchments.R" class="hidden">
              <table class="table-condensed">
                <tbody>
                  <tr class="never">
                    <td class="num">1</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' Aggregate Catchments</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">2</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @description Aggregates catchments according to a set of outlet catchments. </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">3</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' Network aggregation is completed using: See \code{\link{aggregate_network}}.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">4</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param flowpath sf data.frame Flowpaths as generated by `refactor_nhdplus`</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">5</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param divide sf data.frame Reconciled catchment divides as generated by</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">6</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' `reconcile_catchment_divides`</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">7</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param outlets data.frame with "ID" and "type" columns. "ID" must be identifiers from</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">8</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' flowpath and divide data.frames. "type" should be "outlet", or "terminal".</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">9</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' "outlet" will include the specified ID.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">10</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' "terminal" will be treated as a terminal node with nothing downstream.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">11</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param zero_order list of vectors containing IDs to be aggregated into 0-order catchments.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">12</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param coastal_cats sf data.frame with coastal catchments to be used with zero order.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">13</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param da_thresh numeric See \code{\link{aggregate_network}}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">14</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param only_larger boolean See \code{\link{aggregate_network}}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">15</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param post_mortem_file rda file to dump environment to in case of error</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">16</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param keep logical passed along to \code{\link{clean_geometry}}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">17</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">18</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @details See \code{\link{aggregate_network}}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">19</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">20</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @export</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">21</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @importFrom sf st_is_empty st_drop_geometry st_as_sf</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">22</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @importFrom dplyr filter left_join bind_rows select distinct</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">23</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @examples</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">24</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' source(system.file("extdata", "walker_data.R", package = "hyRefactor"))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">25</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' outlets &lt;- data.frame(ID = c(31, 3, 5, 1, 45, 92),</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">26</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'  type = c("outlet", "outlet", "outlet", "terminal", "outlet", "outlet"),</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">27</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'  stringsAsFactors = FALSE)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">28</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' aggregated &lt;- aggregate_catchments(flowpath = walker_fline_rec, </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">29</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'                                    divide = walker_catchment_rec, </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">30</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'                                    outlets = outlets)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">31</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' plot(aggregated$cat_sets$geom, lwd = 3, border = "red")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">32</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' plot(walker_catchment_rec$geom, lwd = 1.5, border = "green", col = NA, add = TRUE)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">33</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' plot(walker_catchment$geom, lwd = 1, add = TRUE)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">34</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' plot(walker_flowline$geom, lwd = .7, col = "blue", add = TRUE)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">35</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' plot(aggregated$cat_sets$geom, lwd = 3, border = "black")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">36</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' plot(aggregated$fline_sets$geom, lwd = 3, col = "red", add = TRUE)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">37</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' plot(walker_flowline$geom, lwd = .7, col = "blue", add = TRUE)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">38</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">39</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">aggregate_catchments &lt;- function(flowpath, divide, outlets, zero_order = NULL,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">40</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                 coastal_cats = NULL,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">41</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                 da_thresh = NA, only_larger = FALSE, </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">42</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                 post_mortem_file = NA, keep = NULL) {</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">43</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">44</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  in_crs &lt;- sf::st_crs(divide)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">45</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">46</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if(any(grepl("MULTIPOLYGON", sf::st_geometry_type(divide, by_geometry = TRUE)))) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">47</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    warning("found MULTIPOLYGONs in divides. They must be of type POLYGON.")</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">48</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    divide &lt;- clean_geometry(divide, ID = "ID", </pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">49</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">                             crs = in_crs, keep = NULL)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">50</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">51</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">52</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if(!is.null(zero_order)) {</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">53</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">54</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if(is.null(coastal_cats)) stop("must supply coastal_cats with zero order")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">55</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">56</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if(st_crs(coastal_cats) != in_crs) st_transform(coastal_cats, in_crs)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">57</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">58</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    zero_flowpath &lt;- filter(flowpath, member_COMID %in% do.call(c, zero_order))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">59</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">60</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    flowpath &lt;- filter(flowpath, !ID %in% zero_flowpath$ID)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">61</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">62</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    coastal &lt;- lapply(zero_order, function(x, coastal_cats, divide) {</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">63</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">64</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      zero_cats &lt;- filter(coastal_cats, FEATUREID %in% x)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">65</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">66</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      zero_div &lt;- filter(divide, member_COMID %in% as.character(x))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">67</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">68</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      st_union(c(st_geometry(zero_cats), st_geometry(zero_div)))[[1]]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">69</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }, coastal_cats = coastal_cats, divide = divide)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">70</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">71</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    coastal &lt;- st_sfc(coastal, crs = in_crs)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">72</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">73</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    coastal &lt;- st_sf(ID = names(coastal), geom = coastal)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">74</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  } else {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">75</td>
                    <td class="coverage">9<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    coastal &lt;- NULL</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">76</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">77</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">78</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if(any(remove_head_div &lt;- !flowpath$ID %in% flowpath$toID &amp; </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">79</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">         !flowpath$ID %in% divide$ID)) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">80</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    remove_fpaths &lt;- filter(flowpath, remove_head_div)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">81</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    message(paste("removing", nrow(remove_fpaths), </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">82</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                  "headwater/diversion flowlines without catchments."))</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">83</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    flowpath &lt;- filter(flowpath, !ID %in% remove_fpaths$ID)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">84</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">85</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">86</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  agg_network &lt;- aggregate_network(flowpath, outlets, da_thresh, only_larger, post_mortem_file)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">87</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">88</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  agg_network$cat_sets &lt;- </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">89</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    unnest_flines(agg_network$cat_sets, 'set') %&gt;% </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">90</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    left_join(select(divide, ID), by = c("set" = "ID")) %&gt;% </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">91</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    st_as_sf() %&gt;% </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">92</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    filter(!sf::st_is_empty(.)) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">93</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    union_polygons(ID = "ID") %&gt;% </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">94</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    clean_geometry(ID = "ID", </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">95</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                   crs = in_crs, </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">96</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                   keep = keep) %&gt;% </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">97</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    select(.data$ID) %&gt;% </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">98</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    left_join(agg_network$cat_sets, by = "ID")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">99</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">100</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  return(c(agg_network, list(coastal_sets = coastal)))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">101</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div id="R/map_outlets.R" class="hidden">
              <table class="table-condensed">
                <tbody>
                  <tr class="never">
                    <td class="num">1</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">hy_drop_geometry &lt;- function(x) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">2</td>
                    <td class="coverage">6<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if("sf" %in% class(x)) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">3</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    sf::st_drop_geometry(x)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">4</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  } else {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">5</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    x</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">6</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  } </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">7</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">8</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">9</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' Map outlets from COMID to ID for aggregate catchments</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">10</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @description given reconciled flowlines and a set of source outlets,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">11</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' returns a set of outlets with reconciled IDs suitable for use with </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">12</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' aggregate_catchments.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">13</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param source_outlets data.frame with COMID and type columns</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">14</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param reconciled data.frame as returned by refactor workflow</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">15</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @importFrom dplyr select mutate</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">16</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @export</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">17</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">map_outlet_ids &lt;- function(source_outlets, reconciled) {</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">18</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">19</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  source_outlets &lt;- hy_drop_geometry(source_outlets)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">20</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  reconciled &lt;- hy_drop_geometry(reconciled)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">21</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">22</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # Convert member comid to a list column and truncate with as.integer</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">23</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # 1.1 becomes 1, 1.9 becomes 1, etc. This removes part ids.</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">24</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  reconciled$integer_COMID &lt;- strsplit(reconciled$member_COMID, ",")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">25</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  reconciled$integer_COMID &lt;- lapply(reconciled$integer_COMID, as.integer)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">26</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">27</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  rec &lt;- unnest_flines(select(reconciled, .data$ID, .data$integer_COMID), </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">28</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                       col = "integer_COMID")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">29</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">30</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # finds IDs from reconciled that represent the passed-in COMID</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">31</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # returns IDs in the hyRefactor ID space</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">32</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  find_ID &lt;- function(COMID, rec) rec$ID[which(COMID == rec$integer_COMID)]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">33</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">34</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # NOT COMID</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">35</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  ids &lt;- lapply(source_outlets$COMID, </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">36</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                FUN = find_ID, </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">37</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                rec = rec)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">38</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">39</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  id_selector &lt;- lengths(ids) &gt; 0</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">40</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">41</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  source_outlets &lt;- source_outlets[id_selector, ]  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">42</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  source_outlets$ID &lt;- as.integer(lapply(ids[id_selector], function(x) x[[1]]))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">43</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">44</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  terminals &lt;- reconciled[is.na(reconciled$toID), ]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">45</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">46</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  missing_terminals &lt;- terminals[!terminals$ID %in% source_outlets$ID, ]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">47</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">48</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if(nrow(missing_terminals) &gt; 0) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">49</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    missing_terminals &lt;- select(missing_terminals, ID, COMID = member_COMID) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">50</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      mutate(COMID = strsplit(COMID, split = ",")) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">51</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      mutate(COMID = sapply(COMID, utils::tail, n = 1), type = "terminal")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">52</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">53</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    outlets &lt;- rbind(source_outlets, missing_terminals)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">54</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  } else {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">55</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    outlets &lt;- source_outlets</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">56</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">57</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">58</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  terminal_flowpath &lt;- reconciled[which(reconciled$ID %in% source_outlets[source_outlets$type == "terminal", ]$ID), ]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">59</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  remove_terminal_flowpath &lt;- terminal_flowpath[!is.na(terminal_flowpath$toID), ]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">60</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">61</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  outlets[!outlets$ID %in% remove_terminal_flowpath$ID, ]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">62</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div id="R/download_fdr_fac.R" class="hidden">
              <table class="table-condensed">
                <tbody>
                  <tr class="never">
                    <td class="num">1</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"># Either export from nhdplusTools or leave this</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">2</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">check7z = function (){</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">3</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">  tryCatch({</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">4</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    system("7z", intern = TRUE)</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">5</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }, error = function(e) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">6</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    stop(simpleError("Please Install 7zip (Windows) or p7zip (MacOS/Unix). Choose accordingly:\n        Windows: https://www.7-zip.org/download.html\n        Mac: 'brew install p7zip' or 'sudo port install p7zip'\n        Linux: https://sourceforge.net/projects/p7zip/"))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">7</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  })</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">8</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">9</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">10</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' Download Elevation and Derivatives</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">11</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param product character DEM, hydroDEM, or FDRFAC.  </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">12</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param out_dir path to directory to store output.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">13</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param regions character vector of two digit hydrologic </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">14</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @importFrom rvest read_html html_nodes html_attr</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">15</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @importFrom httr RETRY write_disk progress</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">16</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @export</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">17</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">download_elev &lt;- function(product, out_dir, regions = NULL) {</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">18</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">19</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">  dev_null &lt;- check7z()</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">20</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">21</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">  allowable &lt;- c("DEM" = ".*NEDSnapshot.*", "hydroDEM" = ".*HydroDem.*", "FDRFAC" = ".*FdrFac.*")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">22</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">23</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if(!all(product %in% names(allowable))) stop(paste("product must be one of", allowable))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">24</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">25</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">  dir.create(out_dir, recursive = TRUE, showWarnings = FALSE)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">26</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">27</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">  root &lt;- "http://www.horizon-systems.com"</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">28</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">  base &lt;- "/NHDPlusData/NHDPlusV21/Data/"</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">29</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">30</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">  check &lt;- paste0(root, base)</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">31</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">  found &lt;- c()</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">32</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">  i &lt;- 1</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">33</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">34</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">  while(i &lt;= length(check)) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">35</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    url &lt;- check[i]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">36</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">37</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    pg &lt;- rvest::read_html(url)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">38</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">39</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    pg_links &lt;- paste0(url, html_attr(html_nodes(pg, "a"), "href"))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">40</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">41</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    pg_links &lt;- pg_links[!pg_links %in% check]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">42</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">43</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    check &lt;- c(check, pg_links[!grepl("[.][.]/", pg_links) &amp; grepl(".*/$", pg_links)])</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">44</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">45</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    found &lt;- c(found, pg_links[grepl(paste(allowable[product], collapse = "|"), pg_links, ignore.case = TRUE)])</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">46</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">47</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    i &lt;- i + 1</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">48</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">49</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if(i &gt; 10000) stop("something is wrong with the URL finder loop.")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">50</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">51</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">52</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if(!is.null(regions)) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">53</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    found &lt;- found[grepl(paste(paste0(".*_", regions, "?[a-z]_.*"), </pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">54</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">                               collapse = "|"), found, ignore.case = TRUE)]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">55</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">56</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">57</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">  for(f in found) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">58</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    fi &lt;- basename(f)</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">59</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    url &lt;- f</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">60</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    out_fi &lt;- file.path(out_dir, fi)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">61</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">62</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    message(out_fi)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">63</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    </pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">64</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if(!file.exists(out_fi)) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">65</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      RETRY("GET", url, write_disk(out_fi), progress())</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">66</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      </pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">67</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      system(paste0("7z -y -o", path.expand(out_dir), " x ", </pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">68</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">                    path.expand(out_fi)), intern = TRUE)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">69</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">70</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">71</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">72</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">73</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' Download FDR FAC</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">74</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @inheritParams download_elev</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">75</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @export</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">76</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">download_fdr_fac &lt;- function(out_dir, regions = NULL) {</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">77</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">78</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">  download_elev(product = c("FDRFAC"), out_dir, regions)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">79</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">80</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div id="R/hyRefactor.R" class="hidden">
              <table class="table-condensed">
                <tbody>
                  <tr class="never">
                    <td class="num">1</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#nolint start</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">2</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"># NHDPlus Attributes</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">3</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">COMID &lt;- FEATUREID &lt;-</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">4</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  Hydroseq &lt;- DnHydroseq &lt;- DnMinorHyd &lt;- LevelPathI &lt;- DnLevelPat &lt;-</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">5</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  ToNode &lt;- FromNode &lt;-</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">6</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  TotDASqKM &lt;- LENGTHKM &lt;-</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">7</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  Pathlength &lt;- StreamCalc &lt;- StreamOrde &lt;- TerminalFl &lt;-</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">8</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  Divergence &lt;- TerminalPa &lt;- StartFlag &lt;- FTYPE &lt;-</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">9</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  FromMeas &lt;- ToMeas &lt;- REACHCODE &lt;- REACH_meas &lt;-</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">10</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  HUC12 &lt;- TOHUC &lt;- NULL</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">11</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">12</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"># Package Attribute Names</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">13</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"># Need to clean up.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">14</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">COMID.y &lt;- ID &lt;- becomes &lt;- ds_num_upstream &lt;- fID &lt;-</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">15</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  dsLENGTHKM &lt;- ds_joined_fromCOMID &lt;- fromCOMID &lt;-</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">16</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  fromTotDASqKM &lt;- geom_len &lt;-</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">17</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  geometry &lt;- join_category &lt;- joined_fromCOMID &lt;-</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">18</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  joined_fromCOMID_new &lt;- joined_toCOMID &lt;- member_COMID &lt;-</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">19</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  new_joined_fromCOMID &lt;- new_joined_toCOMID &lt;- new_toCOMID &lt;-</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">20</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  num_upstream &lt;- part &lt;- piece &lt;- pieces &lt;- removed_COMID &lt;-</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">21</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  split_fID &lt;- toCOMID &lt;- toID &lt;- usTotDASqKM &lt;-</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">22</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  . &lt;- L1 &lt;- X &lt;- Y &lt;- breaks &lt;- dist_ratio &lt;- ideal_len &lt;-</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">23</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  len &lt;- nID &lt;- new_index &lt;- piece_len &lt;- setNames &lt;- start &lt;-</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">24</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  index &lt;- measure &lt;- nn.idx &lt;- precision_index &lt;- max_Hydroseq &lt;-</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">25</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  nn.dists &lt;- offset &lt;- area &lt;- member_FEATUREID &lt;- geom &lt;-</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">26</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  fromID &lt;- nexID &lt;- cat_ID &lt;- type &lt;- LevelPathID &lt;- orig_COMID &lt;-</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">27</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  tail_id &lt;- tail_ID &lt;- toID_hydroseq &lt;- toID_tail_ID &lt;- toID_fromID &lt;-</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">28</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  toID_LevelpathID &lt;- set &lt;- set_toID &lt;- usLevelPathI &lt;- fromLevelPathI &lt;-</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">29</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  ID_Hydroseq &lt;- ID_LevelPath &lt;- ID_LevelPathID &lt;- toID_fromID_TotDASqKM &lt;-</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">30</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  toID_fromID_lp &lt;- denTotalAreaSqKM &lt;- check_LevelPathI &lt;-</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">31</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  correct_head_HUC12 &lt;- corrected_LevelPathI &lt;- head_HUC12 &lt;-</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">32</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  intersected_LevelPathI &lt;- levelpath &lt;- main_LevelPathI &lt;- nameID &lt;-</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">33</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  nhd_LevelPath &lt;- outletID &lt;- outlet_HUC12 &lt;- update_head_HUC12 &lt;-</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">34</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  updated_head_HUC12 &lt;- updated_outlet_HUC12 &lt;- weight &lt;- hu12 &lt;-</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">35</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  lp &lt;- L2 &lt;- members &lt;- DnHydroSeq &lt;- HydroSeq &lt;- NHDPlusID &lt;-</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">36</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  member_NHDPlusID &lt;- mr_LevelPathI &lt;- event_REACH_meas &lt;- .data &lt;- NULL</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">37</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">38</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"># nolint end</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">39</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">hyrefactor_env &lt;- new.env()</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">40</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">41</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">assign("prepare_nhdplus_attributes",</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">42</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">       c("COMID", "LENGTHKM", "FTYPE", "TerminalFl",</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">43</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">         "FromNode", "ToNode", "TotDASqKM",</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">44</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">         "StartFlag", "StreamOrde", "StreamCalc",</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">45</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">         "TerminalPa", "Pathlength", "Divergence", "Hydroseq",</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">46</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">         "LevelPathI"),</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">47</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">       envir = hyrefactor_env)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">48</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">49</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">assign("split_flowlines_attributes",</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">50</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">       c("COMID", "toCOMID", "LENGTHKM"),</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">51</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">       envir = hyrefactor_env)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">52</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">53</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">assign("collapse_flowlines_attributes",</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">54</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">       c("COMID", "toCOMID", "LENGTHKM", "LevelPathI", "Hydroseq"),</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">55</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">       envir = hyrefactor_env)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">56</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">57</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">assign("reconcile_collapsed_flowlines_attributes",</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">58</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">       c("COMID", "toCOMID", "LENGTHKM", "LevelPathI", "Hydroseq"),</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">59</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">       envir = hyrefactor_env)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">60</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">61</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">assign("match_levelpaths_attributes",</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">62</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">       c("COMID", "Hydroseq", "LevelPathI",</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">63</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">         "DnLevelPat", "denTotalAreaSqKM", "HUC12", "TOHUC"),</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">64</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">       envir = hyrefactor_env)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">65</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">66</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">assign("match_flowpaths_attributes",</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">67</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">       c("COMID", "LENGTHKM", "DnHydroseq",</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">68</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">         "Hydroseq", "LevelPathI", "DnLevelPat"),</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">69</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">       envir = hyrefactor_env)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">70</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">71</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">assign("split_lines_event_attributes",</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">72</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">       c("REACHCODE", "FromMeas", "ToMeas"),</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">73</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">       envir = hyrefactor_env)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">74</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">75</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">assign("aggregate_network_attributes",</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">76</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">       c("ID", "toID", "LevelPathID", "Hydroseq"),</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">77</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">       envir = hyrefactor_env)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">78</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">79</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">assign("get_minimal_network_attributes",</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">80</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">       c(get("aggregate_network_attributes", </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">81</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">           envir = hyrefactor_env), </pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">82</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">         "AreaSqKM", "LENGTHKM"),</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">83</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">       envir = hyrefactor_env)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">84</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">85</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">check_names &lt;- function(x, function_name) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">86</td>
                    <td class="coverage">95<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  x &lt;- nhdplusTools::align_nhdplus_names(x)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">87</td>
                    <td class="coverage">95<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  names_x &lt;- names(x)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">88</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">89</td>
                    <td class="coverage">95<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  expect_names &lt;- get(paste0(function_name, "_attributes"),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">90</td>
                    <td class="coverage">95<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                      envir = hyrefactor_env)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">91</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">92</td>
                    <td class="coverage">95<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (!all(expect_names %in% names_x)) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">93</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    stop(paste0("Missing some required attributes in call to: ",</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">94</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">                function_name, ". Expected: ",</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">95</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">                paste(expect_names[which(!(expect_names %in%</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">96</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                             names_x))],</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">97</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">                      collapse = ", "), "."))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">98</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">99</td>
                    <td class="coverage">95<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  return(invisible(x))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">100</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">101</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">102</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">get_ds_lengthkm &lt;- function(flines) {</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">103</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # This gets all the next-downstream flowlines and finds the</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">104</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # length of the next downstream</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">105</td>
                    <td class="coverage">82<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  flines[["dsLENGTHKM"]] &lt;-</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">106</td>
                    <td class="coverage">82<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    flines[["LENGTHKM"]][match(flines$toCOMID, flines$COMID)]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">107</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # already removed comids get NA dsLength -- ok to set them to 0.</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">108</td>
                    <td class="coverage">82<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  flines[["dsLENGTHKM"]][is.na(flines$dsLENGTHKM)] &lt;- 0</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">109</td>
                    <td class="coverage">82<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  flines[["dsLENGTHKM"]]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">110</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">111</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">112</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">get_upstream &lt;- function(flines) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">113</td>
                    <td class="coverage">250<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  left_join(select(flines, COMID), select(flines, COMID, toCOMID),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">114</td>
                    <td class="coverage">250<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">            by = c("COMID" = "toCOMID")) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">115</td>
                    <td class="coverage">250<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    rename(fromCOMID = COMID.y)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">116</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">117</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">118</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">get_num_upstream &lt;- function(flines) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">119</td>
                    <td class="coverage">250<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  left_join(select(flines, COMID, toCOMID),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">120</td>
                    <td class="coverage">250<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">            get_upstream(flines) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">121</td>
                    <td class="coverage">250<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">              group_by(COMID) %&gt;%</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">122</td>
                    <td class="coverage">250<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">              summarise(num_upstream = n()),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">123</td>
                    <td class="coverage">250<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">            by = "COMID")[["num_upstream"]]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">124</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">125</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">126</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">get_ds_num_upstream &lt;- function(flines) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">127</td>
                    <td class="coverage">213<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  flines &lt;- mutate(flines, num_upstream = get_num_upstream(flines))</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">128</td>
                    <td class="coverage">213<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  flines[["num_upstream"]][match(flines$toCOMID, flines$COMID)]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">129</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">130</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">131</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">get_ds_joined_fromcomid &lt;- function(flines) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">132</td>
                    <td class="coverage">69<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  flines &lt;- mutate(flines, ds_joined_fromCOMID = joined_fromCOMID)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">133</td>
                    <td class="coverage">69<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  flines[["ds_joined_fromCOMID"]][match(flines$toCOMID, flines$COMID)]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">134</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">135</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">136</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">drop_geometry &lt;- function(x) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">137</td>
                    <td class="coverage">129<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if("sf" %in% class(x)) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">138</td>
                    <td class="coverage">60<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    sf::st_drop_geometry(x)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">139</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  } else {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">140</td>
                    <td class="coverage">69<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    x</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">141</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">142</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <script>$('div#files pre').each(function(i, block) {
    hljs.highlightBlock(block);
});</script>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
</body>
</html>
