<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Aggregate Catchments — aggregate_catchments • hyRefactor</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Aggregate Catchments — aggregate_catchments" />
<meta property="og:description" content="Aggregates catchments according to a set of outlet catchments." />


<meta name="robots" content="noindex">

<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">hyRefactor</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">0.4.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/coastal_units.html">Coastal Units wit hyRefactor</a>
    </li>
    <li>
      <a href="../articles/refactor_catchment.html">Refactor Catchments</a>
    </li>
    <li>
      <a href="../articles/refactor_nhdplus.html">Refactor Flowlines</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/dblodgett-usgs/hyrefactor/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Aggregate Catchments</h1>
    <small class="dont-index">Source: <a href='https://github.com/dblodgett-usgs/hyrefactor/blob/master/R/aggregate_catchments.R'><code>R/aggregate_catchments.R</code></a></small>
    <div class="hidden name"><code>aggregate_catchments.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Aggregates catchments according to a set of outlet catchments.</p>
    </div>

    <pre class="usage"><span class='fu'>aggregate_catchments</span>(
  <span class='no'>flowpath</span>,
  <span class='no'>divide</span>,
  <span class='no'>outlets</span>,
  <span class='kw'>zero_order</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>coastal_cats</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>da_thresh</span> <span class='kw'>=</span> <span class='fl'>NA</span>,
  <span class='kw'>only_larger</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>post_mortem_file</span> <span class='kw'>=</span> <span class='fl'>NA</span>
)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>flowpath</th>
      <td><p>sf data.frame Flowpaths as generated by `refactor_nhdplus`</p></td>
    </tr>
    <tr>
      <th>divide</th>
      <td><p>sf data.frame Reconciled catchment divides as generated by
`reconcile_catchment_divides`</p></td>
    </tr>
    <tr>
      <th>outlets</th>
      <td><p>data.frame with "ID" and "type" columns. "ID" must be identifiers from
fowpath and divide data.frames. "type" should be "outlet", or "terminal".
"outlet" will include the specified ID.
"terminal" will be treated as a terminal node with nothing downstream.</p></td>
    </tr>
    <tr>
      <th>zero_order</th>
      <td><p>list of vectors containing IDs to be aggregated into 0-order catchments.</p></td>
    </tr>
    <tr>
      <th>coastal_cats</th>
      <td><p>sf data.frame with coastal catchments to be used with zero order.</p></td>
    </tr>
    <tr>
      <th>da_thresh</th>
      <td><p>numeric Defaults to NA. A threshold total drainage area in the
units of the TotDASqKM
field of the flowpath data.frame. When automatically adding confluences to make
the network valid, tributary catchments under this threshold will be lumped with
the larger tributaries rather than being added to the set of output catchments.</p></td>
    </tr>
    <tr>
      <th>only_larger</th>
      <td><p>boolean Defaults to TRUE. If TRUE when adding confluences to
make the network valid, only tributaries larger than the one with an upstream
outlet will be added. e.g. if a tributary is required in the model this will
add main stems that the tributary contributes to. Note that the NHDPlus treats
divergences as part of the main stem, so the da_thresh may still be needed to
eliminate small tributary catchments introduced by divergences near confluences.</p></td>
    </tr>
    <tr>
      <th>post_mortem_file</th>
      <td><p>rda file to dump environment to in case of error</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>This function operates on the catchment network as a node-edge graph.
The outlet types are required to ensure that graph searches start from the
appropriate nodes and includes the appropriate catchments. Outlets such as gages
should be treated as "outlet" outlets.
While it may be possible for the algorithm to determine terminal outlets, at this
time, it is required that they be specified explicitely as "terminal" outlet types.</p>
<p>The function checks supplied outlets to make sure they connect downstream. Checks
verify that the outlet of the levelpath (main stem of a total catchment) of each
supplied outlet is
in the supplied outlet set. If the outlet of a levelpath is not in the supplied set, it
is added along with other catchments that contribute to the same receiving catchment.
These checks ensure that all output catchments have one and only one input and output
nexus and that all catchments are well-connected.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/source.html'>source</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/system.file.html'>system.file</a></span>(<span class='st'>"extdata"</span>, <span class='st'>"walker_data.R"</span>, <span class='kw'>package</span> <span class='kw'>=</span> <span class='st'>"hyRefactor"</span>))</div><div class='output co'>#&gt; <span class='message'>Loading required package: sp</span></div><div class='output co'>#&gt; <span class='message'>rgdal: version: 1.5-11, (SVN revision (unknown))</span>
#&gt; <span class='message'>Geospatial Data Abstraction Library extensions to R successfully loaded</span>
#&gt; <span class='message'>Loaded GDAL runtime: GDAL 3.1.0, released 2020/05/03</span>
#&gt; <span class='message'>Path to GDAL shared files: /usr/local/Cellar/osgeo-gdal/3.1.0_2/share/gdal</span>
#&gt; <span class='message'>GDAL binary built with GEOS: TRUE </span>
#&gt; <span class='message'>Loaded PROJ runtime: Rel. 6.3.2, May 1st, 2020, [PJ_VERSION: 632]</span>
#&gt; <span class='message'>Path to PROJ shared files: /usr/local/Cellar/osgeo-proj/6.3.2/share/proj</span>
#&gt; <span class='message'>Linking to sp version:1.4-2</span>
#&gt; <span class='message'>To mute warnings of possible GDAL/OSR exportToProj4() degradation,</span>
#&gt; <span class='message'>use options("rgdal_show_exportToProj4_warnings"="none") before loading rgdal.</span></div><div class='input'><span class='no'>outlets</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span>(<span class='kw'>ID</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>31</span>, <span class='fl'>3</span>, <span class='fl'>5</span>, <span class='fl'>1</span>, <span class='fl'>45</span>, <span class='fl'>92</span>),
                      <span class='kw'>type</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"outlet"</span>, <span class='st'>"outlet"</span>, <span class='st'>"outlet"</span>, <span class='st'>"terminal"</span>, <span class='st'>"outlet"</span>, <span class='st'>"outlet"</span>),
                      <span class='kw'>stringsAsFactors</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)
<span class='no'>aggregated</span> <span class='kw'>&lt;-</span> <span class='fu'>aggregate_catchments</span>(<span class='no'>walker_fline_rec</span>, <span class='no'>walker_catchment_rec</span>, <span class='no'>outlets</span>)</div><div class='output co'>#&gt; <span class='message'>Fixing 1 missing outlets.</span></div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/plot.html'>plot</a></span>(<span class='no'>aggregated</span>$<span class='no'>cat_sets</span>$<span class='no'>geom</span>, <span class='kw'>lwd</span> <span class='kw'>=</span> <span class='fl'>3</span>, <span class='kw'>border</span> <span class='kw'>=</span> <span class='st'>"red"</span>)</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/plot.html'>plot</a></span>(<span class='no'>walker_catchment_rec</span>$<span class='no'>geom</span>, <span class='kw'>lwd</span> <span class='kw'>=</span> <span class='fl'>1.5</span>, <span class='kw'>border</span> <span class='kw'>=</span> <span class='st'>"green"</span>, <span class='kw'>col</span> <span class='kw'>=</span> <span class='fl'>NA</span>, <span class='kw'>add</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/plot.html'>plot</a></span>(<span class='no'>walker_catchment</span>$<span class='no'>geom</span>, <span class='kw'>lwd</span> <span class='kw'>=</span> <span class='fl'>1</span>, <span class='kw'>add</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/plot.html'>plot</a></span>(<span class='no'>walker_flowline</span>$<span class='no'>geom</span>, <span class='kw'>lwd</span> <span class='kw'>=</span> <span class='fl'>.7</span>, <span class='kw'>col</span> <span class='kw'>=</span> <span class='st'>"blue"</span>, <span class='kw'>add</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)</div><div class='img'><img src='aggregate_catchments-1.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='fu'><a href='https://rdrr.io/r/base/plot.html'>plot</a></span>(<span class='no'>aggregated</span>$<span class='no'>cat_sets</span>$<span class='no'>geom</span>, <span class='kw'>lwd</span> <span class='kw'>=</span> <span class='fl'>3</span>, <span class='kw'>border</span> <span class='kw'>=</span> <span class='st'>"black"</span>)</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/plot.html'>plot</a></span>(<span class='no'>aggregated</span>$<span class='no'>fline_sets</span>$<span class='no'>geom</span>, <span class='kw'>lwd</span> <span class='kw'>=</span> <span class='fl'>3</span>, <span class='kw'>col</span> <span class='kw'>=</span> <span class='st'>"red"</span>, <span class='kw'>add</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/plot.html'>plot</a></span>(<span class='no'>walker_flowline</span>$<span class='no'>geom</span>, <span class='kw'>lwd</span> <span class='kw'>=</span> <span class='fl'>.7</span>, <span class='kw'>col</span> <span class='kw'>=</span> <span class='st'>"blue"</span>, <span class='kw'>add</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)</div><div class='img'><img src='aggregate_catchments-2.png' alt='' width='700' height='433' /></div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by David Blodgett.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


